<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zoengzihaam.github.io</id>
    <title>å·æ¯›</title>
    <updated>2021-02-24T07:29:25.597Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zoengzihaam.github.io"/>
    <link rel="self" href="https://zoengzihaam.github.io/atom.xml"/>
    <subtitle>æ²¡æœ‰æ’¤é€€å¯è¨€ã€‚</subtitle>
    <logo>https://zoengzihaam.github.io/images/avatar.png</logo>
    <icon>https://zoengzihaam.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, å·æ¯›</rights>
    <entry>
        <title type="html"><![CDATA[NetflixDNSè§£é”]]></title>
        <id>https://zoengzihaam.github.io/post/netflixdns-jie-suo/</id>
        <link href="https://zoengzihaam.github.io/post/netflixdns-jie-suo/">
        </link>
        <updated>2021-01-12T06:32:04.000Z</updated>
        <content type="html"><![CDATA[<h1 id="netflixdnsè§£é”">NetflixDNSè§£é”</h1>
<blockquote>
<p>ç”±äºNetflixçš„ç‰ˆæƒé—®é¢˜ï¼Œä½¿ç”¨ä¸€èˆ¬çš„ä»£ç†æœåŠ¡è·¨åŒºçœ‹å‰§æ—¶ä¼šè¢« Netflix æ£€æµ‹åˆ°å¹¶é˜»æ­¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨çš„vpsä¸èƒ½è§‚çœ‹Netflixçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è´­ä¹°ä¾¿å®œå¤§ç¢—çš„vpsæ¥è¾…åŠ©è§£é”ä¸èƒ½æŸ¥çœ‹Netflixçš„vpsã€‚</p>
</blockquote>
<h2 id="å‡†å¤‡å·¥ä½œ">å‡†å¤‡å·¥ä½œ</h2>
<p>æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›åŸºæœ¬çš„å‡†å¤‡ï¼Œä½ è‡³å°‘éœ€è¦è¿™äº›ä¸œè¥¿ï¼š</p>
<ul>
<li>æ”¯æŒ Netflix çš„ä»£ç†æœåŠ¡</li>
<li>ä¸æ”¯æŒ Netflix çš„ä»£ç†æœåŠ¡</li>
<li>Netflixè®¢é˜…</li>
</ul>
<p><strong>å°±ç›®å‰è€Œè¨€ï¼Œç¾åŒºåº”è¯¥æ˜¯ç›®å‰å‰§é›†èµ„æºæœ€ä¸°å¯Œçš„åœ°åŒºï¼Œä½†æ˜¯æ ¹æ®æœ¬äººäº²æµ‹ï¼Œç¾åŒºçš„èµ„æºå¹¶ä¸ç¬¦åˆå›½äººçš„è§‚çœ‹é£æ ¼ï¼Œä¸ªäººæ¯”è¾ƒæ¨èé¦™æ¸¯ã€‚</strong></p>
<h2 id="ä½¿ç”¨dnsmasqè§£é”netflixå¥ˆé£æµåª’ä½“æœåŠ¡">ä½¿ç”¨Dnsmasqè§£é”Netflixï¼ˆå¥ˆé£ï¼‰æµåª’ä½“æœåŠ¡</h2>
<p>è¿™é‡Œå€ŸåŠ©äº†<a href="https://www.moeelf.com/archives/23.html">èŒç²¾çµ</a> çš„è„šæœ¬å®ç°ï¼Œè¿™é‡Œæ„Ÿè°¢èŒç²¾çµã€‚</p>
<p><strong>å®‰è£…æ–¹æ³•ï¼š</strong></p>
<p>æ”¯æŒ Netflix çš„ä»£ç†vpså®‰è£…</p>
<pre><code class="language-shell">wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh &amp;&amp; bash dnsmasq_sniproxy.sh -f
</code></pre>
<p><strong>å¸è½½æ–¹æ³•ï¼š</strong></p>
<pre><code class="language-shell">wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh &amp;&amp; bash dnsmasq_sniproxy.sh -u
</code></pre>
<p><strong>ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>
<p>å°†<code>ä¸æ”¯æŒ Netflix çš„ä»£ç†VPS</code>çš„DNSåœ°å€ä¿®æ”¹ä¸º<code>æ”¯æŒ Netflix çš„ä»£ç†vps</code>çš„IPå°±å¯ä»¥äº†ï¼Œå¦‚æœä¸èƒ½ç”¨ï¼Œè®°å¾—åªä¿ç•™ä¸€ä¸ªDNSåœ°å€è¯•ä¸€ä¸‹ã€‚</p>
<p>âš ï¸ï¼šé˜²æ­¢æ»¥ç”¨ï¼Œå»ºè®®ä¸è¦éšæ„å…¬å¸ƒIPåœ°å€ï¼Œæˆ–ä½¿ç”¨é˜²ç«å¢™åšå¥½é™åˆ¶å·¥ä½œã€‚</p>
<p><strong>è°ƒè¯•æ’é”™ï¼š</strong></p>
<ul>
<li>ç¡®è®¤sniproxyæœ‰æ•ˆè¿è¡Œ</li>
</ul>
<p>é‡å¯sniå‘½ä»¤ï¼šsystemctl restart sniproxy</p>
<p>å¦‚æœsniä¸åœ¨è¿è¡Œï¼Œå¯æ£€æŸ¥é…ç½®/etc/sniproxy.confï¼Œé¿å…ssã€nginxæˆ–è€…å…¶ä»–ç¨‹åºç›‘å¬80,443ï¼Œå¯å°†å…¶é…ç½®æ–‡ä»¶çš„80æ›´æ”¹ä¸º801ç­‰ã€‚ 443ç«¯å£å¿…é¡»ç»™sniç›‘å¬æ”¾è¡Œï¼ŒæŸ¥çœ‹ï¼šnetstat -tlunp|grep 443</p>
<ul>
<li>ç¡®è®¤é˜²ç«å¢™æ”¾è¡Œ443,53</li>
</ul>
<p>è°ƒè¯•å¯ç›´æ¥å…³é—­é˜²ç«å¢™ systemctl stop firewalld.service</p>
<p>é˜¿é‡Œäº‘/è°·æ­Œäº‘/AWSç­‰å¤–éƒ¨é˜²ç«å¢™æ”¾è¡Œ å¯é€šè¿‡å…¶ä»–æœåŠ¡å™¨ telnet vpsip 53 ä»¥åŠ telnet vpsip 443 è¿›è¡Œæµ‹è¯•</p>
<ul>
<li>è§£æåŸŸå</li>
</ul>
<p>å°è¯•ç”¨å…¶ä»–æœåŠ¡å™¨é…ç½®å®Œæ¯•dnsåï¼Œè§£æåŸŸåï¼šnslookup <a href="https://www.moeelf.com/tag/netflix">netflix</a>.com åˆ¤æ–­IPæ˜¯å¦æ˜¯NETFLIXä»£ç†æœºå™¨IP å¦‚æœä¸å­˜åœ¨nslookupå‘½ä»¤ï¼ŒCENTOSå®‰è£…ï¼šyum install -y bind-utilsï¼ŒDEBIANå®‰è£…ï¼šapt-get -y install dnsutils</p>
<h2 id="ä¸€é”®è„šæœ¬ä¿®æ”¹æ¨èä¿®æ”¹æ–¹å¼">ä¸€é”®è„šæœ¬ä¿®æ”¹æ¨èä¿®æ”¹æ–¹å¼ï¼š</h2>
<blockquote>
<p>ä¸€é”®è„šæœ¬å¾ˆå¤šéƒ½ä¼šè‡ªå¸¦dnsæœåŠ¡ï¼Œä¼šå½±å“æµåª’ä½“çš„dnsè§£é”ã€‚</p>
</blockquote>
<p><strong>ä¿®æ”¹æ–¹å¼ï¼š</strong></p>
<pre><code class="language-shell">vi /etc/v2ray/config.json
</code></pre>
<p>æ‰¾åˆ°DNS</p>
<pre><code class="language-shell">&quot;dns&quot;: {
        &quot;servers&quot;: [
            {
                &quot;address&quot;: &quot;xxx.xxx.xxx.xxx&quot;,     //æ­¤å¤„ä¸ºæ”¯æŒ Netflix çš„ä»£ç†VPS
                &quot;port&quot;: 53,
                &quot;domains&quot;: [
                    &quot;domain:netflix.com&quot;,
                    &quot;domain:netflix.net&quot;,
                    &quot;domain:nflximg.net&quot;,
                    &quot;domain:nflxvideo.net&quot;,
                    &quot;domain:nflxso.net&quot;,
                    &quot;domain:nflxext.com&quot;
                ]
            },
            &quot;localhost&quot;
        ]
    }
</code></pre>
<p>ä¿®æ”¹é…ç½®å®Œæˆä»¥åï¼Œè¯·é‡å¯ä½ çš„V2RAYæœåŠ¡ï¼Œæˆ–æ˜¯é‡å¯VPSã€‚</p>
<h2 id="ä½¿ç”¨åˆ†æµè®©ä¸åŒçš„æµåª’ä½“èµ°ä¸åŒçš„dns">ä½¿ç”¨åˆ†æµï¼Œè®©ä¸åŒçš„æµåª’ä½“èµ°ä¸åŒçš„DNS</h2>
<p><strong>ä¿®æ”¹æ–¹æ³•ï¼š</strong></p>
<pre><code class="language-shell">&quot;dns&quot;: {
        &quot;servers&quot;: [
            {
                &quot;address&quot;: &quot;æ”¯æŒNetflixçš„ä»£ç†VPS&quot;,
                &quot;port&quot;: 53,
                &quot;domains&quot;: [
                    &quot;domain:netflix.com&quot;,
                    &quot;domain:netflix.net&quot;,
                    &quot;domain:nflximg.net&quot;,
                    &quot;domain:nflxvideo.net&quot;,
                    &quot;domain:nflxso.net&quot;,
                    &quot;domain:nflxext.com&quot;
                ]
            },
            {
                &quot;address&quot;: &quot;æ”¯æŒçš„ä»£ç†VPS&quot;,
                &quot;port&quot;: 53,
                &quot;domains&quot;: [
                    &quot;domain:gamer2-cds.cdn.hinet.net&quot;,
                    &quot;domain:gamer-cds.cdn.hinet.net&quot;,
                    &quot;domain:gamer.com.tw&quot;,
                    &quot;domain:i2.bahamut.com.tw&quot;,
                    &quot;domain:app-measurement.com&quot;
                ]
            },
            {
                &quot;address&quot;: &quot;æ”¯æŒçš„ä»£ç†VPS&quot;,
                &quot;port&quot;: 53,
                &quot;domains&quot;: [
                    &quot;domain:bilibili.com&quot;
                ]
            },
            &quot;localhost&quot;
        ]
    }
</code></pre>
<h2 id="åŸŸåè§„åˆ™">åŸŸåè§„åˆ™</h2>
<h3 id="netflix"><strong>Netflix</strong></h3>
<pre><code class="language-shell">netflix.com
netflix.net
nflximg.net
nflximg.com
nflxvideo.net
nflxso.net
nflxext.com
</code></pre>
<h3 id="spotify"><strong>Spotify</strong></h3>
<pre><code class="language-shell">scdn.co
spotify.com
spoti.fi
</code></pre>
<h3 id="bilibili"><strong>bilibili</strong></h3>
<pre><code class="language-shell">bilibili.com
</code></pre>
<h3 id="åŠ¨ç”»ç–¯"><strong>åŠ¨ç”»ç–¯</strong></h3>
<pre><code class="language-shell">gamer-cds.cdn.hinet.net
gamer2-cds.cdn.hinet.net
gamer.com.tw
i2.bahamut.com.tw
app-measurement.com
</code></pre>
<h3 id="line"><strong>Line</strong></h3>
<pre><code class="language-shell">lin.ee
line.me
linenaver.jp
line-apps.com
line-cdn.net
line-scdn.net
linetv.tw
cloudfront.net
</code></pre>
<h3 id="fox"><strong>Fox+</strong></h3>
<pre><code class="language-shell">fox.com
foxdng.com
foxnow.com
foxplus.com
foxplay.com
</code></pre>
<h3 id="bbc"><strong>BBC</strong></h3>
<pre><code class="language-shell">bbc.co
bbc.com
co.uk
llnwd.net
akamaized.net
</code></pre>
<h3 id="hulu"><strong>Hulu</strong></h3>
<pre><code class="language-shell">hulu.com
huluim.com
</code></pre>
<h3 id="hboç¾åŒº"><strong>hbo(ç¾åŒº)</strong></h3>
<pre><code class="language-shell">hbonow.com
hbogo.com
hbomax.com
hbo.com
</code></pre>
<h3 id="disney"><strong>disney</strong></h3>
<pre><code class="language-shell">disney.com
disneyjunior.com
disneyplus.com
disney-plus.net
dssott.com
bamgrid.com
amazonaws.com
go.com
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ROSåŒè½¯è·¯ç”±ä½¿ç”¨jumpå®ç°å…¬ç½‘ç«¯å£è½¬å‘]]></title>
        <id>https://zoengzihaam.github.io/post/19/</id>
        <link href="https://zoengzihaam.github.io/post/19/">
        </link>
        <updated>2020-11-25T15:57:44.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>ç”±äºä½¿ç”¨äº†åŒè½¯è·¯ç”±ï¼ŒROSä¸Šè®¾ç½®upnpï¼Œç«¯å£ä¸èƒ½å®ç°è‡ªåŠ¨è½¬å‘ï¼Œæ‰€ä»¥ä½¿ç”¨ROSçš„jumpæ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p>
</blockquote>
<ol>
<li>é¦–å…ˆåœ¨ROSåŠŸèƒ½ç•Œé¢æ‰“å¼€ IP â†’ Firewall â†’ NAT</li>
</ol>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125232043901.png" alt="image-20201125232043901" loading="lazy"></figure>
<ol start="2">
<li>
<p>æ·»åŠ ä¸€ä¸ª NAT è§„åˆ™ (è®¾ç½®jump)</p>
<p>1ï¸âƒ£ General è®¾ç½®</p>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125232323939.png" alt="image-20201125232323939" loading="lazy"></figure>
<p>2ï¸âƒ£ Action è®¾ç½®</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125232515115.png" alt="image-20201125232515115" loading="lazy"></figure>
</li>
<li>
<p>è®¾ç½®éœ€è¦çš„ç«¯å£è½¬å‘</p>
<p>1ï¸âƒ£ æ·»åŠ ä¸€ä¸ª NAT è§„åˆ™ (General è®¾ç½®)</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125233019443.png" alt="image-20201125233019443" loading="lazy"></figure>
<p>2ï¸âƒ£ Action è®¾ç½®</p>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125233236947.png" alt="image-20201125233236947" loading="lazy"></figure>
<p>åˆ°æ­¤ç«¯å£è½¬å‘å°±è®¾ç½®å®Œæˆã€‚</p>
</li>
<li>
<p>ç•ªå¤–</p>
<blockquote>
<p>ç”±äºå…¬ç½‘æ¯æ¬¡æ‹¨å·ï¼Œå¯èƒ½å¯¼è‡´å…¬ç½‘åœ°å€ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿™é‡Œä½¿ç”¨ROSçš„è„šæœ¬æ¥å®ç°è‡ªåŠ¨è®¾ç½®JUMPé‡Œé¢çš„å…¬ç½‘åœ°å€ã€‚</p>
</blockquote>
<p>1ï¸âƒ£ åœ¨ROSç•Œé¢ System â†’ scripts æ·»åŠ ä¸€ä¸ªè„šæœ¬</p>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125234013781.png" alt="image-20201125234013781" loading="lazy"></figure>
<p>2ï¸âƒ£ è®¾ç½®è„šæœ¬</p>
<figure data-type="image" tabindex="7"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125234414683.png" alt="image-20201125234414683" loading="lazy"></figure>
<p><code>scriptè„šæœ¬ä»£ç ï¼š</code></p>
<pre><code class="language-shell">:global addold
:global addnew
 :set addnew [/interface get [/interface find name=&quot;pppoe-out1&quot;] running]
 :if ($addnew=true) do={
  :set addold [/ip address get [/ip address find dynamic=yes interface=&quot;pppoe-out1&quot;] address]
  :set addold [:pick $addold 0 ([:len $addold ] -3)]
   /ip firewall nat set [/ip firewall nat find comment=&quot;dynamic_nat&quot;] dst-address=$addold
}
</code></pre>
<p>3ï¸âƒ£ è®¾ç½®ä¸€ä¸ªå®šæ—¶Profile</p>
<p>ROSç•Œé¢ â†’ PPP â†’ Profiles æ·»åŠ ä¸€ä¸ªæ–°çš„Profile</p>
<figure data-type="image" tabindex="8"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125234658556.png" alt="image-20201125234658556" loading="lazy"></figure>
<p>è®¾ç½®Profiles</p>
<figure data-type="image" tabindex="9"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125234911018.png" alt="image-20201125234911018" loading="lazy"></figure>
<p>è®¾ç½® Scripts</p>
<figure data-type="image" tabindex="10"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/image-20201125235117699.png" alt="image-20201125235117699" loading="lazy"></figure>
<p><code>profileè„šæœ¬ä»£ç ï¼š</code></p>
<pre><code class="language-shell">delay 3s
:execute &quot;dynamic_nat&quot;
</code></pre>
</li>
</ol>
<p>ğŸŒˆä»¥ä¸Šï¼Œå…¬ç½‘ç«¯å£è½¬å‘çš„jumpè®¾ç½®å…¨éƒ¨è®¾ç½®å®Œæ¯•ï¼Œå¦‚æœè¿‡ç¨‹æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·å„ä½æŒ‡æ•™ä¸€èµ·è®¨è®ºï¼Œè°¢è°¢ã€‚ğŸ’¨</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[dockerå¼€æœºè‡ªå¯]]></title>
        <id>https://zoengzihaam.github.io/post/16/</id>
        <link href="https://zoengzihaam.github.io/post/16/">
        </link>
        <updated>2020-07-25T14:51:11.000Z</updated>
        <content type="html"><![CDATA[<h1 id="dockerå¼€æœºè‡ªå¯">dockerå¼€æœºè‡ªå¯</h1>
<h2 id="ä¸€-dockeræœåŠ¡è®¾ç½®è‡ªåŠ¨å¯åŠ¨">ä¸€ã€dockeræœåŠ¡è®¾ç½®è‡ªåŠ¨å¯åŠ¨</h2>
<blockquote>
<p>é€‚ç”¨äºyumå®‰è£…çš„å„ç§æœåŠ¡</p>
</blockquote>
<ul>
<li>æŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡</li>
</ul>
<pre><code class="language-shell">systemctl list-units --type=service
</code></pre>
<ul>
<li>æŸ¥çœ‹æ˜¯å¦è®¾ç½®å¼€æœºå¯åŠ¨</li>
</ul>
<pre><code class="language-shell">systemctl list-unit-files | grep enable
</code></pre>
<ul>
<li>è®¾ç½®å¼€æœºå¯åŠ¨</li>
</ul>
<pre><code class="language-shell">systemctl enable docker.service
</code></pre>
<ul>
<li>å…³é—­å¼€æœºå¯åŠ¨</li>
</ul>
<pre><code class="language-shell">systemctl disable docker.service
</code></pre>
<h2 id="äºŒ-dockerå®¹å™¨è®¾ç½®è‡ªåŠ¨å¯åŠ¨">äºŒã€dockerå®¹å™¨è®¾ç½®è‡ªåŠ¨å¯åŠ¨</h2>
<ul>
<li>å¯åŠ¨æ—¶åŠ  --restart=always</li>
</ul>
<pre><code class="language-shell">docker run tomcat -it -d -p 8080:8080 --restart=always
</code></pre>
<ul>
<li>
<p>å¦‚æœå·²ç»è¿è¡Œè¿‡çš„é¡¹ç›®</p>
<p>é’ˆå¯¹ï¼šå·²ç»å¯åŠ¨çš„é¡¹ç›®ï¼Œä½¿ç”¨updateæ›´æ–°</p>
</li>
</ul>
<pre><code class="language-shell">docker update --restart=always imagesID
</code></pre>
<p><strong>restartå‚æ•°çš„å¯åŠ¨é€‰é¡¹</strong></p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>no</td>
<td>ä¸è‡ªåŠ¨é‡å¯å®¹å™¨. (é»˜è®¤value)</td>
</tr>
<tr>
<td>on-failure</td>
<td>å®¹å™¨å‘ç”Ÿerrorè€Œé€€å‡º(å®¹å™¨é€€å‡ºçŠ¶æ€ä¸ä¸º0)é‡å¯å®¹å™¨</td>
</tr>
<tr>
<td>unless-stopped</td>
<td>åœ¨å®¹å™¨å·²ç»stopæ‰æˆ–Docker stoped/restartedçš„æ—¶å€™æ‰é‡å¯å®¹å™¨</td>
</tr>
<tr>
<td>always</td>
<td>åœ¨å®¹å™¨å·²ç»stopæ‰æˆ–Docker stoped/restartedçš„æ—¶å€™æ‰é‡å¯å®¹å™¨</td>
</tr>
</tbody>
</table>
<hr>
<p>è½¬è½½è‡³ï¼š<a href="https://www.cnblogs.com/gcgc/p/10494615.html#_label0">ç§‹å¯»è‰</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Dockerå®‰è£…GUIå›¾å½¢åŒ–ç•Œé¢ï¼ˆPortainerï¼‰]]></title>
        <id>https://zoengzihaam.github.io/post/15/</id>
        <link href="https://zoengzihaam.github.io/post/15/">
        </link>
        <updated>2020-07-25T13:21:42.000Z</updated>
        <content type="html"><![CDATA[<h1 id="dockerå®‰è£…guiå›¾å½¢åŒ–ç•Œé¢portainer">Dockerå®‰è£…GUIå›¾å½¢åŒ–ç•Œé¢ï¼ˆPortainerï¼‰</h1>
<blockquote>
<p>Portaineræ˜¯ä¸€ä¸ªå¼€æºã€è½»é‡çº§Dockerç®¡ç†ç”¨æˆ·ç•Œé¢ï¼ŒåŸºäºDocker APIï¼Œæä¾›çŠ¶æ€æ˜¾ç¤ºé¢æ¿ã€åº”ç”¨æ¨¡æ¿å¿«é€Ÿéƒ¨ç½²ã€å®¹å™¨é•œåƒç½‘ç»œæ•°æ®å·çš„åŸºæœ¬æ“ä½œï¼ˆåŒ…æ‹¬ä¸Šä¼ ä¸‹è½½é•œåƒï¼Œåˆ›å»ºå®¹å™¨ç­‰æ“ä½œï¼‰ã€äº‹ä»¶æ—¥å¿—æ˜¾ç¤ºã€å®¹å™¨æ§åˆ¶å°æ“ä½œã€Swarmé›†ç¾¤å’ŒæœåŠ¡ç­‰é›†ä¸­ç®¡ç†å’Œæ“ä½œã€ç™»å½•ç”¨æˆ·ç®¡ç†å’Œæ§åˆ¶ç­‰åŠŸèƒ½ã€‚åŠŸèƒ½ååˆ†å…¨é¢ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³ä¸­å°å‹å•ä½å¯¹å®¹å™¨ç®¡ç†çš„å…¨éƒ¨éœ€æ±‚ã€‚</p>
</blockquote>
<h2 id="å¿«é€Ÿå…¥é—¨">å¿«é€Ÿå…¥é—¨</h2>
<h3 id="1å®˜ç½‘">1.å®˜ç½‘</h3>
<p>https://www.portainer.io/installation/</p>
<h3 id="2ä½¿ç”¨dockerå®‰è£…portainer">2.ä½¿ç”¨dockerå®‰è£…portainer</h3>
<h4 id="1æœç´¢portainer">1.æœç´¢portainer</h4>
<pre><code class="language-visual">docker search portainer
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200725205726.png" alt="image-20200725205725916" loading="lazy"></figure>
<h4 id="2å°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°">2.å°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°</h4>
<pre><code class="language-visual">docker pull portainer/portainer
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200725205825.png" alt="image-20200725205824991" loading="lazy"></figure>
<h4 id="3è¿è¡Œé•œåƒ">3.è¿è¡Œé•œåƒ</h4>
<pre><code class="language-vi">docker run -d -it --name portainerUI -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer
</code></pre>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200725205900.png" alt="image-20200725205900786" loading="lazy"></figure>
<p>æ³¨æ„ï¼šè¿™é‡Œå¦‚æœä½¿ç”¨å•æœºç‰ˆï¼Œä¸€å®šè¦ä½¿ç”¨ <code>-v /var/run/docker.sock:/var/run/docker.sock</code>ï¼Œå¦åˆ™åœ¨è¿›å…¥WEBUIçš„æ—¶å€™åˆ›å»ºä¼šå‡ºç°é—®é¢˜ï¼Œè¿™é‡Œ <code>volume</code>ä¹Ÿå¯ä½¿ç”¨å®˜æ–¹æ•™ç¨‹ï¼Œè¿™é‡Œå°†è¿è¡Œä»£ç ä¸€å¹¶è´´å…¥ã€‚</p>
<pre><code class="language-visual">docker volume create portainer_data
docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer
</code></pre>
<p>å®˜æ–¹è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªportainer_dataçš„æ–‡ä»¶å¤¹ç”¨äºå­˜å‚¨æ•°æ®ï¼Œå¤§å®¶æŒ‰éœ€è¿è¡Œå³å¯ã€‚</p>
<h3 id="3è®¿é—®portainer">3.è®¿é—®Portainer</h3>
<h4 id="1åˆ›å»ºç”¨æˆ·">1.åˆ›å»ºç”¨æˆ·</h4>
<p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥ <code>ip:ç«¯å£å·</code>ï¼Œè¿™é‡Œipæ˜¯Linuxçš„åœ°å€ï¼Œç«¯å£å·ä¸ºå¯åŠ¨çš„æ—¶å€™æ˜ å°„çš„ç«¯å£ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200725211127.png" alt="image-20200725211127863" loading="lazy"></figure>
<h4 id="2è¿æ¥dockerç¯å¢ƒ">2.è¿æ¥dockerç¯å¢ƒ</h4>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200725211700.png" alt="image-20200725211700177" loading="lazy"></figure>
<h4 id="3è¿›å…¥portainerç®¡ç†">3.è¿›å…¥Portainerç®¡ç†</h4>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200725211815.png" alt="image-20200725211815704" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[GateWayè‡ªå®šä¹‰å…¨å±€GlobalFilter]]></title>
        <id>https://zoengzihaam.github.io/post/13/</id>
        <link href="https://zoengzihaam.github.io/post/13/">
        </link>
        <updated>2020-07-06T11:14:01.000Z</updated>
        <content type="html"><![CDATA[<h1 id="gatewayè‡ªå®šä¹‰å…¨å±€globalfilter">GateWayè‡ªå®šä¹‰å…¨å±€GlobalFilter</h1>
<h2 id="1å®ç°ä¸¤ä¸ªæ¥å£">1.å®ç°ä¸¤ä¸ªæ¥å£</h2>
<ul>
<li>
<p>GlobalFilter</p>
<p>ç”¨äºè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚è¿›è¡ŒTokenéªŒè¯</p>
</li>
<li>
<p>Ordered</p>
<p>Springæä¾›äº†Orderedè¿™ä¸ªæ¥å£ï¼Œæ¥å¤„ç†ç›¸åŒæ¥å£å®ç°ç±»çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚</p>
</li>
</ul>
<pre><code class="language-Java">import lombok.extern.slf4j.Slf4j;
import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.Ordered;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

import java.util.Date;

@Component
@Slf4j
public class MyLogGateWayFilter implements GlobalFilter, Ordered {

    @Override
    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {

        //æ‰“å°è¾“å‡ºä¿¡æ¯
        log.info(&quot;************come in MyLogGateWayFilter&quot; + new Date());

        //è·å–requestä¸­çš„å‚æ•°
        String name = exchange.getRequest().getQueryParams().getFirst(&quot;name&quot;);
        //åˆ¤æ–­å‚æ•°çš„ä¿¡æ¯
        if(name ==null){
            log.info(&quot;************ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼Œ/(ã„’oã„’)/~~&quot;);
            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);
            return exchange.getResponse().setComplete();
        }

        return chain.filter(exchange);
    }

    @Override
    public int getOrder() {
        return 0;
    }
}
</code></pre>
<h2 id="2-ä½¿ç”¨cmdéªŒè¯">2. ä½¿ç”¨CMDéªŒè¯</h2>
<ul>
<li>
<p>éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™</p>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706185828.png" alt="image-20200706185828629" loading="lazy"></figure>
</li>
<li>
<p>ä¸éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™</p>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706185856.png" alt="image-20200706185856027" loading="lazy"></figure>
</li>
</ul>
<h2 id="3ç½‘é¡µç«¯æµ‹è¯•">3.ç½‘é¡µç«¯æµ‹è¯•</h2>
<ul>
<li>
<p>éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706185952.png" alt="image-20200706185952065" loading="lazy"></figure>
</li>
<li>
<p>ä¸éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706190016.png" alt="image-20200706190016823" loading="lazy"></figure>
</li>
</ul>
<p>ç»“è®ºï¼šè‡ªå®šä¹‰Filterç±»ä¼¼SpringMVCä¸­çš„Filterï¼ŒGlobalGilter å…¨å±€è¿‡æ»¤å™¨æ¥å£ä¸ GatewayFilter ç½‘å…³è¿‡æ»¤å™¨æ¥å£å…·æœ‰ç›¸åŒçš„æ–¹æ³•å®šä¹‰ã€‚å…¨å±€è¿‡æ»¤å™¨æ˜¯ä¸€ç³»åˆ—ç‰¹æ®Šçš„è¿‡æ»¤å™¨ï¼Œä¼šæ ¹æ®æ¡ä»¶åº”ç”¨åˆ°æ‰€æœ‰è·¯ç”±ä¸­ã€‚ç½‘å…³è¿‡æ»¤å™¨æ˜¯æ›´ç»†ç²’åº¦çš„è¿‡æ»¤å™¨ï¼Œä½œç”¨äºæŒ‡å®šçš„è·¯ç”±ä¸­ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å¾®æœåŠ¡ä¸­ä½¿ç”¨GateWayå®ç°ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®ã€‚]]></title>
        <id>https://zoengzihaam.github.io/post/12/</id>
        <link href="https://zoengzihaam.github.io/post/12/">
        </link>
        <updated>2020-07-06T09:16:26.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡ä¸­ä½¿ç”¨gatewayå®ç°ä¿æŠ¤-å¢å¼ºå’Œæ§åˆ¶å¯¹äº-api-æœåŠ¡çš„è®¿é—®">å¾®æœåŠ¡ä¸­ä½¿ç”¨GateWayå®ç°ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®ã€‚</h1>
<blockquote>
<p>ç½‘å…³çš„è§’è‰²æ˜¯ä½œä¸ºä¸€ä¸ª API æ¶æ„ï¼Œç”¨æ¥ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®ã€‚</p>
<p>API ç½‘å…³æ˜¯ä¸€ä¸ªå¤„äºåº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼ˆæä¾› REST API æ¥å£æœåŠ¡ï¼‰ä¹‹å‰çš„ç³»ç»Ÿï¼Œç”¨æ¥ç®¡ç†æˆæƒã€è®¿é—®æ§åˆ¶å’Œæµé‡é™åˆ¶ç­‰ï¼Œè¿™æ · REST API æ¥å£æœåŠ¡å°±è¢« API ç½‘å…³ä¿æŠ¤èµ·æ¥ï¼Œå¯¹æ‰€æœ‰çš„è°ƒç”¨è€…é€æ˜ã€‚å› æ­¤ï¼Œéšè—åœ¨ API ç½‘å…³åé¢çš„ä¸šåŠ¡ç³»ç»Ÿå°±å¯ä»¥ä¸“æ³¨äºåˆ›å»ºå’Œç®¡ç†æœåŠ¡ï¼Œè€Œä¸ç”¨å»å¤„ç†è¿™äº›ç­–ç•¥æ€§çš„åŸºç¡€è®¾æ–½ã€‚</p>
</blockquote>
<h2 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨</h2>
<h3 id="ä¸‰ä¸ªæ¦‚å¿µ">ä¸‰ä¸ªæ¦‚å¿µ</h3>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706150913.png" alt="image-20200706150913342" loading="lazy"></figure>
<p>æ³¨ï¼šä¸Šå›¾å¼•ç”¨CSDNåšä¸»<a href="https://blog.csdn.net/rain_web/article/details/102469745">AlgoRain</a>ï¼Œè¿™é‡Œè‡´è°¢ä¸€ä¸‹å¤§ä½¬è¯¦ç»†çš„è®²è§£ã€‚</p>
<h3 id="springcloudä¸­ä½¿ç”¨">springcloudä¸­ä½¿ç”¨</h3>
<h4 id="1æ–°å»ºmodule">1.æ–°å»ºModule</h4>
<p>æ·»åŠ ä¸€ä¸ªæ–°çš„Moduleï¼Œcloud-gateway-gateway9527ï¼ˆåç§°æŒ‰ç…§è‡ªå·±å–œå¥½ï¼‰</p>
<h4 id="2æ·»åŠ pomä¾èµ–">2.æ·»åŠ POMä¾èµ–</h4>
<pre><code class="language-Java">&lt;dependencies&gt;
        &lt;!--gateway--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-gateway&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--Eureka client--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--å¯¼å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.ziznah.springcloud&lt;/groupId&gt;
            &lt;artifactId&gt;cloud-api-commons&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h4 id="3æ·»åŠ ymlæ–‡ä»¶">3.æ·»åŠ YMLæ–‡ä»¶</h4>
<pre><code class="language-yaml">#é…ç½®ç«¯å£
server:
  port: 9527

spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
      routes:
        - id: payment_routh #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/get/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

        - id: payment_routh2 #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
#æ³¨å†Œè¿›æœåŠ¡ä¸­å¿ƒï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯eureka
eureka:
  instance:
    hostname: cloud-gateway-service
  client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://localhost:7001/eureka/

</code></pre>
<h4 id="4ä¸»å¯åŠ¨ç±»">4.ä¸»å¯åŠ¨ç±»</h4>
<pre><code class="language-Java">import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
@EnableDiscoveryClient
public class GateWayMain9527 {
    public static void main(String[] args) {
        SpringApplication.run(GateWayMain9527.class,args);
    }
}
</code></pre>
<h4 id="ä½¿ç”¨é…ç½®ç±»æ¥ç®€å•ä½¿ç”¨gateway">ä½¿ç”¨é…ç½®ç±»æ¥ç®€å•ä½¿ç”¨GateWay</h4>
<ul>
<li>å°†http://localhost:9527/guoneiè½¬å‘åˆ°ç™¾åº¦çš„æ–°é—»ç½‘ä¸­çš„å›½å†…ä¿¡æ¯</li>
</ul>
<pre><code class="language-java">import org.springframework.cloud.gateway.route.RouteLocator;
import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class GateWayConfig {

    /**
     * é…ç½®ä¸€ä¸ªidä¸ºroute-nameçš„è·¯ç”±è§„åˆ™ï¼Œ
     * å½“è®¿é—®åœ°å€http://localhost:9527/guoneiæ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://news.baidu.com/guonei
     * @param routeLocatorBuilder
     * @return
     */
    @Bean
    public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder){
        //è·å–ç½‘å…³çš„routes
        RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes();
        //è®¾ç½®ç½‘å…³çš„å†…å®¹
        routes.route(&quot;path_route_ziznah&quot;,r -&gt; r.path(&quot;/guonei&quot;).uri(&quot;http://news.baidu.com/guonei&quot;)).build();

        //è¿”å›å†…å®¹
        return routes.build();
    }
}
</code></pre>
<h4 id="å®ç°åŠ¨æ€è·¯ç”±">å®ç°åŠ¨æ€è·¯ç”±</h4>
<ul>
<li>å¤šä¸ªæœåŠ¡æä¾›è€…è¿›è¡Œæä¾›æœåŠ¡ï¼Œä½¿ç”¨åŠ¨æ€è·¯ç”±æ¥åˆ°è¾¾è´Ÿè½½å‡è¡¡</li>
</ul>
<h5 id="1yml">1.YML</h5>
<pre><code class="language-yaml">server:
  port: 9527

spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
     #å¼€å¯åŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½
      discovery:
        locator:
          enabled: true   #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±
      routes:
        - id: payment_routh #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
#          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          uri: lb://cloud-payment-service   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/get/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

        - id: payment_routh2 #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
#          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          uri: lb://cloud-payment-service   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

eureka:
  instance:
    hostname: cloud-gateway-service
  client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://localhost:7001/eureka/
</code></pre>
<p>æ³¨ï¼šéœ€è¦æ³¨æ„çš„æ˜¯uriçš„åè®®lbï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œlb://serverNameæ˜¯spring cloud  gatwayåœ¨å¾®æœåŠ¡ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è´Ÿè½½å‡è¡¡uriã€‚</p>
<h3 id="predicatesæ–­è¨€ä¸åŒç±»å‹">predicatesæ–­è¨€ä¸åŒç±»å‹</h3>
<h4 id="1after">1.After</h4>
<ul>
<li>YMLæ–‡ä»¶</li>
</ul>
<pre><code class="language-yaml"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- After=2020-07-06T16:43:08.146+08:00[Asia/Shanghai]
</code></pre>
<p>ä¸Šè¿°çš„æ—¶é—´åœ°å€å¯ä½¿ç”¨Javaä¸­timeçš„apiæ¥è·å–ï¼š</p>
<pre><code class="language-java">import java.time.ZoneId;
import java.time.ZonedDateTime;

public class T2 {
    public static void main(String[] args) {
        //è·å–é»˜è®¤æ—¶åŒº
        ZonedDateTime zdt = ZonedDateTime.now();
        System.out.println(zdt);
        //é€šè¿‡æŒ‡å®šæ—¶åŒºè·å–å½“å‰æ—¶é—´
        ZonedDateTime now = ZonedDateTime.now(ZoneId.of(&quot;America/New_York&quot;));
        System.out.println(now);
    }
}
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706164619.png" alt="image-20200706164619481" loading="lazy"></figure>
<h4 id="2before">2.Before</h4>
<p>æ–¹æ³•åŒAfter</p>
<h4 id="3between">3.Between</h4>
<p>æ–¹æ³•åŒAfter</p>
<h4 id="4cookie">4.Cookie</h4>
<ul>
<li>YMLæ–‡ä»¶</li>
</ul>
<pre><code class="language-yaml"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Cookie=ceshi,admin	
</code></pre>
<p>Windowsä¸­CMDçª—å£ä½¿ç”¨curlå‘½ä»¤è¿›è¡Œhttpè¯·æ±‚</p>
<ul>
<li>ä¸å¸¦Cookieè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706165615.png" alt="image-20200706165615728" loading="lazy"></figure>
<ul>
<li>å¸¦Cookieè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚</li>
</ul>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706165741.png" alt="image-20200706165741593" loading="lazy"></figure>
<h4 id="5header">5.Header</h4>
<ul>
<li>YMLæ–‡ä»¶</li>
</ul>
<pre><code class="language-yaml"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Header=X-Request-Id, \d+		#è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§ï¼Œå¹¶ä¸”å€¼ä¸ºæ­£æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚
</code></pre>
<p>ä½¿ç”¨CMDçš„curlå‘½ä»¤æµ‹è¯•</p>
<ul>
<li>å¸¦Header</li>
</ul>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706170541.png" alt="image-20200706170541704" loading="lazy"></figure>
<ul>
<li>
<p>ä¸å¸¦Header</p>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706170608.png" alt="image-20200706170608051" loading="lazy"></figure>
</li>
<li>
<p>å¸¦é”™è¯¯çš„Headerä¿¡æ¯</p>
<figure data-type="image" tabindex="7"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706170644.png" alt="image-20200706170644528" loading="lazy"></figure>
</li>
</ul>
<h4 id="6host">6.Host</h4>
<ul>
<li>YML</li>
</ul>
<pre><code class="language-yaml"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Host=**.ceshi.com
</code></pre>
<p>ä½¿ç”¨CMDçš„curlå‘½ä»¤æµ‹è¯•</p>
<ul>
<li>
<p>å¸¦Hostæµ‹è¯•</p>
<figure data-type="image" tabindex="8"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706171138.png" alt="image-20200706171138672" loading="lazy"></figure>
</li>
<li>
<p>ä¸å¸¦Hostæµ‹è¯•</p>
<figure data-type="image" tabindex="9"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706171300.png" alt="image-20200706171300046" loading="lazy"></figure>
</li>
<li>
<p>å¸¦é”™è¯¯Hostæµ‹è¯•</p>
<figure data-type="image" tabindex="10"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200706171234.png" alt="image-20200706171234897" loading="lazy"></figure>
</li>
</ul>
<h4 id="7method">7.Method</h4>
<ul>
<li>YML</li>
</ul>
<pre><code class="language-yaml"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Method=GET
</code></pre>
<h4 id="8path">8.Path</h4>
<h4 id="9query">9.Query</h4>
<h4 id="10weight">10.Weight</h4>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[å‚è€ƒRoundRobinRuleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡]]></title>
        <id>https://zoengzihaam.github.io/post/11/</id>
        <link href="https://zoengzihaam.github.io/post/11/">
        </link>
        <updated>2020-06-25T10:12:34.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å‚è€ƒroundrobinruleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡">å‚è€ƒRoundRobinRuleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡</h1>
<h2 id="1å®šä¹‰ä¸€ä¸ªloadbalanceræ¥å£">1.å®šä¹‰ä¸€ä¸ªLoadBalanceræ¥å£</h2>
<ul>
<li>è·å–æœåŠ¡å™¨é›†ç¾¤ä¸Šèƒ½å¤Ÿæä¾›æœåŠ¡çš„æœºå™¨æ•°é‡</li>
</ul>
<pre><code class="language-java">public interface Loadbalancer {
    /**
     * è·å–æœåŠ¡å™¨é›†ç¾¤ä¸Šèƒ½å¤Ÿæä¾›æœåŠ¡çš„æœºå™¨æ•°é‡
     * @param serviceInstances
     * @return
     */
    ServiceInstance instances(List&lt;ServiceInstance&gt; serviceInstances);
}
</code></pre>
<h2 id="2å®ç°loadbalanceræ¥å£ä¸­çš„æ–¹æ³•">2.å®ç°LoadBalanceræ¥å£ä¸­çš„æ–¹æ³•</h2>
<ul>
<li>åˆ©ç”¨è‡ªæ—‹é”ï¼Œåˆ›å»ºè·å–å½“å‰æœåŠ¡è°ƒç”¨æ˜¯ç¬¬å‡ æ¬¡è®¿é—®çš„æ–¹æ³•</li>
<li>å®ç°æ¥å£ä¸­è·å–æä¾›æœåŠ¡æœºå™¨æ•°é‡çš„æ–¹æ³•ï¼Œæ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡ç®—æ³•æ¥è¾¾åˆ°è´Ÿè½½è°ƒç”¨æœåŠ¡ã€‚</li>
</ul>
<pre><code class="language-java">/**
 * ClassName: MyLB
 * Description: å‚è€ƒRoundRobinRuleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡
 * Author: SUGAR
 * Date: 2020/6/25 16:09
 * Version: 1.0
 **/
@Component
public class MyLB implements Loadbalancer{

    private AtomicInteger atomicInteger = new AtomicInteger(0);

    /**
     * è·å–å½“å‰æœåŠ¡è°ƒç”¨æ˜¯ç¬¬å‡ æ¬¡è®¿é—®
     * @return
     */
    public final int getAndIncrement(){
        int current;
        int next;

        do {
            current = this.atomicInteger.get();
            next = current &gt;= 2147483647 ? 0 : current + 1;
        }while (!this.atomicInteger.compareAndSet(current,next));
        System.out.println(&quot;*****è®¿é—®ç¬¬&quot; + next + &quot;æ¬¡ï¼*****&quot;);
        return next;
    }

    /**
     * æ ¹æ®ç¬¬å‡ æ¬¡è®¿é—®ï¼Œæ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡ç®—æ³•æ¥è¾¾åˆ°è´Ÿè½½è°ƒç”¨æœåŠ¡
     * è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡
     * æ¯æ¬¡æœåŠ¡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹
     * @param serviceInstances
     * @return
     */
    @Override
    public ServiceInstance instances(List&lt;ServiceInstance&gt; serviceInstances) {

        int index = getAndIncrement() % serviceInstances.size();

        return serviceInstances.get(index);
    }
}
</code></pre>
<h2 id="3å–æ¶ˆloadbalancedæ³¨è§£">3.å–æ¶ˆLoadBalancedæ³¨è§£</h2>
<ul>
<li>å–æ¶ˆApplicationContextConfigä¸­RestTemplateçš„getæ–¹æ³•çš„LoadBalancedæ³¨è§£ï¼Œä½¿ç”¨è‡ªå·±æ¨¡æ‹Ÿçš„è´Ÿè½½å‡è¡¡ã€‚</li>
</ul>
<pre><code class="language-java">@Configuration
public class ApplicationContextConfig {

    @Bean
//    @LoadBalanced ä½¿ç”¨è‡ªå·±æ¨¡æ‹Ÿçš„è´Ÿè½½å‡è¡¡çš„æ–¹æ³•
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}
</code></pre>
<h2 id="4æ·»åŠ æœåŠ¡æä¾›å•†æä¾›çš„controlleræ–¹æ³•">4.æ·»åŠ æœåŠ¡æä¾›å•†æä¾›çš„controlleræ–¹æ³•</h2>
<ul>
<li>æ·»åŠ ä¸€ä¸ªè·å–å½“å‰æœåŠ¡æä¾›è€…ç«¯å£çš„æ–¹æ³•ï¼Œç”¨æ¥è´Ÿè½½å‡è¡¡ã€‚</li>
</ul>
<pre><code class="language-java">@GetMapping(value = &quot;/payment/lb&quot;)
public String getPaymentLB() {
    return serverPort;
}
</code></pre>
<p><font style="color:red"><strong>æ³¨ï¼š</strong></font>è¿™é‡Œçš„æ–¹æ³•æ·»åŠ åˆ°æä¾›å•†çš„controllerä¸­ã€‚</p>
<h2 id="5è°ƒç”¨è€…æ·»åŠ controlleræ–¹æ³•">5.è°ƒç”¨è€…æ·»åŠ controlleræ–¹æ³•</h2>
<ul>
<li>è°ƒç”¨è€…controlleræ·»åŠ è°ƒç”¨æœåŠ¡æä¾›å•†çš„æ–¹æ³•ï¼Œæµ‹è¯•è´Ÿè½½å‡è¡¡</li>
</ul>
<pre><code class="language-java">@GetMapping(value = &quot;/consumer/payment/lb&quot;)
public String getPayementLB(){
    List&lt;ServiceInstance&gt; instances = discoveryClient.getInstances(&quot;CLOUD-PAYMENT-SERVICE&quot;);
    //åˆ¤æ–­æœåŠ¡æ˜¯å¦ä¸ºæœ‰æ•ˆæœåŠ¡
    if(instances == null || instances.size() &lt;= 0){
        return null;
    }

    ServiceInstance serviceInstance = loadbalancer.instances(instances);
    URI uri = serviceInstance.getUri();

    return restTemplate.getForObject(uri + &quot;/payment/lb&quot;,String.class);
}
</code></pre>
<h2 id="6æµ‹è¯•">6.æµ‹è¯•</h2>
<ul>
<li>å¯åŠ¨å¯¹åº”çš„æœåŠ¡</li>
</ul>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200625175834.png" alt="image-20200625175834663" loading="lazy"></figure>
<ul>
<li>æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸï¼ˆæ¨¡æ‹Ÿæä¾›è€…é›†ç¾¤ä»¥åŠæœåŠ¡å™¨é›†ç¾¤ï¼‰</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200625180016.png" alt="image-20200625180016280" loading="lazy"></figure>
<ul>
<li>æ¨¡æ‹Ÿè°ƒç”¨è€…è®¿é—®æ¥å£</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200625180207.png" alt="image-20200625180207309" loading="lazy"></figure>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200625180221.png" alt="image-20200625180221054" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200625180244.png" alt="image-20200625180244048" loading="lazy"></figure>
<p>â€‹	æ ¹æ®ä»¥ä¸Šè°ƒç”¨ï¼Œåå°ä¹Ÿæ‰“å°å‡ºç›¸åº”çš„è°ƒç”¨ä¿¡æ¯ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Dockerä¸­ CMD ä¸ ENTRYPOINT ä¿ç•™æŒ‡ä»¤çš„åŒºåˆ«]]></title>
        <id>https://zoengzihaam.github.io/post/10/</id>
        <link href="https://zoengzihaam.github.io/post/10/">
        </link>
        <updated>2020-06-09T13:52:56.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>ç¼–å†™Dockerfileæ—¶ï¼Œæ—¶å¸¸çœ‹åˆ°æœ€åä¼šçœ‹åˆ°CMDæˆ–è€…ENTRYPOINT çš„ä¿ç•™æŒ‡ä»¤ï¼Œä½†æ˜¯ä»–ä»¬çš„æ„ä¹‰éƒ½ä¸ºï¼šæŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„å·®å¼‚åœ¨å“ªé‡Œï¼Ÿ</p>
</blockquote>
<h2 id="ä½¿ç”¨curlå‘½ä»¤æ¥è¯´æ˜">ä½¿ç”¨curlå‘½ä»¤æ¥è¯´æ˜</h2>
<h3 id="é¦–å…ˆç¼–å†™ä¸¤ä¸ªdockerfile">é¦–å…ˆç¼–å†™ä¸¤ä¸ªDockerfile</h3>
<ol>
<li>ä½¿ç”¨<code>CMD</code>ä¿ç•™æŒ‡ä»¤ã€‚</li>
</ol>
<pre><code class="language-shell">FROM centos
RUN yum install -y curl
CMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;https://www.baidu.com/&quot; ]
</code></pre>
<p>è¿™é‡Œ Dockerfile çš„åå­—è¦æ±‚å°å†™ï¼Œå¦åˆ™ä¼šæŠ¥é”™<code>invalid argument &quot;cmdCentos&quot; for &quot;-t, --tag&quot; flag: invalid reference format: repository name must be lowercase See 'docker build --help'.</code></p>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609213217.png" alt="image-20200609213217668" loading="lazy"></figure>
<ol start="2">
<li>ä½¿ç”¨<code>ENTRYPOINT</code>ä¿ç•™æŒ‡ä»¤ã€‚</li>
</ol>
<pre><code class="language-shell">FROM centos
RUN yum install -y curl
ENTRYPOINT [ &quot;curl&quot;, &quot;-s&quot;, &quot;https://www.baidu.com/&quot; ]
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609213320.png" alt="image-20200609213320960" loading="lazy"></figure>
<h3 id="åœ¨dockerä¸­è¿›è¡Œbuildè¿›è¡Œæ„å»ºä¸€ä¸ªæ–°çš„é•œåƒ">åœ¨dockerä¸­è¿›è¡Œbuildè¿›è¡Œæ„å»ºä¸€ä¸ªæ–°çš„é•œåƒ</h3>
<ol>
<li>
<p>æ„å»º<code>CMD</code>ä¿ç•™æŒ‡ä»¤çš„Dockerfileã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609213449.png" alt="image-20200609213449579" loading="lazy"></figure>
</li>
<li>
<p>æ„å»º<code>ENTRYPOINT</code>ä¿ç•™æŒ‡ä»¤çš„Dockerfileã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609213554.png" alt="image-20200609213553986" loading="lazy"></figure>
</li>
</ol>
<h3 id="è¿è¡Œä¸¤ä¸ªé•œåƒè¿›è¡Œå¯¹æ¯”">è¿è¡Œä¸¤ä¸ªé•œåƒè¿›è¡Œå¯¹æ¯”</h3>
<ol>
<li>
<p>è¿è¡Œ<code>CMD</code>ä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚</p>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609213732.png" alt="image-20200609213732383" loading="lazy"></figure>
</li>
<li>
<p>è¿è¡Œ<code>ENTRYPOINT</code>ä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚</p>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609213855.png" alt="image-20200609213855288" loading="lazy"></figure>
</li>
</ol>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°ï¼Œä¸¤ä¸ªé•œåƒè¿è¡Œèµ·æ¥æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯<strong>é‡ç‚¹æ¥äº†</strong>ï¼å½“æˆ‘ä»¬éœ€è¦<strong>å¯¹é•œåƒå¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤è¿›è¡Œå¢å¼º</strong>çš„æ—¶å€™ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬è¿˜æƒ³è·å–æŒ‡å®šç½‘ç«™çš„<code>å¤´ä¿¡æ¯</code>ã€‚</p>
<ol start="3">
<li>
<p>è¿è¡Œå¢å¼ºåçš„<code>CMD</code>ä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚</p>
<figure data-type="image" tabindex="7"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609214241.png" alt="image-20200609214241092" loading="lazy"></figure>
</li>
<li>
<p>è¿è¡Œå¢å¼ºåçš„<code>ENTRYPOINT</code>ä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚</p>
<figure data-type="image" tabindex="8"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609214443.png" alt="image-20200609214443164" loading="lazy"></figure>
</li>
</ol>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>ç”±ä¸Šè¿°çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œåœ¨æ‰§è¡ŒDockerfileä¸­ï¼Œå¦‚æœä½¿ç”¨äº†<code>CMD</code>ä¿ç•™æŒ‡ä»¤ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œé•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å…¶å¯åŠ¨å‘½ä»¤åé¢æ·»åŠ <code>OPTION</code>é€‰é¡¹çš„æ—¶å€™ï¼Œå°†ä¼šè¦†ç›–Dockerfileä¸­çš„ä¸Šä¸€å¥æŒ‡ä»¤ï¼Œé€ æˆè¿è¡Œå¤±è´¥ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-shell">FROM centos
RUN yum install -y curl
CMD [ &quot;curl&quot;, &quot;-s&quot;, &quot;https://www.baidu.com/&quot; ]
CMD -i
</code></pre>
<p>å¦‚æœä½¿ç”¨<code>ENTRYPOINT</code>ä¿ç•™æŒ‡ä»¤ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œé•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å…¶å¯åŠ¨å‘½ä»¤åé¢æ·»åŠ <code>OPTION</code>é€‰é¡¹çš„æ—¶å€™ï¼Œä¼šå¯¹è¿è¡Œçš„å‘½ä»¤è¿›è¡Œ<code>â€œå¢å¼ºâ€</code>ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-shell">FROM centos
RUN yum install -y curl
ENTRYPOINT [ &quot;curl&quot;, &quot;-s&quot;,&quot;-i&quot;, &quot;https://www.baidu.com/&quot; ]
</code></pre>
<p>æ‰€ä»¥ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯ä½¿ç”¨<code>CMD</code>è¿˜æ˜¯<code>ENTRYPOINT</code>ä¿ç•™æŒ‡ä»¤ï¼Œè¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡è¦æ±‚ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åœ¨VMware Workstationä¸Šå®‰è£…CentOS7çš„ç½‘ç»œé—®é¢˜]]></title>
        <id>https://zoengzihaam.github.io/post/9/</id>
        <link href="https://zoengzihaam.github.io/post/9/">
        </link>
        <updated>2020-06-09T06:20:10.000Z</updated>
        <content type="html"><![CDATA[<h2 id="é…ç½®ç½‘ç»œ">é…ç½®ç½‘ç»œ</h2>
<h3 id="è™šæ‹Ÿæœºcentosçš„ç½‘ç»œè®¾ç½®">è™šæ‹ŸæœºCentOSçš„ç½‘ç»œè®¾ç½®</h3>
<h4 id="1-å°†ç½‘ç»œé€‚é…å™¨è®¾ç½®ä¸ºnatæ¨¡å¼">1. å°†ç½‘ç»œé€‚é…å™¨è®¾ç½®ä¸º<code>NATæ¨¡å¼</code></h4>
<figure data-type="image" tabindex="1"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609140748.png" alt="image-20200609140748138" loading="lazy"></figure>
<h4 id="2-linuxä¸­ç½‘ç»œè®¾ç½®">2. Linuxä¸­ç½‘ç»œè®¾ç½®</h4>
<p><code>cd /etc/sysconfig/network-scripts/</code>ï¼Œè¿›å…¥CentOS7çš„ç½‘ç»œé…ç½®æ–‡ä»¶ä¸‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç½‘å¡è®¾ç½®ï¼Œæˆ‘è¿™é‡Œçš„ç½‘å¡æ˜¯<code>ifcfg-ens32</code>ï¼Œæ¯ä¸ªäººçš„ç½‘å¡åç§°å¯èƒ½ä¸ä¸€æ ·ï¼Œä¸ç”¨åœ¨æ„ã€‚</p>
<figure data-type="image" tabindex="2"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609141501.png" alt="image-20200609141501373" loading="lazy"></figure>
<p><code>vim ifcfg-ens32</code> ï¼Œæ‰“å¼€æŒ‡å®šçš„ç½‘å¡é…ç½®æ–‡ä»¶ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£… vimï¼Œä½¿ç”¨ vi æ‰“å¼€å³å¯ã€‚</p>
<figure data-type="image" tabindex="3"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609141842.png" alt="image-20200609141842892" loading="lazy"></figure>
<p>æ·»åŠ çš„<code>ip</code>ã€<code>å­ç½‘æ©ç </code>ã€<code>ç½‘å…³</code>ï¼Œåœ¨VMware Workstationä¸­çš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ä¸­æŸ¥çœ‹ã€‚</p>
<figure data-type="image" tabindex="4"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609142048.png" alt="image-20200609142048076" loading="lazy"></figure>
<p>é€‰æ‹©<code>VMnet8</code>ï¼Œç„¶å<code>NATè®¾ç½®</code></p>
<figure data-type="image" tabindex="5"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609142226.png" alt="image-20200609142226380" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200609142259.png" alt="image-20200609142259233" loading="lazy"></figure>
<p><strong>IPADDR</strong>ï¼šä¸ºä¸Šæ–¹çš„å­ç½‘IPï¼Œå»ºè®®IPè®¾ç½®ä¸º<code>XXX.XXX.XXX.200~XXX.XXX.XXX.250</code>ä¹‹é—´</p>
<p><strong>PREFIXO</strong>ï¼šä¸ºä¸Šæ–¹å­ç½‘æ©ç ï¼Œ255.255.255.0å³ä¸º24</p>
<p><strong>GATEWAY</strong>ï¼šä¸ºä¸Šæ–¹ç½‘å…³IPï¼Œå¯¹åº”å¡«ä¸Šå³å¯ã€‚</p>
<p><strong>DNS1</strong>ï¼š8.8.8.8</p>
<p><strong>DNS2</strong>ï¼š8.8.4.4</p>
<p>è¿™é‡ŒDNSéƒ½è®¾ç½®ä¸ºè°·æ­Œçš„DNSï¼Œæ­£å¸¸è§£æå³å¯ï¼Œå…¶ä»–DNSä¹Ÿå¯ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Redis]]></title>
        <id>https://zoengzihaam.github.io/post/8/</id>
        <link href="https://zoengzihaam.github.io/post/8/">
        </link>
        <updated>2020-06-04T12:10:36.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>å¤šèƒ½ï¼Œæ•°æ®ç±»å‹ä¸°å¯Œï¼Œä½¿ç”¨Redisï¼ŒTair</p>
<p>Redis:REmote DIctionary Server(è¿œç¨‹å­—å…¸æœåŠ¡å™¨)</p>
<p>æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œéµå®ˆBSDåè®®ï¼Œ<br>
æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„(key/value)åˆ†å¸ƒå¼å†…å­˜æ•°æ®åº“ï¼ŒåŸºäºå†…å­˜è¿è¡Œ<br>
å¹¶æ”¯æŒæŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ï¼Œæ˜¯å½“å‰æœ€çƒ­é—¨çš„NoSqlæ•°æ®åº“ä¹‹ä¸€,<br>
ä¹Ÿè¢«äººä»¬ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨</p>
</blockquote>
<h2 id="ä¸‹è½½redis">ä¸‹è½½Redis</h2>
<p>https://redis.io/download</p>
<h2 id="å¯¹redisçš„ç†è§£">å¯¹Redisçš„ç†è§£</h2>
<ol>
<li>Redisæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç ï¼ˆBSDè®¸å¯ï¼‰çš„å†…å­˜ä¸­æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ï¼Œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚</li>
<li>KVã€Cacheã€Persistenceã€...</li>
</ol>
<h2 id="redisçš„æ¦‚è¿°">Redisçš„æ¦‚è¿°</h2>
<ul>
<li><strong>3V+3é«˜</strong></li>
</ul>
<table>
<thead>
<tr>
<th>3V</th>
<th>3é«˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>æµ·é‡Volume</td>
<td>é«˜å¹¶å‘</td>
</tr>
<tr>
<td>å¤šæ ·Variety</td>
<td>é«˜å¯æ‰©</td>
</tr>
<tr>
<td>å®æ—¶Velocity</td>
<td>é«˜æ€§èƒ½</td>
</tr>
</tbody>
</table>
<h2 id="ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“">ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“</h2>
<p><strong>ä¼ ç»Ÿçš„ACID</strong></p>
<h3 id="1-a-atomicity-åŸå­æ€§">1ã€A (Atomicity) åŸå­æ€§</h3>
<p>åŸå­æ€§å¾ˆå®¹æ˜“ç†è§£ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡é‡Œçš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨åšå®Œï¼Œè¦ä¹ˆéƒ½ä¸åšï¼Œäº‹åŠ¡æˆåŠŸçš„æ¡ä»¶æ˜¯äº‹åŠ¡é‡Œçš„æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸï¼Œåªè¦æœ‰ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å°±å¤±è´¥ï¼Œéœ€è¦å›æ»šã€‚æ¯”å¦‚é“¶è¡Œè½¬è´¦ï¼Œä»Aè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š1ï¼‰ä»Aè´¦æˆ·å–100å…ƒï¼›2ï¼‰å­˜å…¥100å…ƒè‡³Bè´¦æˆ·ã€‚è¿™ä¸¤æ­¥è¦ä¹ˆä¸€èµ·å®Œæˆï¼Œè¦ä¹ˆä¸€èµ·ä¸å®Œæˆï¼Œå¦‚æœåªå®Œæˆç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥å¤±è´¥ï¼Œé’±ä¼šè«åå…¶å¦™å°‘äº†100å…ƒã€‚</p>
<h3 id="2-c-consistency-ä¸€è‡´æ€§">2ã€C (Consistency) ä¸€è‡´æ€§</h3>
<p>ä¸€è‡´æ€§ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®åº“è¦ä¸€ç›´å¤„äºä¸€è‡´çš„çŠ¶æ€ï¼Œäº‹åŠ¡çš„è¿è¡Œä¸ä¼šæ”¹å˜æ•°æ®åº“åŸæœ¬çš„ä¸€è‡´æ€§çº¦æŸã€‚</p>
<h3 id="3-i-isolation-ç‹¬ç«‹æ€§">3ã€I (Isolation) ç‹¬ç«‹æ€§</h3>
<p>æ‰€è°“çš„ç‹¬ç«‹æ€§æ˜¯æŒ‡å¹¶å‘çš„äº‹åŠ¡ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è¦è®¿é—®çš„æ•°æ®æ­£åœ¨è¢«å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ï¼Œåªè¦å¦å¤–ä¸€ä¸ªäº‹åŠ¡æœªæäº¤ï¼Œå®ƒæ‰€è®¿é—®çš„æ•°æ®å°±ä¸å—æœªæäº¤äº‹åŠ¡çš„å½±å“ã€‚æ¯”å¦‚ç°æœ‰æœ‰ä¸ªäº¤æ˜“æ˜¯ä»Aè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåœ¨è¿™ä¸ªäº¤æ˜“è¿˜æœªå®Œæˆçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ­¤æ—¶BæŸ¥è¯¢è‡ªå·±çš„è´¦æˆ·ï¼Œæ˜¯çœ‹ä¸åˆ°æ–°å¢åŠ çš„100å…ƒçš„</p>
<h3 id="4-d-durability-æŒä¹…æ€§">4ã€D (Durability) æŒä¹…æ€§</h3>
<p>æŒä¹…æ€§æ˜¯æŒ‡ä¸€æ—¦äº‹åŠ¡æäº¤åï¼Œå®ƒæ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸ä¹…çš„ä¿å­˜åœ¨æ•°æ®åº“ä¸Šï¼Œå³ä½¿å‡ºç°å®•æœºä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<h2 id="éå…³ç³»å‹æ•°æ®åº“">éå…³ç³»å‹æ•°æ®åº“</h2>
<p><strong>CAP</strong></p>
<h3 id="cconsistencyå¼ºä¸€è‡´æ€§">C:Consistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰</h3>
<h3 id="aavailabilityå¯ç”¨æ€§">A:Availabilityï¼ˆå¯ç”¨æ€§ï¼‰</h3>
<h3 id="ppartition-toleranceåˆ†åŒºå®¹é”™æ€§">P:Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰</h3>
<h2 id="redisçš„å®‰è£…">Redisçš„å®‰è£…</h2>
<blockquote>
<p>Linuxç‰ˆå®‰è£…</p>
</blockquote>
<ul>
<li>
<p>è·å–<code>Redis</code>çš„å®‰è£…åŒ…</p>
<p>å°†å®‰è£…åŒ…æ”¾åœ¨/usr/local/redisä¸‹</p>
</li>
<li>
<p>è§£å‹<code>Redis</code>å®‰è£…åŒ…</p>
</li>
</ul>
<pre><code class="language-shell">tar -zxvf redis-5.0.4.tar.gz
</code></pre>
<ul>
<li>è¿›å…¥Redisç›®å½•</li>
</ul>
<pre><code class="language-shell">cd /usr/local/redis/redis-5.0.4
</code></pre>
<ul>
<li>æ‰§è¡Œ<code>make</code>å‘½ä»¤</li>
</ul>
<pre><code class="language-shell">make
</code></pre>
<p><font color=red>è¿è¡Œmakeå‘½ä»¤æ—¶æ•…<br>
æ„å‡ºç°çš„é”™è¯¯è§£æï¼š</font></p>
<p>â€‹	å®‰è£…gcc</p>
<pre><code class="language-shell">yum -y install gcc-c++
</code></pre>
<ul>
<li>æ‰§è¡Œ<code>make install</code>ï¼Œæ£€éªŒå®‰è£…</li>
</ul>
<pre><code class="language-shell">make install
</code></pre>
<h2 id="redisåŸºæœ¬ä½¿ç”¨">RedisåŸºæœ¬ä½¿ç”¨</h2>
<h3 id="æ›´æ”¹é…ç½®">æ›´æ”¹é…ç½®</h3>
<h4 id="1æ›´æ”¹redisconfé…ç½®æ–‡ä»¶">1.æ›´æ”¹redis.confé…ç½®æ–‡ä»¶</h4>
<p>é¦–å…ˆå¤‡ä»½å½“å‰<code>redis.conf</code>æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ã€‚</p>
<pre><code class="language-shell">daemonize yes
</code></pre>
<h3 id="å¯åŠ¨">å¯åŠ¨</h3>
<p>å®‰è£…<code>redis</code>ä¹‹åï¼Œåœ¨<code>/usr/local/bin</code>ä¼šæœ‰redisçš„å¯åŠ¨æ–‡ä»¶ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509140808.png" alt="image-20200509140806730" loading="lazy"></figure>
<ul>
<li>æ‰§è¡Œ<code>redis-server /bak/redis/redis.conf</code>ï¼Œå¯åŠ¨rediså¹¶ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ã€‚</li>
</ul>
<pre><code class="language-shell">redis-server /bak/redis/redis.conf
</code></pre>
<figure data-type="image" tabindex="2"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509140947.png" alt="image-20200509140946468" loading="lazy"></figure>
<h3 id="è¿é€šæµ‹è¯•">è¿é€šæµ‹è¯•</h3>
<ul>
<li>æ‰§è¡Œ<code>redis-cli -p 6379</code>æ¥æŒ‡å®šç«¯å£å¯åŠ¨æµ‹è¯•ã€‚</li>
</ul>
<pre><code class="language-shell">redis-cli -p 6379
</code></pre>
<ul>
<li>ä½¿ç”¨<code>ping</code>å‘½ä»¤æ¥æµ‹è¯•è¿é€šï¼Œå‡ºç°<code>PONG</code>å³ä¸ºæˆåŠŸã€‚</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509141352.png" alt="image-20200509141350989" loading="lazy"></figure>
<ul>
<li>å¯ä½¿ç”¨ps -ef|grep redisæ¥æŸ¥çœ‹redisçš„è¿›ç¨‹ã€‚</li>
</ul>
<pre><code class="language-shell">ps -ef|grep redis
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509141627.png" alt="image-20200509141626567" loading="lazy"></figure>
<h3 id="å…³é—­redis">å…³é—­redis</h3>
<ul>
<li>æ‰§è¡Œ<code>redis-cli shutdown</code>ã€‚</li>
</ul>
<pre><code class="language-shell">redis-cli shutdown
</code></pre>
<h2 id="rediså¯èƒ½é‡åˆ°é—®é¢˜">Rediså¯èƒ½é‡åˆ°é—®é¢˜</h2>
<ul>
<li><strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></li>
</ul>
<pre><code class="language-shell">protected-mode no # å…³é—­ä¿æŠ¤æ¨¡å¼
daemonize yes     # å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¼€å¯
#bind 127.0.0.1   # ç»‘å®šIPæŒ‰éœ€ä¿®æ”¹
port 6379         # ç«¯å£æŒ‰éœ€ä¿®æ”¹
</code></pre>
<ul>
<li><strong>è¿è¡Œå¹¶æ£€æŸ¥ç«¯å£</strong></li>
</ul>
<pre><code class="language-shell">#å¯åŠ¨æœåŠ¡å‘½ä»¤
./usr/local/bin/redis-server /bak/redis/redis.conf
#æŸ¥çœ‹6379ç«¯å£æ˜¯å¦å ç”¨
netstat -tunpl | grep 6379
</code></pre>
<ul>
<li><strong>å¼€æ”¾é˜²ç«å¢™ç«¯å£</strong></li>
</ul>
<pre><code class="language-shell">#å¼€æ”¾6379ç«¯å£
/sbin/iptables -I INPUT -p tcp --dport 6379 -j ACCEPT
#ä¿å­˜é…ç½®
/etc/rc.d/init.d/iptables save
#é‡å¯æœåŠ¡
/etc/rc.d/init.d/iptables restart
#æŸ¥çœ‹ç«¯å£æ˜¯å¦å·²ç»å¼€æ”¾
/etc/init.d/iptables status
</code></pre>
<h2 id="rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£">Rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£</h2>
<h3 id="å•è¿›ç¨‹">å•è¿›ç¨‹</h3>
<blockquote>
<p>å•è¿›ç¨‹æ¨¡å‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å¯¹è¯»å†™ç­‰äº‹ä»¶çš„å“åº”<br>
æ˜¯é€šè¿‡å¯¹epollå‡½æ•°çš„åŒ…è£…æ¥åšåˆ°çš„ã€‚Redisçš„å®é™…å¤„ç†é€Ÿåº¦å®Œå…¨ä¾é ä¸»è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡</p>
</blockquote>
<blockquote>
<p>Epollæ˜¯Linuxå†…æ ¸ä¸ºå¤„ç†å¤§æ‰¹é‡æ–‡ä»¶æè¿°ç¬¦è€Œä½œäº†æ”¹è¿›çš„epollï¼Œæ˜¯Linuxä¸‹å¤šè·¯å¤ç”¨IOæ¥å£select/pollçš„å¢å¼ºç‰ˆæœ¬ï¼Œ<br>
å®ƒèƒ½æ˜¾è‘—æé«˜ç¨‹åºåœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸­åªæœ‰å°‘é‡æ´»è·ƒçš„æƒ…å†µä¸‹çš„ç³»ç»ŸCPUåˆ©ç”¨ç‡ã€‚</p>
</blockquote>
<h3 id="é»˜è®¤16ä¸ªæ•°æ®åº“">é»˜è®¤16ä¸ªæ•°æ®åº“</h3>
<ul>
<li>
<p>é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹è¡¨ä»é›¶å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨é›¶å·åº“ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨<code>select &lt;id&gt;</code>æ¥è¿æ¥æŒ‡å®šæ•°æ®åº“id</p>
</li>
</ul>
<figure data-type="image" tabindex="5"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509145022.png" alt="image-20200509145021853" loading="lazy"></figure>
<h3 id="dbsize">DBSIZE</h3>
<ul>
<li>DbsizeæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡</li>
</ul>
<pre><code class="language-shell">DBSIZE
</code></pre>
<figure data-type="image" tabindex="6"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509145149.png" alt="image-20200509145148783" loading="lazy"></figure>
<ul>
<li>ä½¿ç”¨<code>keys *</code>å¯æŸ¥çœ‹å½“å‰åº“ä¸­çš„key</li>
</ul>
<pre><code class="language-shell">keys *
</code></pre>
<figure data-type="image" tabindex="7"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509145301.png" alt="image-20200509145300027" loading="lazy"></figure>
<h3 id="flushdb"><strong>FLUSHDB</strong></h3>
<ul>
<li>æ¸…ç©ºå½“å‰åº“</li>
</ul>
<pre><code class="language-shell">FLUSHDB
</code></pre>
<figure data-type="image" tabindex="8"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509145519.png" alt="image-20200509145518458" loading="lazy"></figure>
<h3 id="flushall">FLUSHALL</h3>
<ul>
<li>é€šæ€å…¨éƒ¨åº“</li>
</ul>
<pre><code class="language-shell">FLUSHALL
</code></pre>
<figure data-type="image" tabindex="9"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509145941.png" alt="image-20200509145940266" loading="lazy"></figure>
<h3 id="ç»Ÿä¸€å¯†ç ç®¡ç†">ç»Ÿä¸€å¯†ç ç®¡ç†</h3>
<h3 id="ç´¢å¼•">ç´¢å¼•</h3>
<ul>
<li>Reidsç´¢å¼•éƒ½æ˜¯ä»é›¶å¼€å§‹</li>
</ul>
<h3 id="é»˜è®¤ç«¯å£">é»˜è®¤ç«¯å£</h3>
<ul>
<li>é»˜è®¤ç«¯å£æ˜¯6379</li>
</ul>
<h2 id="redisæ•°æ®ç±»å‹">Redisæ•°æ®ç±»å‹</h2>
<h3 id="redisçš„äº”å¤§æ•°æ®ç±»å‹">Redisçš„äº”å¤§æ•°æ®ç±»å‹</h3>
<h4 id="stringå­—ç¬¦ä¸²">Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</h4>
<p>Stringï¼ˆå­—ç¬¦ä¸²ï¼‰</p>
<p>stringæ˜¯redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸Memcachedä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚</p>
<p>stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ ã€‚</p>
<p>stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªredisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M</p>
<h4 id="hashå“ˆå¸Œç±»ä¼¼javaé‡Œçš„map">Hashï¼ˆå“ˆå¸Œï¼Œç±»ä¼¼javaé‡Œçš„Mapï¼‰</h4>
<p>Hashï¼ˆå“ˆå¸Œï¼‰<br>
Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚<br>
Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚</p>
<p>ç±»ä¼¼Javaé‡Œé¢çš„Map&lt;String,Object&gt;</p>
<h4 id="liståˆ—è¡¨">Listï¼ˆåˆ—è¡¨ï¼‰</h4>
<p>Listï¼ˆåˆ—è¡¨ï¼‰<br>
Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ å¯¼åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚<br>
å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªé“¾è¡¨</p>
<h4 id="seté›†åˆ">Setï¼ˆé›†åˆï¼‰</h4>
<p>Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒæ˜¯é€šè¿‡HashTableå®ç°å®ç°çš„ã€‚</p>
<h4 id="zsetsorted-setæœ‰åºé›†åˆ">Zset(sorted setï¼šæœ‰åºé›†åˆ)</h4>
<p>zset(sorted setï¼šæœ‰åºé›†åˆ)<br>
Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚<br>
ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚<br>
redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚</p>
<h3 id="å“ªé‡Œå»è·å¾—rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤">å“ªé‡Œå»è·å¾—rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤</h3>
<ul>
<li>Http://redisdoc.com/</li>
</ul>
<figure data-type="image" tabindex="10"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509163322.png" alt="image-20200509163320729" loading="lazy"></figure>
<figure data-type="image" tabindex="11"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509150946.png" alt="image-20200509150945470" loading="lazy"></figure>
<figure data-type="image" tabindex="12"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509163404.png" alt="image-20200509163403248" loading="lazy"></figure>
<figure data-type="image" tabindex="13"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509163452.png" alt="image-20200509163445728" loading="lazy"></figure>
<h3 id="redis-é”®key">Redis é”®(key)</h3>
<ul>
<li><strong>å¸¸ç”¨</strong></li>
</ul>
<figure data-type="image" tabindex="14"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509164137.png" alt="image-20200509164136826" loading="lazy"></figure>
<ul>
<li>
<p><strong>æ¡ˆä¾‹</strong></p>
<ul>
<li><code>keys *</code></li>
</ul>
<figure data-type="image" tabindex="15"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509164723.png" alt="image-20200509164721746" loading="lazy"></figure>
<ul>
<li><code>exists key</code>çš„åå­—ï¼Œåˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨ã€‚</li>
</ul>
<figure data-type="image" tabindex="16"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509164759.png" alt="image-20200509164758524" loading="lazy"></figure>
<ul>
<li><code>move key db</code>ï¼Œç§»åŠ¨å½“å‰åº“çš„keyåˆ°æŒ‡å®šçš„åº“ä¸­ã€‚</li>
</ul>
<figure data-type="image" tabindex="17"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509164846.png" alt="image-20200509164845216" loading="lazy"></figure>
<ul>
<li><code>expire key</code>ï¼Œç»™æŒ‡å®šçš„keyè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚</li>
</ul>
<figure data-type="image" tabindex="18"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509165816.png" alt="image-20200509165815934" loading="lazy"></figure>
<ul>
<li><code>ttl key</code>ï¼ŒæŸ¥çœ‹å½“å‰keyçš„è¿‡æœŸæ—¶é—´ï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸã€‚</li>
</ul>
<p>å½“keyè¿‡æœŸçš„æ—¶å€™ï¼Œä»£è¡¨å½“å‰keyçš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œæ‰€ä»¥åœ¨å½“å‰åº“ä¸­å°±ä¸å­˜åœ¨è¿™ä¸ªkeyã€‚</p>
<figure data-type="image" tabindex="19"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509165609.png" alt="image-20200509165607432" loading="lazy"></figure>
<ul>
<li><code>type key</code>ï¼ŒæŸ¥çœ‹å½“å‰çš„keyçš„ç±»å‹ã€‚</li>
</ul>
<figure data-type="image" tabindex="20"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509171236.png" alt="image-20200509171235161" loading="lazy"></figure>
<ul>
<li><code>del key</code>ï¼Œåˆ é™¤å½“å‰çš„key</li>
</ul>
<figure data-type="image" tabindex="21"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509171824.png" alt="image-20200509171823453" loading="lazy"></figure>
</li>
</ul>
<h3 id="rediså­—ç¬¦ä¸²string">Rediså­—ç¬¦ä¸²(String)</h3>
<ul>
<li><strong>å¸¸ç”¨</strong></li>
</ul>
<figure data-type="image" tabindex="22"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509163741.png" alt="image-20200509163740370" loading="lazy"></figure>
<figure data-type="image" tabindex="23"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509163758.png" alt="image-20200509163757223" loading="lazy"></figure>
<ul>
<li>
<p><strong>å•å€¼å•value</strong></p>
</li>
<li>
<p><strong>æ¡ˆä¾‹</strong></p>
<ul>
<li><code>set key value</code>ï¼Œè®¾ç½®ä¸€ä¸ªK,V</li>
</ul>
<figure data-type="image" tabindex="24"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509172150.png" alt="image-20200509172149069" loading="lazy"></figure>
<ul>
<li><code>get key</code>ï¼Œè·å–å½“å‰keyçš„valueå€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="25"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509172214.png" alt="image-20200509172212935" loading="lazy"></figure>
<ul>
<li><code>append key value</code>ï¼Œåœ¨æŒ‡å®škeyçš„valueå€¼åæ·»åŠ æŒ‡å®šçš„å€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="26"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509172309.png" alt="image-20200509172308003" loading="lazy"></figure>
<ul>
<li><code>strlen key</code>ï¼ŒæŸ¥è¯¢å½“å‰keyçš„é•¿åº¦ã€‚</li>
</ul>
<figure data-type="image" tabindex="27"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509172350.png" alt="image-20200509172348777" loading="lazy"></figure>
<ul>
<li><code>incr key</code>ï¼Œå¯¹å½“å‰çš„keyè¿›è¡Œé€’å¢ã€‚</li>
</ul>
<figure data-type="image" tabindex="28"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509172909.png" alt="image-20200509172908900" loading="lazy"></figure>
<ul>
<li><code>decr key</code>ï¼Œå¯¹å½“å‰çš„keyè¿›è¡Œé€’å‡ã€‚</li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="29"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509173003.png" alt="image-20200509173003082" loading="lazy"></figure>
<p><code>incrby key num</code>ï¼Œå¯¹å½“å‰çš„keyè¿›è¡ŒæŒ‡å®šæ•°å­—çš„é€’å¢ã€‚</p>
<figure data-type="image" tabindex="30"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509173838.png" alt="image-20200509173837831" loading="lazy"></figure>
<p><code>decrby key num</code>ï¼Œå¯¹å½“å‰çš„keyè¿›è¡ŒæŒ‡å®šæ•°å­—çš„é€’å‡ã€‚</p>
<figure data-type="image" tabindex="31"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509173919.png" alt="image-20200509173918434" loading="lazy"></figure>
<p>**æ³¨æ„ï¼š**ä¸€å®šè¦æ˜¯æ•°å­—æ‰èƒ½è¿›è¡ŒåŠ å‡ã€‚</p>
<p><code>getrange key start end</code>ï¼Œè·å–å½“å‰keyå­—ç¬¦ä¸²çš„æŒ‡å®šé•¿åº¦å†…å®¹ã€‚</p>
<figure data-type="image" tabindex="32"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509174324.png" alt="image-20200509174323706" loading="lazy"></figure>
<p><code>setrange key index str</code>ï¼Œè®¾ç½®å½“å‰keyå­—ç¬¦ä¸²æŒ‡å®šä¸‹æ ‡å¼€å§‹ï¼Œè®¾ç½®strå†…å®¹ã€‚</p>
<figure data-type="image" tabindex="33"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509174716.png" alt="image-20200509174714625" loading="lazy"></figure>
<p><code>setex key second value</code>setex(set with expire)ï¼Œè®¾ç½®K,Vï¼Œå¹¶è®¾ç½®åˆ°æœŸæ—¶é—´ã€‚</p>
<figure data-type="image" tabindex="34"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509175112.png" alt="image-20200509175111603" loading="lazy"></figure>
<p><code>setnx key value</code>ï¼Œsetnx(set if not exist)ï¼Œåªæœ‰å½“å‰keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè®¾ç½®keyçš„å€¼ã€‚</p>
<figure data-type="image" tabindex="35"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509175337.png" alt="image-20200509175336269" loading="lazy"></figure>
<p><code>mset key1 value1 key2 value2 key3 value3</code>ï¼Œè®¾ç½®å¤šä¸ªK,Vã€‚</p>
<figure data-type="image" tabindex="36"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509175550.png" alt="image-20200509175549643" loading="lazy"></figure>
<p><code>mget key1 key2 key3</code>ï¼Œè·å–å¤šä¸ªæŒ‡å®škeyçš„å€¼ã€‚</p>
<figure data-type="image" tabindex="37"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200509175651.png" alt="image-20200509175650583" loading="lazy"></figure>
<p><code>msetnx key1 value1 key2 value2 key3 value3</code>ï¼Œè®¾ç½®å¤šä¸ªå€¼ï¼Œå½“è®¾ç½®keyä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®æŒ‡å®škeyå€¼ï¼Œå¦‚æœä¸€ä¸ªä¸å­˜åœ¨ï¼Œåˆ™éƒ½ä¸è®¾ç½®ã€‚</p>
<figure data-type="image" tabindex="38"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200511174045.png" alt="" loading="lazy"></figure>
<h3 id="redisåˆ—è¡¨list">Redisåˆ—è¡¨(List)</h3>
<ul>
<li>å¸¸ç”¨</li>
</ul>
<figure data-type="image" tabindex="39"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200511175624.png" alt="image-20200511175622928" loading="lazy"></figure>
<figure data-type="image" tabindex="40"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200511175638.png" alt="image-20200511175637169" loading="lazy"></figure>
<ul>
<li>
<p>å•å€¼å¤švalue</p>
</li>
<li>
<p>æ¡ˆä¾‹</p>
<ul>
<li><code>lpush key value1 [value2]</code>ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ã€‚</li>
</ul>
</li>
</ul>
<figure data-type="image" tabindex="41"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200512213854.png" alt="image-20200512213850399" loading="lazy"></figure>
<p><code>rpush key value1 [value2]</code>ï¼Œåœ¨åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼</p>
<figure data-type="image" tabindex="42"><img src="D:%5C%E4%B8%AA%E4%BA%BA%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%5Credis%5Cupload%5Cimage-20200512214133456.png" alt="image-20200512214133456" loading="lazy"></figure>
<p><code>lrange key start end</code>ï¼Œè·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ </p>
<figure data-type="image" tabindex="43"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200512214536.png" alt="image-20200512214535408" loading="lazy"></figure>
<p><code>lpop key</code>ï¼Œç§»é™¤å¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p>
<figure data-type="image" tabindex="44"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200512215656.png" alt="image-20200512215655300" loading="lazy"></figure>
<p><code>rpop key</code>ï¼Œç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ ã€‚</p>
<figure data-type="image" tabindex="45"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200513121600.png" alt="image-20200513121559312" loading="lazy"></figure>
<p><code>lindex key index</code>ï¼Œæ ¹æ®ä¸‹æ ‡ï¼ŒæŸ¥è¯¢æ‰§è¡Œåˆ—è¡¨ä¸­çš„æ•°æ®ã€‚</p>
<figure data-type="image" tabindex="46"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200513122104.png" alt="image-20200513122102884" loading="lazy"></figure>
<p><code>llen key</code>ï¼ŒæŸ¥è¯¢æŒ‡å®šåˆ—è¡¨çš„é•¿åº¦</p>
<figure data-type="image" tabindex="47"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200513122214.png" alt="image-20200513122213323" loading="lazy"></figure>
<p><code>lrem key count value</code>ï¼Œç§»é™¤æŒ‡å®šåˆ—è¡¨æŒ‡å®šæ•°é‡çš„å€¼ã€‚</p>
<figure data-type="image" tabindex="48"><img src="https://cdn.jsdelivr.net/gh/zoengzihaam/ImgBed@master/images/20200513122536.png" alt="image-20200513122535830" loading="lazy"></figure>
<p><code>ltrim key start end</code>ï¼Œæˆªå–æŒ‡å®šåˆ—è¡¨çš„æŒ‡å®šä¸‹æ ‡å†…å®¹ï¼Œç„¶åèµ‹å€¼ç»™è¿™ä¸ªåˆ—è¡¨ã€‚</p>
<figure data-type="image" tabindex="49"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200513123043.png" alt="image-20200513123000885" loading="lazy"></figure>
<p><code>rpoplpush source destination</code>ï¼Œç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›ã€‚</p>
<figure data-type="image" tabindex="50"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518171755.png" alt="image-20200518170936054" loading="lazy"></figure>
<p><code>lset key index value</code>ï¼Œé€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼ã€‚</p>
<figure data-type="image" tabindex="51"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518172222.png" alt="image-20200518172221911" loading="lazy"></figure>
<p><code>linsert key before|after pivot value</code>ï¼Œåœ¨åˆ—è¡¨çš„å…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ ã€‚</p>
<figure data-type="image" tabindex="52"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518172734.png" alt="image-20200518172733735" loading="lazy"></figure>
<h3 id="redisé›†åˆset">Redisé›†åˆ(Set)</h3>
<ul>
<li>å¸¸ç”¨</li>
</ul>
<figure data-type="image" tabindex="53"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518173358.png" alt="image-20200518173357120" loading="lazy"></figure>
<ul>
<li>
<p>å•å€¼å¤švalue</p>
</li>
<li>
<p>æ¡ˆä¾‹</p>
<ul>
<li><code>sadd key member1 [member2]</code>ï¼Œå‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚</li>
</ul>
<figure data-type="image" tabindex="54"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518173952.png" alt="image-20200518173848658" loading="lazy"></figure>
<ul>
<li><code>smembers key</code>ï¼Œè¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜</li>
</ul>
<figure data-type="image" tabindex="55"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518174145.png" alt="image-20200518174144650" loading="lazy"></figure>
<ul>
<li><code>sismember key member</code>ï¼Œåˆ¤æ–­ member å…ƒç´ æ˜¯å¦æ˜¯é›†åˆkeyçš„æˆå‘˜ã€‚</li>
</ul>
<figure data-type="image" tabindex="56"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518174329.png" alt="image-20200518174328349" loading="lazy"></figure>
<ul>
<li><code>scard key</code>ï¼Œè·å–é›†åˆçš„æˆå‘˜æ•°</li>
</ul>
<figure data-type="image" tabindex="57"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518174531.png" alt="image-20200518174530718" loading="lazy"></figure>
<ul>
<li><code>srem key member1 [member2]</code>ï¼Œç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜</li>
</ul>
<figure data-type="image" tabindex="58"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518174653.png" alt="image-20200518174652704" loading="lazy"></figure>
<ul>
<li><code>srandmember key [count]</code>ï¼Œè¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªéšæœºæ•°ã€‚</li>
</ul>
<figure data-type="image" tabindex="59"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518174943.png" alt="image-20200518174941232" loading="lazy"></figure>
<ul>
<li><code>spop key</code>ï¼Œç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´ </li>
</ul>
<figure data-type="image" tabindex="60"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200518175932.png" alt="image-20200518175930355" loading="lazy"></figure>
<ul>
<li><code>smove key1 key2 member</code>ï¼Œå°†memberå…ƒç´ ä»key1é›†åˆç§»åŠ¨åˆ°key2é›†åˆã€‚</li>
</ul>
<figure data-type="image" tabindex="61"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519221958.png" alt="image-20200519221957915" loading="lazy"></figure>
<ul>
<li>
<p>æ•°å­¦é›†åˆç±»</p>
<ul>
<li><code>sdiff key1 [key2]</code>ï¼Œè¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†ã€‚ï¼ˆåœ¨ç¬¬ä¸€ä¸ªseté‡Œé¢è€Œä¸åœ¨åé¢ä»»ä½•ä¸€ä¸ªseté‡Œé¢çš„é¡¹ï¼‰</li>
</ul>
<figure data-type="image" tabindex="62"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519222408.png" alt="image-20200519222407399" loading="lazy"></figure>
<ul>
<li><code>sinter key1 [key2]</code>ï¼Œè¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†ã€‚</li>
</ul>
<figure data-type="image" tabindex="63"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519222629.png" alt="image-20200519222628138" loading="lazy"></figure>
<ul>
<li><code>sunion key1 [key2]</code>ï¼Œè¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†ã€‚</li>
</ul>
<figure data-type="image" tabindex="64"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519222823.png" alt="image-20200519222822998" loading="lazy"></figure>
</li>
</ul>
</li>
</ul>
<h3 id="rediså“ˆå¸Œhash">Rediså“ˆå¸Œ(Hash)</h3>
<ul>
<li>å¸¸ç”¨</li>
</ul>
<figure data-type="image" tabindex="65"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519223109.png" alt="image-20200519223106752" loading="lazy"></figure>
<ul>
<li>
<p>KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹ã€‚</p>
</li>
<li>
<p>æ¡ˆä¾‹</p>
<ul>
<li><code>hset key field value</code>ï¼Œå°†å“ˆå¸Œè¡¨keyä¸­ çš„å­—æ®µfieldçš„å€¼è®¾ä¸ºvalueã€‚</li>
</ul>
<figure data-type="image" tabindex="66"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519223639.png" alt="image-20200519223620338" loading="lazy"></figure>
<ul>
<li><code>hget key field</code>ï¼Œè·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šfieldå­—æ®µçš„å€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="67"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519223621.png" alt="image-20200519223620338" loading="lazy"></figure>
<ul>
<li><code>hmset key field1 value1 [field2 value2]</code>ï¼ŒåŒæ—¶å°†å¤šä¸ªfield-value(åŸŸ-å€¼)å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨keyä¸­ã€‚</li>
</ul>
<figure data-type="image" tabindex="68"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519224026.png" alt="image-20200519224025622" loading="lazy"></figure>
<ul>
<li><code>hgetall key</code>ï¼Œè·å¾—å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®škeyçš„æ‰€æœ‰å­—æ®µå’Œå€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="69"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519224211.png" alt="image-20200519224210926" loading="lazy"></figure>
<ul>
<li><code>hdel key field</code>ï¼Œåˆ é™¤å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­key æŒ‡å®šå­—æ®µã€‚</li>
</ul>
<figure data-type="image" tabindex="70"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519224352.png" alt="image-20200519224351205" loading="lazy"></figure>
<ul>
<li><code>hexists key field</code>ï¼ŒæŸ¥è¯¢å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨</li>
</ul>
<figure data-type="image" tabindex="71"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519224931.png" alt="image-20200519224930651" loading="lazy"></figure>
<ul>
<li><code>hkeys key</code>ï¼Œè·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ</li>
</ul>
<figure data-type="image" tabindex="72"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519225102.png" alt="image-20200519225101378" loading="lazy"></figure>
<ul>
<li><code>hvals keys</code>ï¼Œè·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="73"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519225150.png" alt="image-20200519225149340" loading="lazy"></figure>
<ul>
<li><code>hincrby key field increment</code>ï¼Œä¸ºå“ˆå¸Œè¡¨keyä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡incrementã€‚</li>
</ul>
<figure data-type="image" tabindex="74"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519225443.png" alt="image-20200519225442220" loading="lazy"></figure>
<ul>
<li><code>hincrbyfloat key field increment</code>ï¼Œä¸ºå“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå­—æ®µçš„æµ®ç‚¹æ•°å€¼åŠ ä¸Šå¢é‡incrementã€‚</li>
</ul>
<figure data-type="image" tabindex="75"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519225615.png" alt="image-20200519225614338" loading="lazy"></figure>
<ul>
<li><code>hsetnx key field value</code>ï¼Œåªæœ‰åœ¨å­—æ®µfieldä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®å“ˆå¸Œè¡¨å­—æ®µçš„å€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="76"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200519225935.png" alt="image-20200519225934654" loading="lazy"></figure>
</li>
</ul>
<h3 id="redisæœ‰åºé›†åˆzsetsorted-set">Redisæœ‰åºé›†åˆZset(sorted set)</h3>
<ul>
<li>å¸¸ç”¨</li>
</ul>
<figure data-type="image" tabindex="77"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521150248.png" alt="image-20200521150246364" loading="lazy"></figure>
<figure data-type="image" tabindex="78"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521151239.png" alt="image-20200521151229536" loading="lazy"></figure>
<ul>
<li>
<p>æ¡ˆä¾‹</p>
<ul>
<li><code>zadd key score1 member1 [score2 member2]</code>ï¼Œå‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°ã€‚</li>
</ul>
<figure data-type="image" tabindex="79"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521151041.png" alt="image-20200521151040926" loading="lazy"></figure>
<ul>
<li><code>zrangebyscore key start end</code>ï¼Œé€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚</li>
</ul>
<figure data-type="image" tabindex="80"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521152441.png" alt="image-20200521152440530" loading="lazy"></figure>
<ul>
<li><code>zrangebyscore key (start end</code>ï¼Œé€šè¿‡è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…(å¸¦æœ‰<code>(</code>ï¼Œè¯´æ˜ä¸åŒ…å«)çš„æˆå‘˜ã€‚</li>
</ul>
<figure data-type="image" tabindex="81"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521160141.png" alt="image-20200521160140065" loading="lazy"></figure>
<ul>
<li><code>zrem key member</code>ï¼Œæ ¹æ®å¯¹åº”çš„valueå€¼åˆ é™¤æœ‰åºé›†åˆä¸­çš„æˆå‘˜å…ƒç´ ã€‚</li>
</ul>
<figure data-type="image" tabindex="82"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521160744.png" alt="image-20200521160743971" loading="lazy"></figure>
<ul>
<li><code>zcard key</code>ï¼Œè·å¾—æœ‰åºåˆ—è¡¨ä¸­çš„æˆå‘˜æ•°ã€‚</li>
</ul>
<figure data-type="image" tabindex="83"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521163302.png" alt="image-20200521163301419" loading="lazy"></figure>
<ul>
<li><code>zcount key min max</code>ï¼ŒæŸ¥è¯¢åœ¨æœ‰åºåˆ—è¡¨ä¸­æŒ‡å®šåŒºé—´çš„æˆå‘˜æ•°ã€‚</li>
</ul>
<figure data-type="image" tabindex="84"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521163434.png" alt="image-20200521163426648" loading="lazy"></figure>
<ul>
<li><code>zrank key value</code>ï¼Œè·å–æŒ‡å®šæˆå‘˜åœ¨æœ‰åºåˆ—è¡¨ä¸­çš„ä¸‹æ ‡ã€‚</li>
</ul>
<figure data-type="image" tabindex="85"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521163702.png" alt="image-20200521163701613" loading="lazy"></figure>
<ul>
<li><code>zscore key value</code>ï¼Œè·å–æœ‰åºåˆ—è¡¨ä¸­æŒ‡å®šæˆå‘˜çš„å€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="86"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521163813.png" alt="image-20200521163813036" loading="lazy"></figure>
<ul>
<li><code>zrevrank key values</code>ï¼Œé€†åºè·å¾—ä¸‹æ ‡å€¼ã€‚</li>
</ul>
<figure data-type="image" tabindex="87"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521163956.png" alt="image-20200521163955191" loading="lazy"></figure>
</li>
</ul>
<h2 id="è§£æé…ç½®æ–‡ä»¶redisconf">è§£æé…ç½®æ–‡ä»¶redis.conf</h2>
<h3 id="1å®ƒåœ¨å“ª">1.å®ƒåœ¨å“ª</h3>
<ul>
<li>
<p>åœ°å€ã€‚</p>
<p>è¿›å…¥redisç›®å½•ä¸‹ï¼Œä½¿ç”¨<code>pwd</code>å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç›®å½•ã€‚</p>
</li>
</ul>
<figure data-type="image" tabindex="88"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521165404.png" alt="image-20200521165403592" loading="lazy"></figure>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆæ‹·è´å‡ºæ¥å•ç‹¬æ‰§è¡Œï¼Ÿ</p>
<p>é€šå¸¸ä¸ºäº†é…ç½®çš„å®‰å…¨ï¼Œæ”¾ç½®åœ¨åŸæ–‡ä»¶é…ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è¿è¡Œã€‚</p>
</li>
</ul>
<h3 id="2unitså•ä½">2.Unitså•ä½</h3>
<figure data-type="image" tabindex="89"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521165629.png" alt="image-20200521165628558" loading="lazy"></figure>
<h3 id="3includesåŒ…å«">3.INCLUDESåŒ…å«</h3>
<ul>
<li>å’Œå…¶ä»–é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡includesåŒ…å«ï¼Œredis.confå¯ä»¥ä½œä¸ºæ€»é—¸ï¼ŒåŒ…å«å…¶ä»–ã€‚</li>
</ul>
<figure data-type="image" tabindex="90"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521170957.png" alt="image-20200521170956374" loading="lazy"></figure>
<h3 id="4generalé€šç”¨">4.GENERALé€šç”¨</h3>
<h4 id="daemonize">daemonize</h4>
<ul>
<li>ä»‹ç»
<ul>
<li>Aã€redis.confé…ç½®æ–‡ä»¶ä¸­daemonizeå®ˆæŠ¤çº¿ç¨‹ï¼Œé»˜è®¤æ˜¯NOã€‚</li>
<li>Bã€daemonizeæ˜¯ç”¨æ¥æŒ‡å®šredisæ˜¯å¦è¦ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ã€‚</li>
</ul>
</li>
<li>daemonize è®¾ç½®yesæˆ–è€…noåŒºåˆ«
<ul>
<li><code>daemonize:yes</code>:redisé‡‡ç”¨çš„æ˜¯å•è¿›ç¨‹å¤šçº¿ç¨‹çš„æ¨¡å¼ã€‚å½“redis.confä¸­é€‰é¡¹daemonizeè®¾ç½®æˆyesæ—¶ï¼Œä»£è¡¨å¼€å¯å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œredisä¼šåœ¨åå°è¿è¡Œï¼Œå¹¶å°†è¿›ç¨‹pidå·å†™å…¥è‡³redis.confé€‰é¡¹pidfileè®¾ç½®çš„æ–‡ä»¶ä¸­ï¼Œæ­¤æ—¶rediså°†ä¸€ç›´è¿è¡Œï¼Œé™¤éæ‰‹åŠ¨killè¯¥è¿›ç¨‹ã€‚</li>
<li><code>daemonize:no</code>: å½“daemonizeé€‰é¡¹è®¾ç½®æˆnoæ—¶ï¼Œå½“å‰ç•Œé¢å°†è¿›å…¥redisçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œexitå¼ºåˆ¶é€€å‡ºæˆ–è€…å…³é—­è¿æ¥å·¥å…·(putty,xshellç­‰)éƒ½ä¼šå¯¼è‡´redisè¿›ç¨‹é€€å‡ºã€‚</li>
</ul>
</li>
</ul>
<h4 id="pidfile">Pidfile</h4>
<ul>
<li>å½“Redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedisé»˜è®¤ä¼šæŠŠpidå†™å…¥/var/run/redis.pidæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡pidfileæŒ‡å®šã€‚</li>
</ul>
<h4 id="port">Port</h4>
<ul>
<li>æŒ‡å®šRedisç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º6379ï¼Œä½œè€…åœ¨è‡ªå·±çš„ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆé€‰ç”¨6379ä½œä¸ºé»˜è®¤ç«¯å£ï¼Œå› ä¸º6379åœ¨æ‰‹æœºæŒ‰é”®ä¸ŠMERZå¯¹åº”çš„å·ç ï¼Œè€ŒMERZå–è‡ªæ„å¤§åˆ©æ­Œå¥³Alessia Merzçš„åå­—ã€‚</li>
</ul>
<h4 id="tcp-backlog">Tcp-backlog</h4>
<ul>
<li>
<p>æ–‡æ¡£è§£é‡Š</p>
<p>tcp-backlog<br>
è®¾ç½®tcpçš„backlogï¼Œbacklogå…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklogé˜Ÿåˆ—æ€»å’Œ=æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚<br>
åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½ éœ€è¦ä¸€ä¸ªé«˜backlogå€¼æ¥é¿å…æ…¢å®¢æˆ·ç«¯è¿æ¥é—®é¢˜ã€‚æ³¨æ„Linuxå†…æ ¸ä¼šå°†è¿™ä¸ªå€¼å‡å°åˆ°/proc/sys/net/core/somaxconnçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ç¡®è®¤å¢å¤§somaxconnå’Œtcp_max_syn_backlogä¸¤ä¸ªå€¼æ¥è¾¾åˆ°æƒ³è¦çš„æ•ˆæœã€‚</p>
</li>
</ul>
<h4 id="timeout">Timeout</h4>
<ul>
<li>å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿æ—¶é—´åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º0ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚</li>
</ul>
<h4 id="bind">Bind</h4>
<ul>
<li>ç»‘å®šçš„ä¸»æœºåœ°å€</li>
</ul>
<h4 id="tcp-keepalive">Tcp-keepalive</h4>
<ul>
<li>å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒKeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60ã€‚</li>
</ul>
<h4 id="loglevel">Loglevel</h4>
<ul>
<li>æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸ºnotice</li>
</ul>
<h4 id="logfile">Logfile</h4>
<ul>
<li>æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
</ul>
<h4 id="syslog-enabled">Syslog-enabled</h4>
<ul>
<li>æ˜¯å¦æŠŠæ—¥å¿—è¾“å‡ºåˆ°syslogä¸­ã€‚é»˜è®¤æ˜¯noã€‚</li>
</ul>
<h4 id="syslog-ident">Syslog-ident</h4>
<ul>
<li>æŒ‡å®šsyslogé‡Œçš„æ—¥å¿—æ ‡å¿—ã€‚é»˜è®¤æ˜¯redisã€‚</li>
</ul>
<h4 id="syslog-facility">Syslog-facility</h4>
<ul>
<li>æŒ‡å®šsyslogè®¾å¤‡ï¼Œå€¼å¯ä»¥æ˜¯USERæˆ–LOCAL0-LOCAL7ã€‚é»˜è®¤æ˜¯LOCAL0ã€‚</li>
</ul>
<h4 id="databases">Databases</h4>
<ul>
<li>è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°é‡ä¸º16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT <dbid>å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“idã€‚</li>
</ul>
<h3 id="5snapshottingå¿«ç…§">5.SNAPSHOTTINGå¿«ç…§</h3>
<h4 id="save">Save</h4>
<ul>
<li>save ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°</li>
</ul>
<p>RDBæ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„Snapshotï¼ŒRDBçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ï¼Œ<br>
é»˜è®¤<br>
æ˜¯1åˆ†é’Ÿå†…æ”¹äº†1ä¸‡æ¬¡ï¼Œ<br>
æˆ–5åˆ†é’Ÿå†…æ”¹äº†10æ¬¡ï¼Œ<br>
æˆ–15åˆ†é’Ÿå†…æ”¹äº†1æ¬¡ã€‚</p>
<figure data-type="image" tabindex="91"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525102515.png" alt="image-20200525102515280" loading="lazy"></figure>
<ul>
<li>ç¦ç”¨</li>
</ul>
<p>å¦‚æœæƒ³ç¦ç”¨RDBæŒä¹…åŒ–çš„ç­–ç•¥ï¼Œåªè¦ä¸è®¾ç½®ä»»ä½•saveæŒ‡ä»¤ï¼Œæˆ–è€…ç»™saveä¼ å…¥ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å‚æ•°ä¹Ÿå¯ä»¥ã€‚</p>
<figure data-type="image" tabindex="92"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525102536.png" alt="image-20200525102536487" loading="lazy"></figure>
<ul>
<li>å¦‚æœæƒ³å³å¯å¤‡ä»½ï¼Œä½¿ç”¨<code>save</code>å‘½ä»¤ï¼Œå¯æ‰§è¡Œç«‹å³å¤‡ä»½åŠŸèƒ½ã€‚</li>
</ul>
<h4 id="stop-writes-on-bgsave-error">Stop-writes-on-bgsave-error</h4>
<p>å¦‚æœé…ç½®æˆnoï¼Œè¡¨ç¤ºä½ ä¸åœ¨ä¹æ•°æ®ä¸ä¸€è‡´æˆ–è€…æœ‰å…¶ä»–çš„æ‰‹æ®µå‘ç°å’Œæ§åˆ¶ã€‚</p>
<figure data-type="image" tabindex="93"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525102558.png" alt="image-20200525102558301" loading="lazy"></figure>
<h4 id="rdbcompression">rdbcompression</h4>
<p>rdbcompressionï¼šå¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨<br>
LZFç®—æ³•è¿›è¡Œå‹ç¼©ã€‚å¦‚æœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½</p>
<h4 id="rdbchecksum">rdbchecksum</h4>
<h4 id="dbfilename">dbfilename</h4>
<h4 id="dir">dir</h4>
<h3 id="6replicationå¤åˆ¶">6.REPLICATIONå¤åˆ¶</h3>
<h3 id="7securityå®‰å…¨">7.SECURITYå®‰å…¨</h3>
<ul>
<li>è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆã€‚</li>
</ul>
<figure data-type="image" tabindex="94"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200521173800.png" alt="image-20200521173759042" loading="lazy"></figure>
<h3 id="8limitsé™åˆ¶">8.LIMITSé™åˆ¶</h3>
<h4 id="maxclients">Maxclients</h4>
<ul>
<li>è®¾ç½®redisåŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º10000ä¸ªå®¢æˆ·ç«¯ã€‚å½“ä½ <br>
æ— æ³•è®¾ç½®è¿›ç¨‹æ–‡ä»¶å¥æŸ„é™åˆ¶æ—¶ï¼Œredisä¼šè®¾ç½®ä¸ºå½“å‰çš„æ–‡ä»¶å¥æŸ„é™åˆ¶å€¼å‡å»32ï¼Œå› ä¸ºredisä¼šä¸ºè‡ª<br>
èº«å†…éƒ¨å¤„ç†é€»è¾‘ç•™ä¸€äº›å¥æŸ„å‡ºæ¥ã€‚å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredisåˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™<br>
äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡ºâ€œmax number of clients reachedâ€ä»¥ä½œå›åº”ã€‚</li>
</ul>
<h4 id="maxmemory">Maxmemory</h4>
<ul>
<li>
<p>è®¾ç½®rediså¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œrediså°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡maxmemory-policyæ¥æŒ‡å®šã€‚å¦‚æœredisæ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œ<br>
é‚£ä¹ˆredisåˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚SETã€LPUSHç­‰ã€‚</p>
<p>ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚GETç­‰ã€‚å¦‚æœä½ çš„redisæ˜¯ä¸»redisï¼ˆè¯´æ˜ä½ çš„redisæœ‰ä»redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯â€œä¸ç§»é™¤â€çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ ã€‚</p>
</li>
</ul>
<h4 id="maxmemory-policy">Maxmemory-policy</h4>
<ul>
<li>ï¼ˆ1ï¼‰volatile-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚</li>
<li>ï¼ˆ2ï¼‰allkeys-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyã€‚</li>
<li>ï¼ˆ3ï¼‰volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚</li>
<li>ï¼ˆ4ï¼‰allkeys-randomï¼šç§»é™¤éšæœºçš„keyã€‚</li>
<li>ï¼ˆ5ï¼‰volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„keyã€‚</li>
<li>ï¼ˆ6ï¼‰noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
<h4 id="maxmemory-samples">Maxmemory-samples</h4>
<ul>
<li>è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œ<br>
redisé»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ªkeyå¹¶é€‰æ‹©å…¶ä¸­LRUçš„é‚£ä¸ªã€‚</li>
</ul>
<h3 id="9append-only-modeè¿½åŠ ">9.APPEND ONLY MODEè¿½åŠ </h3>
<h4 id="appendonly">appendonly</h4>
<h4 id="appendfilename">appendfilename</h4>
<h4 id="appendfsync">Appendfsync</h4>
<figure data-type="image" tabindex="95"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525210259.png" alt="image-20200525210259806" loading="lazy"></figure>
<ul>
<li>Alwaysï¼šåŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜  æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½ã€‚</li>
<li>Everysecï¼šå‡ºå‚é»˜è®¤æ¨èï¼Œå¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•   å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±ã€‚</li>
<li>No</li>
</ul>
<h4 id="no-appendfsync-on-rewriteé‡å†™æ—¶æ˜¯å¦å¯ä»¥è¿ç”¨appendfsyncç”¨é»˜è®¤noå³å¯ä¿è¯æ•°æ®å®‰å…¨æ€§">No-appendfsync-on-rewriteï¼šé‡å†™æ—¶æ˜¯å¦å¯ä»¥è¿ç”¨Appendfsyncï¼Œç”¨é»˜è®¤noå³å¯ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚</h4>
<h4 id="auto-aof-rewrite-min-sizeè®¾ç½®é‡å†™çš„åŸºå‡†å€¼">Auto-aof-rewrite-min-sizeï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼</h4>
<h4 id="auto-aof-rewrite-percentageè®¾ç½®é‡å†™çš„åŸºå‡†å€¼">Auto-aof-rewrite-percentageï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼</h4>
<h2 id="redisçš„æŒä¹…åŒ–">Redisçš„æŒä¹…åŒ–</h2>
<h3 id="æ€»ä½“ä»‹ç»">æ€»ä½“ä»‹ç»</h3>
<h4 id="å®˜ç½‘ä»‹ç»">å®˜ç½‘ä»‹ç»</h4>
<figure data-type="image" tabindex="96"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200524221645.png" alt="image-20200524221645176" loading="lazy"></figure>
<h3 id="rdbredis-database">RDBï¼ˆRedis DataBaseï¼‰</h3>
<h4 id="å®˜ç½‘ä»‹ç»-2">å®˜ç½‘ä»‹ç»</h4>
<figure data-type="image" tabindex="97"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200524221834.png" alt="image-20200524221834175" loading="lazy"></figure>
<h4 id="æ˜¯ä»€ä¹ˆ">æ˜¯ä»€ä¹ˆï¼š</h4>
<ul>
<li>åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ<br>
ä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚</li>
<li>Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°<br>
ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚<br>
æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½<br>
å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹<br>
å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚</li>
</ul>
<h4 id="fork">Fork</h4>
<ul>
<li>Forkçš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰<br>
æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚</li>
</ul>
<h4 id="rdb-ä¿å­˜çš„æ˜¯dumprdbæ–‡ä»¶">Rdb ä¿å­˜çš„æ˜¯dump.rdbæ–‡ä»¶</h4>
<h4 id="é…ç½®ä½ç½®">é…ç½®ä½ç½®</h4>
<figure data-type="image" tabindex="98"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200524223800.png" alt="image-20200524223800247" loading="lazy"></figure>
<h4 id="å¦‚ä½•è§¦å‘rdbå¿«ç…§">å¦‚ä½•è§¦å‘RDBå¿«ç…§</h4>
<h5 id="é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®">é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®</h5>
<figure data-type="image" tabindex="99"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525104217.png" alt="image-20200525104217106" loading="lazy"></figure>
<ul>
<li>
<p>å†·æ‹·è´åé‡æ–°ä½¿ç”¨</p>
<p>å¯ä»¥cp dump.rdb dump_new.rdb</p>
</li>
</ul>
<h5 id="å‘½ä»¤saveæˆ–è€…æ˜¯bgsave">å‘½ä»¤saveæˆ–è€…æ˜¯bgsave</h5>
<ul>
<li>Saveï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡</li>
</ul>
<figure data-type="image" tabindex="100"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525104534.png" alt="image-20200525104534717" loading="lazy"></figure>
<ul>
<li>BGSAVEï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œ<br>
å¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚å¯ä»¥é€šè¿‡lastsave<br>
å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´</li>
</ul>
<h5 id="æ‰§è¡Œflushallå‘½ä»¤ä¹Ÿä¼šäº§ç”Ÿdumprdbæ–‡ä»¶ä½†é‡Œé¢æ˜¯ç©ºçš„æ— æ„ä¹‰">æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿdump.rdbæ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰</h5>
<h4 id="å¦‚ä½•æ¢å¤">å¦‚ä½•æ¢å¤</h4>
<ul>
<li>
<p>å°†å¤‡ä»½æ–‡ä»¶ (dump.rdb) ç§»åŠ¨åˆ° redis å®‰è£…ç›®å½•å¹¶å¯åŠ¨æœåŠ¡å³å¯</p>
</li>
<li>
<p>CONFIG GET dirè·å–ç›®å½•</p>
</li>
</ul>
<h4 id="ä¼˜åŠ¿">ä¼˜åŠ¿</h4>
<ul>
<li>é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤</li>
<li>å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜</li>
</ul>
<h4 id="åŠ£åŠ¿">åŠ£åŠ¿</h4>
<ul>
<li>åœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœredisæ„å¤–downæ‰çš„è¯ï¼Œå°±<br>
ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹</li>
<li>Forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘</li>
</ul>
<h4 id="å¦‚ä½•åœæ­¢">å¦‚ä½•åœæ­¢</h4>
<ul>
<li>åŠ¨æ€æ‰€æœ‰åœæ­¢RDBä¿å­˜è§„åˆ™çš„æ–¹æ³•ï¼šredis-cli config set save &quot;&quot;</li>
</ul>
<h4 id="å°æ€»ç»“">å°æ€»ç»“</h4>
<figure data-type="image" tabindex="101"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525105545.png" alt="image-20200525105545632" loading="lazy"></figure>
<h3 id="aofappend-only-file">AOFï¼ˆAppend Only Fileï¼‰</h3>
<h4 id="å®˜ç½‘ä»‹ç»-3">å®˜ç½‘ä»‹ç»</h4>
<figure data-type="image" tabindex="102"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525110108.png" alt="image-20200525110108706" loading="lazy"></figure>
<h4 id="æ˜¯ä»€ä¹ˆ-2">æ˜¯ä»€ä¹ˆï¼š</h4>
<blockquote>
<p><strong>ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œ</strong>ï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(è¯»æ“ä½œä¸è®°å½•)ï¼Œ<br>
åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ</p>
</blockquote>
<h4 id="aofä¿å­˜çš„æ˜¯appendonlyaofæ–‡ä»¶">Aofä¿å­˜çš„æ˜¯appendonly.aofæ–‡ä»¶</h4>
<h4 id="é…ç½®ä½ç½®-2">é…ç½®ä½ç½®</h4>
<figure data-type="image" tabindex="103"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525205831.png" alt="image-20200525205831351" loading="lazy"></figure>
<h4 id="aofå¯åŠ¨ä¿®å¤æ¢å¤">AOFå¯åŠ¨/ä¿®å¤/æ¢å¤</h4>
<h5 id="æ­£å¸¸æ¢å¤">æ­£å¸¸æ¢å¤</h5>
<ul>
<li>å¯åŠ¨ï¼šè®¾ç½®Yes</li>
<li>ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes</li>
<li>å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(config get dir)ã€‚</li>
<li>æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½ã€‚</li>
</ul>
<h5 id="å¼‚å¸¸æ¢å¤">å¼‚å¸¸æ¢å¤</h5>
<ul>
<li>å¯åŠ¨ï¼šè®¾ç½®Yes</li>
<li>ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyesã€‚</li>
<li>å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶</li>
<li>ä¿®å¤ï¼šRedis-check-aof --fixè¿›è¡Œä¿®å¤</li>
<li>æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½</li>
</ul>
<h4 id="rewrite">Rewrite</h4>
<figure data-type="image" tabindex="104"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525212540.png" alt="image-20200525212540047" loading="lazy"></figure>
<h5 id="æ˜¯ä»€ä¹ˆ-3">æ˜¯ä»€ä¹ˆï¼š</h5>
<blockquote>
<p>AOFé‡‡ç”¨æ–‡ä»¶è¿½åŠ æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†é‡å†™æœºåˆ¶,<br>
å½“AOFæ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRediså°±ä¼šå¯åŠ¨AOFæ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œ<br>
åªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†.å¯ä»¥ä½¿ç”¨å‘½ä»¤bgrewriteaof</p>
</blockquote>
<h5 id="é‡å†™åŸç†">é‡å†™åŸç†</h5>
<p>AOFæ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™(ä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå†rename)ï¼Œ<br>
éå†æ–°è¿›ç¨‹çš„å†…å­˜ä¸­æ•°æ®ï¼Œæ¯æ¡è®°å½•æœ‰ä¸€æ¡çš„Setè¯­å¥ã€‚é‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶ï¼Œ<br>
è€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶ï¼Œè¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚</p>
<h5 id="è§¦å‘æœºåˆ¶">è§¦å‘æœºåˆ¶</h5>
<p>Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘ã€‚</p>
<h4 id="ä¼˜åŠ¿-2">ä¼˜åŠ¿</h4>
<h5 id="æ¯ä¿®æ”¹åŒæ­¥">æ¯ä¿®æ”¹åŒæ­¥ï¼š</h5>
<p>appendfsync always   åŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜  æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½ã€‚</p>
<h5 id="æ¯ç§’åŒæ­¥">æ¯ç§’åŒæ­¥ï¼š</h5>
<p>appendfsync everysec    å¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•   å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±</p>
<h5 id="ä¸åŒæ­¥">ä¸åŒæ­¥ï¼š</h5>
<p>appendfsync no   ä»ä¸åŒæ­¥ã€‚</p>
<h4 id="åŠ£åŠ¿-2">åŠ£åŠ¿</h4>
<ol>
<li>ç›¸åŒæ•°æ®é›†çš„æ•°æ®è€Œè¨€aofæ–‡ä»¶è¦è¿œå¤§äºrdbæ–‡ä»¶ï¼Œæ¢å¤é€Ÿåº¦æ…¢äºrdbã€‚</li>
<li>Aofè¿è¡Œæ•ˆç‡è¦æ…¢äºrdb,æ¯ç§’åŒæ­¥ç­–ç•¥æ•ˆç‡è¾ƒå¥½ï¼Œä¸åŒæ­¥æ•ˆç‡å’Œrdbç›¸åŒã€‚</li>
</ol>
<h4 id="å°æ€»ç»“-2">å°æ€»ç»“</h4>
<figure data-type="image" tabindex="105"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525212854.png" alt="image-20200525212854369" loading="lazy"></figure>
<h3 id="æ€»ç»“which-one">æ€»ç»“(Which one)</h3>
<h4 id="å®˜ç½‘å»ºè®®">å®˜ç½‘å»ºè®®</h4>
<figure data-type="image" tabindex="106"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200525212951.png" alt="image-20200525212951704" loading="lazy"></figure>
<ol>
<li>
<p>RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨ã€‚</p>
</li>
<li>
<p>AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›<br>
å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾.<br>
Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§ã€‚</p>
</li>
<li>
<p>åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚</p>
</li>
<li>
<p>åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚</p>
<ul>
<li>åœ¨è¿™ç§æƒ…å†µä¸‹,å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®,<br>
å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚</li>
<li>RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿ<br>
ä½œè€…å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œ<br>
å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚</li>
</ul>
</li>
<li>
<p>æ€§èƒ½å»ºè®®ã€‚</p>
<ul>
<li>
<p>å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œåªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚</p>
<p>å¦‚æœEnalbe AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚ä»£ä»·ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚</p>
<p>å¦‚æœä¸Enable AOF ï¼Œä»…é Master-Slave Replication å®ç°é«˜å¯ç”¨æ€§ä¹Ÿå¯ä»¥ã€‚èƒ½çœæ‰ä¸€å¤§ç¬”IOä¹Ÿå‡å°‘äº†rewriteæ—¶å¸¦æ¥çš„ç³»ç»Ÿæ³¢åŠ¨ã€‚ä»£ä»·æ˜¯å¦‚æœMaster/SlaveåŒæ—¶å€’æ‰ï¼Œä¼šä¸¢å¤±åå‡ åˆ†é’Ÿçš„æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬ä¹Ÿè¦æ¯”è¾ƒä¸¤ä¸ªMaster/Slaveä¸­çš„RDBæ–‡ä»¶ï¼Œè½½å…¥è¾ƒæ–°çš„é‚£ä¸ªã€‚æ–°æµªå¾®åšå°±é€‰ç”¨äº†è¿™ç§æ¶æ„ã€‚</p>
</li>
</ul>
</li>
</ol>
<h2 id="redisçš„äº‹åŠ¡">Redisçš„äº‹åŠ¡</h2>
<h3 id="æ˜¯ä»€ä¹ˆ-4">æ˜¯ä»€ä¹ˆ</h3>
<blockquote>
<p>å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­çš„<br>
æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ï¼ŒæŒ‰é¡ºåºåœ°ä¸²è¡ŒåŒ–æ‰§è¡Œè€Œä¸ä¼šè¢«å…¶å®ƒå‘½ä»¤æ’å…¥ï¼Œä¸è®¸åŠ å¡ã€‚</p>
</blockquote>
<ul>
<li>å®˜ç½‘</li>
</ul>
<figure data-type="image" tabindex="107"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095415.png" alt="image-20200526095415167" loading="lazy"></figure>
<h3 id="èƒ½å¹²å˜›">èƒ½å¹²å˜›</h3>
<ul>
<li>ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ã€‚</li>
</ul>
<h3 id="æ€ä¹ˆç©">æ€ä¹ˆç©</h3>
<figure data-type="image" tabindex="108"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095448.png" alt="image-20200526095448303" loading="lazy"></figure>
<h4 id="å¸¸ç”¨å‘½ä»¤">å¸¸ç”¨å‘½ä»¤</h4>
<figure data-type="image" tabindex="109"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095615.png" alt="image-20200526095615512" loading="lazy"></figure>
<h4 id="case1æ­£å¸¸æ‰§è¡Œ">Case1ï¼šæ­£å¸¸æ‰§è¡Œ</h4>
<figure data-type="image" tabindex="110"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095635.png" alt="image-20200526095635884" loading="lazy"></figure>
<h4 id="case2æ”¾å¼ƒäº‹åŠ¡">Case2ï¼šæ”¾å¼ƒäº‹åŠ¡</h4>
<figure data-type="image" tabindex="111"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095644.png" alt="image-20200526095644734" loading="lazy"></figure>
<h4 id="case3å…¨ä½“è¿å">Case3ï¼šå…¨ä½“è¿å</h4>
<figure data-type="image" tabindex="112"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095652.png" alt="image-20200526095652384" loading="lazy"></figure>
<h4 id="case4å†¤å¤´å€ºä¸»">Case4ï¼šå†¤å¤´å€ºä¸»</h4>
<figure data-type="image" tabindex="113"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526095701.png" alt="image-20200526095701700" loading="lazy"></figure>
<h4 id="case5watchç›‘æ§">Case5ï¼šwatchç›‘æ§</h4>
<ol>
<li>
<p>æ‚²è§‚é”/ä¹è§‚é”/CAS(Check And Set)</p>
<ul>
<li>
<p>æ‚²è§‚é”</p>
<p>æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</p>
</li>
<li>
<p>ä¹è§‚é”</p>
<p>ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œ</p>
<p>ä¹è§‚é”ç­–ç•¥:æäº¤ç‰ˆæœ¬å¿…é¡»å¤§äºè®°å½•å½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–°ã€‚</p>
</li>
<li>
<p>CAS</p>
</li>
</ul>
</li>
<li>
<p>åˆå§‹åŒ–ä¿¡ç”¨å¡å¯ç”¨ä½™é¢å’Œæ¬ é¢</p>
<figure data-type="image" tabindex="114"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526100000.png" alt="image-20200526095959959" loading="lazy"></figure>
</li>
<li>
<p>æ— åŠ å¡ç¯¡æ”¹ï¼Œå…ˆç›‘æ§å†å¼€å¯multiï¼Œä¿è¯ä¸¤ç¬”é‡‘é¢å˜åŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ã€‚</p>
<figure data-type="image" tabindex="115"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526100012.png" alt="image-20200526100012139" loading="lazy"></figure>
</li>
<li>
<p>æœ‰åŠ å¡ç¯¡æ”¹ã€‚</p>
<figure data-type="image" tabindex="116"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526100020.png" alt="image-20200526100020441" loading="lazy"></figure>
</li>
<li>
<p>unwatch</p>
<figure data-type="image" tabindex="117"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526100028.png" alt="image-20200526100028027" loading="lazy"></figure>
</li>
<li>
<p>ä¸€æ—¦æ‰§è¡Œäº†execä¹‹å‰åŠ çš„ç›‘æ§é”éƒ½ä¼šè¢«å–æ¶ˆæ‰äº†</p>
</li>
<li>
<p>å°ç»“</p>
<ul>
<li>WatchæŒ‡ä»¤ï¼Œç±»ä¼¼ä¹è§‚é”ï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œå¦‚æœKeyçš„å€¼å·²è¢«åˆ«çš„å®¢æˆ·ç«¯æ”¹å˜ï¼Œ<br>
æ¯”å¦‚æŸä¸ªlistå·²è¢«åˆ«çš„å®¢æˆ·ç«¯push/popè¿‡äº†ï¼Œæ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚</li>
<li>é€šè¿‡WATCHå‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ç›‘æ§äº†å¤šä¸ªKeysï¼Œå€˜è‹¥åœ¨WATCHä¹‹åæœ‰ä»»ä½•Keyçš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œ<br>
EXECå‘½ä»¤æ‰§è¡Œçš„äº‹åŠ¡éƒ½å°†è¢«æ”¾å¼ƒï¼ŒåŒæ—¶è¿”å›Nullmulti-bulkåº”ç­”ä»¥é€šçŸ¥è°ƒç”¨è€…äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚</li>
</ul>
</li>
</ol>
<h3 id="3é˜¶æ®µ">3é˜¶æ®µ</h3>
<h4 id="å¼€å¯">å¼€å¯ï¼š</h4>
<p>ä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ã€‚</p>
<h4 id="å…¥é˜Ÿ">å…¥é˜Ÿï¼š</h4>
<p>å°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢</p>
<h4 id="æ‰§è¡Œ">æ‰§è¡Œï¼š</h4>
<p>ç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡</p>
<h3 id="3ç‰¹æ€§">3ç‰¹æ€§</h3>
<h4 id="å•ç‹¬çš„éš”ç¦»æ“ä½œ">å•ç‹¬çš„éš”ç¦»æ“ä½œï¼š</h4>
<p>äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚</p>
<h4 id="æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ">æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼š</h4>
<p>é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…çš„è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œï¼Œ<br>
ä¹Ÿå°±ä¸å­˜åœ¨â€äº‹åŠ¡å†…çš„æŸ¥è¯¢è¦çœ‹åˆ°äº‹åŠ¡é‡Œçš„æ›´æ–°ï¼Œåœ¨äº‹åŠ¡å¤–æŸ¥è¯¢ä¸èƒ½çœ‹åˆ°â€è¿™ä¸ªè®©äººä¸‡åˆ†å¤´ç—›çš„é—®é¢˜</p>
<h4 id="ä¸ä¿è¯åŸå­æ€§">ä¸ä¿è¯åŸå­æ€§ï¼š</h4>
<p>redisåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š</p>
<h2 id="redisçš„å‘å¸ƒè®¢é˜…">Redisçš„å‘å¸ƒè®¢é˜…</h2>
<h3 id="æ˜¯ä»€ä¹ˆ-5">æ˜¯ä»€ä¹ˆ</h3>
<ol>
<li>
<p>è¿›ç¨‹é—´çš„ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚</p>
</li>
<li>
<p>è®¢é˜…/å‘å¸ƒæ¶ˆæ¯å›¾</p>
<figure data-type="image" tabindex="118"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526215652.png" alt="image-20200526215652277" loading="lazy"></figure>
</li>
</ol>
<h3 id="å‘½ä»¤">å‘½ä»¤</h3>
<figure data-type="image" tabindex="119"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526215703.png" alt="image-20200526215703858" loading="lazy"></figure>
<h3 id="æ¡ˆä¾‹">æ¡ˆä¾‹</h3>
<p>å…ˆè®¢é˜…åå‘å¸ƒåæ‰èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œ</p>
<ol>
<li>
<p>å¯ä»¥ä¸€æ¬¡æ€§è®¢é˜…å¤šä¸ªï¼ŒSUBSCRIBE c1 c2 c3</p>
<figure data-type="image" tabindex="120"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526222020.png" alt="image-20200526222020051" loading="lazy"></figure>
</li>
<li>
<p>æ¶ˆæ¯å‘å¸ƒï¼ŒPUBLISH c2 hello-redis</p>
<figure data-type="image" tabindex="121"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526222036.png" alt="image-20200526222036785" loading="lazy"></figure>
</li>
<li>
<p>è®¢é˜…å¤šä¸ªï¼Œé€šé…ç¬¦<code>*</code>ï¼Œ PSUBSCRIBE new<code>*</code></p>
<figure data-type="image" tabindex="122"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526221924.png" alt="image-20200526221924183" loading="lazy"></figure>
<figure data-type="image" tabindex="123"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200526221950.png" alt="image-20200526221950753" loading="lazy"></figure>
</li>
<li>
<p>æ”¶å–æ¶ˆæ¯ï¼Œ PUBLISH new1 redis2015ã€‚</p>
</li>
</ol>
<h2 id="redisçš„å¤åˆ¶masterslave">Redisçš„å¤åˆ¶(Master/Slave)</h2>
<h3 id="æ˜¯ä»€ä¹ˆ-6">æ˜¯ä»€ä¹ˆ</h3>
<h4 id="å®˜ç½‘">å®˜ç½‘</h4>
<figure data-type="image" tabindex="124"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528123047.png" alt="image-20200528123047616" loading="lazy"></figure>
<h4 id="è¡Œè¯">è¡Œè¯ï¼š</h4>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ä¸»ä»å¤åˆ¶ï¼Œä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œ<br>
è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„master/slaveræœºåˆ¶ï¼ŒMasterä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸»</p>
<h3 id="èƒ½å¹²å˜›-2">èƒ½å¹²å˜›</h3>
<ul>
<li>è¯»å†™åˆ†ç¦»</li>
<li>å®¹ç¾æ¢å¤</li>
</ul>
<h3 id="æ€ä¹ˆç©-2">æ€ä¹ˆç©</h3>
<ol>
<li>
<p>é…ä»(åº“)ä¸é…ä¸»(åº“)</p>
</li>
<li>
<p>ä»åº“é…ç½®ï¼šslaveof ä¸»åº“IP ä¸»åº“ç«¯å£</p>
<ul>
<li>æ¯æ¬¡ä¸masteræ–­å¼€ä¹‹åï¼Œéƒ½éœ€è¦é‡æ–°è¿æ¥ï¼Œé™¤éä½ é…ç½®è¿›redis.confæ–‡ä»¶</li>
<li>Info replication</li>
</ul>
</li>
<li>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶ç»†èŠ‚æ“ä½œ</p>
<ul>
<li>
<p>æ‹·è´å¤šä¸ªredis.confæ–‡ä»¶</p>
<figure data-type="image" tabindex="125"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528153928.png" alt="image-20200528153928372" loading="lazy"></figure>
</li>
<li>
<p>å¼€å¯daemonize yes</p>
<figure data-type="image" tabindex="126"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528153937.png" alt="image-20200528153937412" loading="lazy"></figure>
</li>
<li>
<p>Pidæ–‡ä»¶åå­—</p>
</li>
<li>
<p>æŒ‡å®šç«¯å£</p>
</li>
<li>
<p>Logæ–‡ä»¶åå­—</p>
<figure data-type="image" tabindex="127"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528153945.png" alt="image-20200528153945398" loading="lazy"></figure>
</li>
<li>
<p>Dump.rdbåå­—</p>
<figure data-type="image" tabindex="128"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528153953.png" alt="image-20200528153953166" loading="lazy"></figure>
</li>
</ul>
</li>
<li>
<p>å¸¸ç”¨3æ‹›</p>
<ul>
<li>
<p>ä¸€ä¸»äºŒä»†</p>
<ul>
<li>
<p>Init</p>
<figure data-type="image" tabindex="129"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154124.png" alt="image-20200528154124055" loading="lazy"></figure>
</li>
<li>
<p>ä¸€ä¸ªMasterä¸¤ä¸ªSlave</p>
<figure data-type="image" tabindex="130"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154134.png" alt="image-20200528154134404" loading="lazy"></figure>
</li>
<li>
<p>æ—¥å¿—æŸ¥çœ‹</p>
<ul>
<li>
<p>ä¸»æœºæ—¥å¿—</p>
<figure data-type="image" tabindex="131"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154206.png" alt="image-20200528154206334" loading="lazy"></figure>
</li>
<li>
<p>å¤‡æœºæ—¥å¿—</p>
<figure data-type="image" tabindex="132"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154214.png" alt="image-20200528154214600" loading="lazy"></figure>
</li>
<li>
<p>info replication</p>
</li>
</ul>
<figure data-type="image" tabindex="133"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154222.png" alt="image-20200528154221980" loading="lazy"></figure>
</li>
<li>
<p>ä¸»ä»é—®é¢˜æ¼”ç¤º</p>
<ol>
<li>
<p>åˆ‡å…¥ç‚¹é—®é¢˜ï¼Ÿslave1ã€slave2æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶è¿˜æ˜¯ä»åˆ‡å…¥ç‚¹å¼€å§‹å¤åˆ¶?æ¯”å¦‚ä»k4è¿›æ¥ï¼Œé‚£ä¹‹å‰çš„123æ˜¯å¦ä¹Ÿå¯ä»¥å¤åˆ¶</p>
</li>
<li>
<p>ä»æœºæ˜¯å¦å¯ä»¥å†™ï¼Ÿsetå¯å¦ï¼Ÿ</p>
</li>
<li>
<p>ä¸»æœºshutdownåæƒ…å†µå¦‚ä½•ï¼Ÿä»æœºæ˜¯ä¸Šä½è¿˜æ˜¯åŸåœ°å¾…å‘½</p>
</li>
<li>
<p>ä¸»æœºåˆå›æ¥äº†åï¼Œä¸»æœºæ–°å¢è®°å½•ï¼Œä»æœºè¿˜èƒ½å¦é¡ºåˆ©å¤åˆ¶ï¼Ÿ</p>
</li>
<li>
<p>å…¶ä¸­ä¸€å°ä»æœºdownåæƒ…å†µå¦‚ä½•ï¼Ÿä¾ç…§åŸæœ‰å®ƒèƒ½è·Ÿä¸Šå¤§éƒ¨é˜Ÿå—ï¼Ÿ</p>
</li>
</ol>
</li>
</ul>
</li>
<li>
<p>è–ªç«ç›¸ä¼ </p>
<ul>
<li>ä¸Šä¸€ä¸ªSlaveå¯ä»¥æ˜¯ä¸‹ä¸€ä¸ªslaveçš„Masterï¼ŒSlaveåŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»–<br>
slavesçš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥slaveä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„master,<br>
å¯ä»¥æœ‰æ•ˆå‡è½»masterçš„å†™å‹åŠ›</li>
<li>ä¸­é€”å˜æ›´è½¬å‘:ä¼šæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œé‡æ–°å»ºç«‹æ‹·è´æœ€æ–°çš„</li>
<li>Slaveof æ–°ä¸»åº“IP æ–°ä¸»åº“ç«¯å£</li>
</ul>
</li>
<li>
<p>åå®¢ä¸ºä¸»</p>
<ul>
<li>
<p>SLAVEOF no one</p>
<p>ä½¿å½“å‰æ•°æ®åº“åœæ­¢ä¸å…¶ä»–æ•°æ®åº“çš„åŒæ­¥ï¼Œè½¬æˆä¸»æ•°æ®åº“ã€‚</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="å¤åˆ¶åŸç†">å¤åˆ¶åŸç†</h3>
<ul>
<li>Slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤</li>
<li>Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ<br>
åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥</li>
<li>å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚</li>
<li>å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥</li>
<li>ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ</li>
</ul>
<h3 id="å“¨å…µæ¨¡å¼sentinel">å“¨å…µæ¨¡å¼(sentinel)</h3>
<ul>
<li><strong>æ˜¯ä»€ä¹ˆ</strong></li>
</ul>
<blockquote>
<p>åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“</p>
</blockquote>
<ul>
<li>
<p><strong>æ€ä¹ˆç©(ä½¿ç”¨æ­¥éª¤)</strong></p>
<ol>
<li>
<p>è°ƒæ•´ç»“æ„ï¼Œ6379å¸¦ç€80ã€81</p>
</li>
<li>
<p>è‡ªå®šä¹‰çš„/myredisç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œåå­—ç»ä¸èƒ½é”™</p>
</li>
<li>
<p>é…ç½®å“¨å…µ,å¡«å†™å†…å®¹</p>
<ul>
<li>sentinel monitor è¢«ç›‘æ§æ•°æ®åº“åå­—(è‡ªå·±èµ·åå­—) 127.0.0.1 6379 1</li>
</ul>
<figure data-type="image" tabindex="134"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154601.png" alt="image-20200528154601200" loading="lazy"></figure>
<ul>
<li>ä¸Šé¢æœ€åä¸€ä¸ªæ•°å­—1ï¼Œè¡¨ç¤ºä¸»æœºæŒ‚æ‰åsalveæŠ•ç¥¨çœ‹è®©è°æ¥æ›¿æˆä¸ºä¸»æœºï¼Œå¾—ç¥¨æ•°å¤šå°‘åæˆä¸ºä¸»æœº</li>
</ul>
</li>
<li>
<p>å¯åŠ¨å“¨å…µ</p>
<figure data-type="image" tabindex="135"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154623.png" alt="image-20200528154623843" loading="lazy"></figure>
<ul>
<li>Redis-sentinel /myredis/sentinel.conf</li>
<li>ä¸Šè¿°ç›®å½•ä¾ç…§å„è‡ªçš„å®é™…æƒ…å†µé…ç½®ï¼Œå¯èƒ½ç›®å½•ä¸åŒ</li>
</ul>
</li>
<li>
<p>æ­£å¸¸ä¸»ä»æ¼”ç¤º</p>
</li>
<li>
<p>åŸæœ‰çš„masteræŒ‚äº†</p>
<figure data-type="image" tabindex="136"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154633.png" alt="image-20200528154633113" loading="lazy"></figure>
</li>
<li>
<p>æŠ•ç¥¨æ–°é€‰</p>
<figure data-type="image" tabindex="137"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154642.png" alt="image-20200528154642029" loading="lazy"></figure>
</li>
<li>
<p>é‡æ–°ä¸»ä»ç»§ç»­å¼€å·¥,info replicationæŸ¥æŸ¥çœ‹</p>
<figure data-type="image" tabindex="138"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154649.png" alt="image-20200528154649299" loading="lazy"></figure>
</li>
<li>
<p>é—®é¢˜ï¼šå¦‚æœä¹‹å‰çš„masteré‡å¯å›æ¥ï¼Œä¼šä¸ä¼šåŒmasterå†²çªï¼Ÿ</p>
<figure data-type="image" tabindex="139"><img src="https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20200528154703.png" alt="image-20200528154703002" loading="lazy"></figure>
</li>
</ol>
</li>
<li>
<p>ä¸€ç»„sentinelèƒ½åŒæ—¶ç›‘æ§å¤šä¸ªMaster</p>
</li>
</ul>
<h3 id="å¤åˆ¶çš„ç¼ºç‚¹">å¤åˆ¶çš„ç¼ºç‚¹</h3>
<ul>
<li>
<p>å¤åˆ¶å»¶æ—¶</p>
<p>ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°Slaveæœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚</p>
</li>
</ul>
]]></content>
    </entry>
</feed>