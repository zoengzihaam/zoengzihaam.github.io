<html>

<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>
    å·æ¯›
</title>
<link rel="shortcut icon" href="https://zoengzihaam.github.io/favicon.ico?v=1610626506137">
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> -->
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zoengzihaam.github.io/styles/main.css">
<!-- js -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script src="https://zoengzihaam.github.io/media/js/jquery.sticky-sidebar.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>


</head>

<body>
    <div class="main">
        <div class="header">
    <div class="nav">
        <div class="logo">
            <a href="https://zoengzihaam.github.io">
                <img class="avatar" src="https://zoengzihaam.github.io/images/avatar.png?v=1610626506137" alt="">
            </a>
            <div class="site-title">
                <h1>
                    å·æ¯›
                </h1>
            </div>
        </div>
        <span class="menu-btn fa fa-align-justify"></span>
        <div class="menu-container">
            <ul>
                
                    
                            <li>
                                <a href="/" class="menu">
                                    é¦–é¡µ
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/archives" class="menu">
                                    å½’æ¡£
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/tags" class="menu">
                                    æ ‡ç­¾
                                </a>
                            </li>
                            
                                
                    
                            <li>
                                <a href="/post/about" class="menu">
                                    å…³äº
                                </a>
                            </li>
                            
                                
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        $(".menu-btn").click(function() {
            $(".menu-container").slideToggle();
        });
        $(window).resize(function() {

            if (window.matchMedia('(min-width: 960px)').matches) {
                $(".menu-container").css('display', 'block')
            } else {
                $(".menu-container").css('display', 'none')
            }

        });
    });
</script>

            <div id="main-content" class="post-container main-container">
                <div id="content" class="main-container-left">
                    
        
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/netflixdns-jie-suo/">
                        NetflixDNSè§£é”
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2021-01-12</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/g80SHtBSX/" class="post-tag i-tag
                            i-tag-error">
            #Netflix
        </a>
                        
                        <a href="https://zoengzihaam.github.io/tag/nT7uo7T7GH/" class="post-tag i-tag
                            i-tag-other_3">
            #VPS
        </a>
                        
                </div>
                <div class="post-article">
                    
                        <a href="https://zoengzihaam.github.io/post/netflixdns-jie-suo/" class="post-feature-image" style="background-image:url(https://gitee.com/zoengzihaam/ImgBed/raw/master/images/20210114201328.jpg) ">
                        </a>
                        
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            NetflixDNSè§£é”

ç”±äºNetflixçš„ç‰ˆæƒé—®é¢˜ï¼Œä½¿ç”¨ä¸€èˆ¬çš„ä»£ç†æœåŠ¡è·¨åŒºçœ‹å‰§æ—¶ä¼šè¢« Netflix æ£€æµ‹åˆ°å¹¶é˜»æ­¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨çš„vpsä¸èƒ½è§‚çœ‹Netflixçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©è´­ä¹°ä¾¿å®œå¤§ç¢—çš„vpsæ¥è¾…åŠ©è§£é”ä¸èƒ½æŸ¥çœ‹Netflixçš„vpsã€‚

å‡†å¤‡å·¥ä½œ
æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›åŸºæœ¬çš„å‡†å¤‡ï¼Œä½ è‡³å°‘éœ€è¦è¿™äº›ä¸œè¥¿ï¼š

æ”¯æŒ Netflix çš„ä»£ç†æœåŠ¡
ä¸æ”¯æŒ Netflix çš„ä»£ç†æœåŠ¡
Netflixè®¢é˜…

å°±ç›®å‰è€Œè¨€ï¼Œç¾åŒºåº”è¯¥æ˜¯ç›®å‰å‰§é›†èµ„æºæœ€ä¸°å¯Œçš„åœ°åŒºï¼Œä½†æ˜¯æ ¹æ®æœ¬äººäº²æµ‹ï¼Œç¾åŒºçš„èµ„æºå¹¶ä¸ç¬¦åˆå›½äººçš„è§‚çœ‹é£æ ¼ï¼Œä¸ªäººæ¯”è¾ƒæ¨èé¦™æ¸¯ã€‚
ä½¿ç”¨Dnsmasqè§£é”Netflixï¼ˆå¥ˆé£ï¼‰æµåª’ä½“æœåŠ¡
è¿™é‡Œå€ŸåŠ©äº†èŒç²¾çµ çš„è„šæœ¬å®ç°ï¼Œè¿™é‡Œæ„Ÿè°¢èŒç²¾çµã€‚
å®‰è£…æ–¹æ³•ï¼š
æ”¯æŒ Netflix çš„ä»£ç†vpså®‰è£…
wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh &amp;amp;&amp;amp; bash dnsmasq_sniproxy.sh -f

å¸è½½æ–¹æ³•ï¼š
wget --no-check-certificate -O dnsmasq_sniproxy.sh https://raw.githubusercontent.com/myxuchangbin/dnsmasq_sniproxy_install/master/dnsmasq_sniproxy.sh &amp;amp;&amp;amp; bash dnsmasq_sniproxy.sh -u

ä½¿ç”¨æ–¹æ³•ï¼š
å°†ä¸æ”¯æŒ Netflix çš„ä»£ç†VPSçš„DNSåœ°å€ä¿®æ”¹ä¸ºæ”¯æŒ Netflix çš„ä»£ç†vpsçš„IPå°±å¯ä»¥äº†ï¼Œå¦‚æœä¸èƒ½ç”¨ï¼Œè®°å¾—åªä¿ç•™ä¸€ä¸ªDNSåœ°å€è¯•ä¸€ä¸‹ã€‚
âš ï¸ï¼šé˜²æ­¢æ»¥ç”¨ï¼Œå»ºè®®ä¸è¦éšæ„å…¬å¸ƒIPåœ°å€ï¼Œæˆ–ä½¿ç”¨é˜²ç«å¢™åšå¥½é™åˆ¶å·¥ä½œã€‚
è°ƒè¯•æ’é”™ï¼š

ç¡®è®¤sniproxyæœ‰æ•ˆè¿è¡Œ

é‡å¯sniå‘½ä»¤ï¼šsystemctl restart sniproxy
å¦‚æœsniä¸åœ¨è¿è¡Œï¼Œå¯æ£€æŸ¥é…ç½®/etc/sniproxy.confï¼Œé¿å…ssã€nginxæˆ–è€…å…¶ä»–ç¨‹åºç›‘å¬80,443ï¼Œå¯å°†å…¶é…ç½®æ–‡ä»¶çš„80æ›´æ”¹ä¸º801ç­‰ã€‚ 443ç«¯å£å¿…é¡»ç»™sniç›‘å¬æ”¾è¡Œï¼ŒæŸ¥çœ‹ï¼šnetstat -tlunp|grep 443

ç¡®è®¤é˜²ç«å¢™æ”¾è¡Œ443,53

è°ƒè¯•å¯ç›´æ¥å…³é—­é˜²ç«å¢™ systemctl stop firewalld.service
é˜¿é‡Œäº‘/è°·æ­Œäº‘/AWSç­‰å¤–éƒ¨é˜²ç«å¢™æ”¾è¡Œ å¯é€šè¿‡å…¶ä»–æœåŠ¡å™¨ telnet vpsip 53 ä»¥åŠ telnet vpsip 443 è¿›è¡Œæµ‹è¯•

è§£æåŸŸå

å°è¯•ç”¨å…¶ä»–æœåŠ¡å™¨é…ç½®å®Œæ¯•dnsåï¼Œè§£æåŸŸåï¼šnslookup netflix.com åˆ¤æ–­IPæ˜¯å¦æ˜¯NETFLIXä»£ç†æœºå™¨IP å¦‚æœä¸å­˜åœ¨nslookupå‘½ä»¤ï¼ŒCENTOSå®‰è£…ï¼šyum install -y bind-utilsï¼ŒDEBIANå®‰è£…ï¼šapt-get -y install dnsutils
ä¸€é”®è„šæœ¬ä¿®æ”¹æ¨èä¿®æ”¹æ–¹å¼ï¼š

ä¸€é”®è„šæœ¬å¾ˆå¤šéƒ½ä¼šè‡ªå¸¦dnsæœåŠ¡ï¼Œä¼šå½±å“æµåª’ä½“çš„dnsè§£é”ã€‚

ä¿®æ”¹æ–¹å¼ï¼š
vi /etc/v2ray/config.json

æ‰¾åˆ°DNS
&amp;quot;dns&amp;quot;: {
        &amp;quot;servers&amp;quot;: [
            {
                &amp;quot;address&amp;quot;: &amp;quot;xxx.xxx.xxx.xxx&amp;quot;,     //æ­¤å¤„ä¸ºæ”¯æŒ Netflix çš„ä»£ç†VPS
                &amp;quot;port&amp;quot;: 53,
                &amp;quot;domains&amp;quot;: [
                    &amp;quot;domain:netflix.com&amp;quot;,
                    &amp;quot;domain:netflix.net&amp;quot;,
                    &amp;quot;domain:nflximg.net&amp;quot;,
                    &amp;quot;domain:nflxvideo.net&amp;quot;,
                    &amp;quot;domain:nflxso.net&amp;quot;,
                    &amp;quot;domain:nflxext.com&amp;quot;
                ]
            },
            &amp;quot;localhost&amp;quot;
        ]
    }

ä¿®æ”¹é…ç½®å®Œæˆä»¥åï¼Œè¯·é‡å¯ä½ çš„V2RAYæœåŠ¡ï¼Œæˆ–æ˜¯é‡å¯VPSã€‚
ä½¿ç”¨åˆ†æµï¼Œè®©ä¸åŒçš„æµåª’ä½“èµ°ä¸åŒçš„DNS
ä¿®æ”¹æ–¹æ³•ï¼š
&amp;quot;dns&amp;quot;: {
        &amp;quot;servers&amp;quot;: [
            {
                &amp;quot;address&amp;quot;: &amp;quot;æ”¯æŒNetflixçš„ä»£ç†VPS&amp;quot;,
                &amp;quot;port&amp;quot;: 53,
                &amp;quot;domains&amp;quot;: [
                    &amp;quot;domain:netflix.com&amp;quot;,
                    &amp;quot;domain:netflix.net&amp;quot;,
                    &amp;quot;domain:nflximg.net&amp;quot;,
                    &amp;quot;domain:nflxvideo.net&amp;quot;,
                    &amp;quot;domain:nflxso.net&amp;quot;,
                    &amp;quot;domain:nflxext.com&amp;quot;
                ]
            },
            {
                &amp;quot;address&amp;quot;: &amp;quot;æ”¯æŒçš„ä»£ç†VPS&amp;quot;,
                &amp;quot;port&amp;quot;: 53,
                &amp;quot;domains&amp;quot;: [
                    &amp;quot;domain:gamer2-cds.cdn.hinet.net&amp;quot;,
                    &amp;quot;domain:gamer-cds.cdn.hinet.net&amp;quot;,
                    &amp;quot;domain:gamer.com.tw&amp;quot;,
                    &amp;quot;domain:i2.bahamut.com.tw&amp;quot;,
                    &amp;quot;domain:app-measurement.com&amp;quot;
                ]
            },
            {
                &amp;quot;address&amp;quot;: &amp;quot;æ”¯æŒçš„ä»£ç†VPS&amp;quot;,
                &amp;quot;port&amp;quot;: 53,
                &amp;quot;domains&amp;quot;: [
                    &amp;quot;domain:bilibili.com&amp;quot;
                ]
            },
            &amp;quot;localhost&amp;quot;
        ]
    }


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/netflixdns-jie-suo/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/19/">
                        ROSåŒè½¯è·¯ç”±ä½¿ç”¨jumpå®ç°å…¬ç½‘ç«¯å£è½¬å‘
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-11-25</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/yqutSJDYyB/" class="post-tag i-tag
                            i-tag-">
            #life
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            
ç”±äºä½¿ç”¨äº†åŒè½¯è·¯ç”±ï¼ŒROSä¸Šè®¾ç½®upnpï¼Œç«¯å£ä¸èƒ½å®ç°è‡ªåŠ¨è½¬å‘ï¼Œæ‰€ä»¥ä½¿ç”¨ROSçš„jumpæ–¹å¼æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚


é¦–å…ˆåœ¨ROSåŠŸèƒ½ç•Œé¢æ‰“å¼€ IP â†’ Firewall â†’ NAT




æ·»åŠ ä¸€ä¸ª NAT è§„åˆ™ (è®¾ç½®jump)
1ï¸âƒ£ General è®¾ç½®

2ï¸âƒ£ Action è®¾ç½®



è®¾ç½®éœ€è¦çš„ç«¯å£è½¬å‘
1ï¸âƒ£ æ·»åŠ ä¸€ä¸ª NAT è§„åˆ™ (General è®¾ç½®)

2ï¸âƒ£ Action è®¾ç½®

åˆ°æ­¤ç«¯å£è½¬å‘å°±è®¾ç½®å®Œæˆã€‚


ç•ªå¤–

ç”±äºå…¬ç½‘æ¯æ¬¡æ‹¨å·ï¼Œå¯èƒ½å¯¼è‡´å…¬ç½‘åœ°å€ä¼šå‘ç”Ÿæ”¹å˜ï¼Œè¿™é‡Œä½¿ç”¨ROSçš„è„šæœ¬æ¥å®ç°è‡ªåŠ¨è®¾ç½®JUMPé‡Œé¢çš„å…¬ç½‘åœ°å€ã€‚

1ï¸âƒ£ åœ¨ROSç•Œé¢ System â†’ scripts æ·»åŠ ä¸€ä¸ªè„šæœ¬

2ï¸âƒ£ è®¾ç½®è„šæœ¬

scriptè„šæœ¬ä»£ç ï¼š
:global addold
:global addnew
 :set addnew [/interface get [/interface find name=&amp;quot;pppoe-out1&amp;quot;] running]
 :if ($addnew=true) do={
  :set addold [/ip address get [/ip address find dynamic=yes interface=&amp;quot;pppoe-out1&amp;quot;] address]
  :set addold [:pick $addold 0 ([:len $addold ] -3)]
   /ip firewall nat set [/ip firewall nat find comment=&amp;quot;dynamic_nat&amp;quot;] dst-address=$addold
}

3ï¸âƒ£ è®¾ç½®ä¸€ä¸ªå®šæ—¶Profile
ROSç•Œé¢ â†’ PPP â†’ Profiles æ·»åŠ ä¸€ä¸ªæ–°çš„Profile

è®¾ç½®Profiles

è®¾ç½® Scripts

profileè„šæœ¬ä»£ç ï¼š
delay 3s
:execute &amp;quot;dynamic_nat&amp;quot;



ğŸŒˆä»¥ä¸Šï¼Œå…¬ç½‘ç«¯å£è½¬å‘çš„jumpè®¾ç½®å…¨éƒ¨è®¾ç½®å®Œæ¯•ï¼Œå¦‚æœè¿‡ç¨‹æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œè¿˜è¯·å„ä½æŒ‡æ•™ä¸€èµ·è®¨è®ºï¼Œè°¢è°¢ã€‚ğŸ’¨

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/19/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/16/">
                        dockerå¼€æœºè‡ªå¯
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-25</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/bV_DFMXGZ/" class="post-tag i-tag
                            i-tag-error">
            #Docker
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            dockerå¼€æœºè‡ªå¯
ä¸€ã€dockeræœåŠ¡è®¾ç½®è‡ªåŠ¨å¯åŠ¨

é€‚ç”¨äºyumå®‰è£…çš„å„ç§æœåŠ¡


æŸ¥çœ‹å·²å¯åŠ¨çš„æœåŠ¡

systemctl list-units --type=service


æŸ¥çœ‹æ˜¯å¦è®¾ç½®å¼€æœºå¯åŠ¨

systemctl list-unit-files | grep enable


è®¾ç½®å¼€æœºå¯åŠ¨

systemctl enable docker.service


å…³é—­å¼€æœºå¯åŠ¨

systemctl disable docker.service

äºŒã€dockerå®¹å™¨è®¾ç½®è‡ªåŠ¨å¯åŠ¨

å¯åŠ¨æ—¶åŠ  --restart=always

docker run tomcat -it -d -p 8080:8080 --restart=always



å¦‚æœå·²ç»è¿è¡Œè¿‡çš„é¡¹ç›®
é’ˆå¯¹ï¼šå·²ç»å¯åŠ¨çš„é¡¹ç›®ï¼Œä½¿ç”¨updateæ›´æ–°


docker update --restart=always imagesID

restartå‚æ•°çš„å¯åŠ¨é€‰é¡¹



Flag
Description




no
ä¸è‡ªåŠ¨é‡å¯å®¹å™¨. (é»˜è®¤value)


on-failure
å®¹å™¨å‘ç”Ÿerrorè€Œé€€å‡º(å®¹å™¨é€€å‡ºçŠ¶æ€ä¸ä¸º0)é‡å¯å®¹å™¨


unless-stopped
åœ¨å®¹å™¨å·²ç»stopæ‰æˆ–Docker stoped/restartedçš„æ—¶å€™æ‰é‡å¯å®¹å™¨


always
åœ¨å®¹å™¨å·²ç»stopæ‰æˆ–Docker stoped/restartedçš„æ—¶å€™æ‰é‡å¯å®¹å™¨




è½¬è½½è‡³ï¼šç§‹å¯»è‰

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/16/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/15/">
                        Dockerå®‰è£…GUIå›¾å½¢åŒ–ç•Œé¢ï¼ˆPortainerï¼‰
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-25</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/bV_DFMXGZ/" class="post-tag i-tag
                            i-tag-warning">
            #Docker
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            Dockerå®‰è£…GUIå›¾å½¢åŒ–ç•Œé¢ï¼ˆPortainerï¼‰

Portaineræ˜¯ä¸€ä¸ªå¼€æºã€è½»é‡çº§Dockerç®¡ç†ç”¨æˆ·ç•Œé¢ï¼ŒåŸºäºDocker APIï¼Œæä¾›çŠ¶æ€æ˜¾ç¤ºé¢æ¿ã€åº”ç”¨æ¨¡æ¿å¿«é€Ÿéƒ¨ç½²ã€å®¹å™¨é•œåƒç½‘ç»œæ•°æ®å·çš„åŸºæœ¬æ“ä½œï¼ˆåŒ…æ‹¬ä¸Šä¼ ä¸‹è½½é•œåƒï¼Œåˆ›å»ºå®¹å™¨ç­‰æ“ä½œï¼‰ã€äº‹ä»¶æ—¥å¿—æ˜¾ç¤ºã€å®¹å™¨æ§åˆ¶å°æ“ä½œã€Swarmé›†ç¾¤å’ŒæœåŠ¡ç­‰é›†ä¸­ç®¡ç†å’Œæ“ä½œã€ç™»å½•ç”¨æˆ·ç®¡ç†å’Œæ§åˆ¶ç­‰åŠŸèƒ½ã€‚åŠŸèƒ½ååˆ†å…¨é¢ï¼ŒåŸºæœ¬èƒ½æ»¡è¶³ä¸­å°å‹å•ä½å¯¹å®¹å™¨ç®¡ç†çš„å…¨éƒ¨éœ€æ±‚ã€‚

å¿«é€Ÿå…¥é—¨
1.å®˜ç½‘
https://www.portainer.io/installation/
2.ä½¿ç”¨dockerå®‰è£…portainer
1.æœç´¢portainer
docker search portainer


2.å°†é•œåƒæ‹‰å–åˆ°æœ¬åœ°
docker pull portainer/portainer


3.è¿è¡Œé•œåƒ
docker run -d -it --name portainerUI -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer


æ³¨æ„ï¼šè¿™é‡Œå¦‚æœä½¿ç”¨å•æœºç‰ˆï¼Œä¸€å®šè¦ä½¿ç”¨ -v /var/run/docker.sock:/var/run/docker.sockï¼Œå¦åˆ™åœ¨è¿›å…¥WEBUIçš„æ—¶å€™åˆ›å»ºä¼šå‡ºç°é—®é¢˜ï¼Œè¿™é‡Œ volumeä¹Ÿå¯ä½¿ç”¨å®˜æ–¹æ•™ç¨‹ï¼Œè¿™é‡Œå°†è¿è¡Œä»£ç ä¸€å¹¶è´´å…¥ã€‚
docker volume create portainer_data
docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer

å®˜æ–¹è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªportainer_dataçš„æ–‡ä»¶å¤¹ç”¨äºå­˜å‚¨æ•°æ®ï¼Œå¤§å®¶æŒ‰éœ€è¿è¡Œå³å¯ã€‚
3.è®¿é—®Portainer
1.åˆ›å»ºç”¨æˆ·
æ‰“å¼€æµè§ˆå™¨è¾“å…¥ ip:ç«¯å£å·ï¼Œè¿™é‡Œipæ˜¯Linuxçš„åœ°å€ï¼Œç«¯å£å·ä¸ºå¯åŠ¨çš„æ—¶å€™æ˜ å°„çš„ç«¯å£ã€‚

2.è¿æ¥dockerç¯å¢ƒ

3.è¿›å…¥Portainerç®¡ç†


                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/15/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/13/">
                        GateWayè‡ªå®šä¹‰å…¨å±€GlobalFilter
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-06</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/hR2Q3InCJ/" class="post-tag i-tag
                            i-tag-other_1">
            #spring
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            GateWayè‡ªå®šä¹‰å…¨å±€GlobalFilter
1.å®ç°ä¸¤ä¸ªæ¥å£


GlobalFilter
ç”¨äºè‡ªå®šä¹‰è¿‡æ»¤å™¨ï¼Œä¾‹å¦‚è¿›è¡ŒTokenéªŒè¯


Ordered
Springæä¾›äº†Orderedè¿™ä¸ªæ¥å£ï¼Œæ¥å¤„ç†ç›¸åŒæ¥å£å®ç°ç±»çš„ä¼˜å…ˆçº§é—®é¢˜ã€‚


import lombok.extern.slf4j.Slf4j;
import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.Ordered;
import org.springframework.http.HttpStatus;
import org.springframework.stereotype.Component;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

import java.util.Date;

@Component
@Slf4j
public class MyLogGateWayFilter implements GlobalFilter, Ordered {

    @Override
    public Mono&amp;lt;Void&amp;gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) {

        //æ‰“å°è¾“å‡ºä¿¡æ¯
        log.info(&amp;quot;************come in MyLogGateWayFilter&amp;quot; + new Date());

        //è·å–requestä¸­çš„å‚æ•°
        String name = exchange.getRequest().getQueryParams().getFirst(&amp;quot;name&amp;quot;);
        //åˆ¤æ–­å‚æ•°çš„ä¿¡æ¯
        if(name ==null){
            log.info(&amp;quot;************ç”¨æˆ·åä¸ºnullï¼Œéæ³•ç”¨æˆ·ï¼Œ/(ã„’oã„’)/~~&amp;quot;);
            exchange.getResponse().setStatusCode(HttpStatus.NOT_ACCEPTABLE);
            return exchange.getResponse().setComplete();
        }

        return chain.filter(exchange);
    }

    @Override
    public int getOrder() {
        return 0;
    }
}

2. ä½¿ç”¨CMDéªŒè¯


éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™



ä¸éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™



3.ç½‘é¡µç«¯æµ‹è¯•


éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™



ä¸éµå¾ªè¿‡æ»¤å™¨ä¸­çš„è§„åˆ™



ç»“è®ºï¼šè‡ªå®šä¹‰Filterç±»ä¼¼SpringMVCä¸­çš„Filterï¼ŒGlobalGilter å…¨å±€è¿‡æ»¤å™¨æ¥å£ä¸ GatewayFilter ç½‘å…³è¿‡æ»¤å™¨æ¥å£å…·æœ‰ç›¸åŒçš„æ–¹æ³•å®šä¹‰ã€‚å…¨å±€è¿‡æ»¤å™¨æ˜¯ä¸€ç³»åˆ—ç‰¹æ®Šçš„è¿‡æ»¤å™¨ï¼Œä¼šæ ¹æ®æ¡ä»¶åº”ç”¨åˆ°æ‰€æœ‰è·¯ç”±ä¸­ã€‚ç½‘å…³è¿‡æ»¤å™¨æ˜¯æ›´ç»†ç²’åº¦çš„è¿‡æ»¤å™¨ï¼Œä½œç”¨äºæŒ‡å®šçš„è·¯ç”±ä¸­ã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/13/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/12/">
                        å¾®æœåŠ¡ä¸­ä½¿ç”¨GateWayå®ç°ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®ã€‚
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-07-06</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/hR2Q3InCJ/" class="post-tag i-tag
                            i-tag-error">
            #spring
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            å¾®æœåŠ¡ä¸­ä½¿ç”¨GateWayå®ç°ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®ã€‚

ç½‘å…³çš„è§’è‰²æ˜¯ä½œä¸ºä¸€ä¸ª API æ¶æ„ï¼Œç”¨æ¥ä¿æŠ¤ã€å¢å¼ºå’Œæ§åˆ¶å¯¹äº API æœåŠ¡çš„è®¿é—®ã€‚
API ç½‘å…³æ˜¯ä¸€ä¸ªå¤„äºåº”ç”¨ç¨‹åºæˆ–æœåŠ¡ï¼ˆæä¾› REST API æ¥å£æœåŠ¡ï¼‰ä¹‹å‰çš„ç³»ç»Ÿï¼Œç”¨æ¥ç®¡ç†æˆæƒã€è®¿é—®æ§åˆ¶å’Œæµé‡é™åˆ¶ç­‰ï¼Œè¿™æ · REST API æ¥å£æœåŠ¡å°±è¢« API ç½‘å…³ä¿æŠ¤èµ·æ¥ï¼Œå¯¹æ‰€æœ‰çš„è°ƒç”¨è€…é€æ˜ã€‚å› æ­¤ï¼Œéšè—åœ¨ API ç½‘å…³åé¢çš„ä¸šåŠ¡ç³»ç»Ÿå°±å¯ä»¥ä¸“æ³¨äºåˆ›å»ºå’Œç®¡ç†æœåŠ¡ï¼Œè€Œä¸ç”¨å»å¤„ç†è¿™äº›ç­–ç•¥æ€§çš„åŸºç¡€è®¾æ–½ã€‚

ç®€å•ä½¿ç”¨
ä¸‰ä¸ªæ¦‚å¿µ

æ³¨ï¼šä¸Šå›¾å¼•ç”¨CSDNåšä¸»AlgoRainï¼Œè¿™é‡Œè‡´è°¢ä¸€ä¸‹å¤§ä½¬è¯¦ç»†çš„è®²è§£ã€‚
springcloudä¸­ä½¿ç”¨
1.æ–°å»ºModule
æ·»åŠ ä¸€ä¸ªæ–°çš„Moduleï¼Œcloud-gateway-gateway9527ï¼ˆåç§°æŒ‰ç…§è‡ªå·±å–œå¥½ï¼‰
2.æ·»åŠ POMä¾èµ–
&amp;lt;dependencies&amp;gt;
        &amp;lt;!--gateway--&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-cloud-starter-gateway&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!--Eureka client--&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-cloud-starter-netflix-eureka-client&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!--å¯¼å…¥è‡ªå·±å®šä¹‰çš„apié€šç”¨åŒ…--&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.ziznah.springcloud&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;cloud-api-commons&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!--ä¸€èˆ¬åŸºç¡€é…ç½®ç±»--&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-devtools&amp;lt;/artifactId&amp;gt;
            &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
            &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.projectlombok&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;lombok&amp;lt;/artifactId&amp;gt;
            &amp;lt;optional&amp;gt;true&amp;lt;/optional&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-starter-test&amp;lt;/artifactId&amp;gt;
            &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
        &amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;

3.æ·»åŠ YMLæ–‡ä»¶
#é…ç½®ç«¯å£
server:
  port: 9527

spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
      routes:
        - id: payment_routh #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/get/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

        - id: payment_routh2 #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
#æ³¨å†Œè¿›æœåŠ¡ä¸­å¿ƒï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯eureka
eureka:
  instance:
    hostname: cloud-gateway-service
  client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://localhost:7001/eureka/


4.ä¸»å¯åŠ¨ç±»
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
@EnableDiscoveryClient
public class GateWayMain9527 {
    public static void main(String[] args) {
        SpringApplication.run(GateWayMain9527.class,args);
    }
}

ä½¿ç”¨é…ç½®ç±»æ¥ç®€å•ä½¿ç”¨GateWay

å°†http://localhost:9527/guoneiè½¬å‘åˆ°ç™¾åº¦çš„æ–°é—»ç½‘ä¸­çš„å›½å†…ä¿¡æ¯

import org.springframework.cloud.gateway.route.RouteLocator;
import org.springframework.cloud.gateway.route.builder.RouteLocatorBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class GateWayConfig {

    /**
     * é…ç½®ä¸€ä¸ªidä¸ºroute-nameçš„è·¯ç”±è§„åˆ™ï¼Œ
     * å½“è®¿é—®åœ°å€http://localhost:9527/guoneiæ—¶ä¼šè‡ªåŠ¨è½¬å‘åˆ°åœ°å€ï¼šhttp://news.baidu.com/guonei
     * @param routeLocatorBuilder
     * @return
     */
    @Bean
    public RouteLocator customRouteLocator(RouteLocatorBuilder routeLocatorBuilder){
        //è·å–ç½‘å…³çš„routes
        RouteLocatorBuilder.Builder routes = routeLocatorBuilder.routes();
        //è®¾ç½®ç½‘å…³çš„å†…å®¹
        routes.route(&amp;quot;path_route_ziznah&amp;quot;,r -&amp;gt; r.path(&amp;quot;/guonei&amp;quot;).uri(&amp;quot;http://news.baidu.com/guonei&amp;quot;)).build();

        //è¿”å›å†…å®¹
        return routes.build();
    }
}

å®ç°åŠ¨æ€è·¯ç”±

å¤šä¸ªæœåŠ¡æä¾›è€…è¿›è¡Œæä¾›æœåŠ¡ï¼Œä½¿ç”¨åŠ¨æ€è·¯ç”±æ¥åˆ°è¾¾è´Ÿè½½å‡è¡¡

1.YML
server:
  port: 9527

spring:
  application:
    name: cloud-gateway
  cloud:
    gateway:
     #å¼€å¯åŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½
      discovery:
        locator:
          enabled: true   #å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±
      routes:
        - id: payment_routh #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
#          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          uri: lb://cloud-payment-service   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/get/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

        - id: payment_routh2 #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
#          uri: http://localhost:8001          #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          uri: lb://cloud-payment-service   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
          predicates:
            - Path=/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±

eureka:
  instance:
    hostname: cloud-gateway-service
  client: #æœåŠ¡æä¾›è€…provideræ³¨å†Œè¿›eurekaæœåŠ¡åˆ—è¡¨å†…
    service-url:
      register-with-eureka: true
      fetch-registry: true
      defaultZone: http://localhost:7001/eureka/

æ³¨ï¼šéœ€è¦æ³¨æ„çš„æ˜¯uriçš„åè®®lbï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œlb://serverNameæ˜¯spring cloud  gatwayåœ¨å¾®æœåŠ¡ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è´Ÿè½½å‡è¡¡uriã€‚
predicatesæ–­è¨€ä¸åŒç±»å‹
1.After

YMLæ–‡ä»¶

# æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- After=2020-07-06T16:43:08.146+08:00[Asia/Shanghai]

ä¸Šè¿°çš„æ—¶é—´åœ°å€å¯ä½¿ç”¨Javaä¸­timeçš„apiæ¥è·å–ï¼š
import java.time.ZoneId;
import java.time.ZonedDateTime;

public class T2 {
    public static void main(String[] args) {
        //è·å–é»˜è®¤æ—¶åŒº
        ZonedDateTime zdt = ZonedDateTime.now();
        System.out.println(zdt);
        //é€šè¿‡æŒ‡å®šæ—¶åŒºè·å–å½“å‰æ—¶é—´
        ZonedDateTime now = ZonedDateTime.now(ZoneId.of(&amp;quot;America/New_York&amp;quot;));
        System.out.println(now);
    }
}


2.Before
æ–¹æ³•åŒAfter
3.Between
æ–¹æ³•åŒAfter
4.Cookie

YMLæ–‡ä»¶

# æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Cookie=ceshi,admin	

Windowsä¸­CMDçª—å£ä½¿ç”¨curlå‘½ä»¤è¿›è¡Œhttpè¯·æ±‚

ä¸å¸¦Cookieè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚



å¸¦Cookieè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚


5.Header

YMLæ–‡ä»¶

# æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Header=X-Request-Id, \d+		#è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§ï¼Œå¹¶ä¸”å€¼ä¸ºæ­£æ•°çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚

ä½¿ç”¨CMDçš„curlå‘½ä»¤æµ‹è¯•

å¸¦Header




ä¸å¸¦Header



å¸¦é”™è¯¯çš„Headerä¿¡æ¯



6.Host

YML

# æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Host=**.ceshi.com

ä½¿ç”¨CMDçš„curlå‘½ä»¤æµ‹è¯•


å¸¦Hostæµ‹è¯•



ä¸å¸¦Hostæµ‹è¯•



å¸¦é”™è¯¯Hostæµ‹è¯•



7.Method

YML

# æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
predicates:		
	- Method=GET

8.Path
9.Query
10.Weight

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/12/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/11/">
                        å‚è€ƒRoundRobinRuleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-06-25</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/hR2Q3InCJ/" class="post-tag i-tag
                            i-tag-">
            #spring
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            å‚è€ƒRoundRobinRuleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡
1.å®šä¹‰ä¸€ä¸ªLoadBalanceræ¥å£

è·å–æœåŠ¡å™¨é›†ç¾¤ä¸Šèƒ½å¤Ÿæä¾›æœåŠ¡çš„æœºå™¨æ•°é‡

public interface Loadbalancer {
    /**
     * è·å–æœåŠ¡å™¨é›†ç¾¤ä¸Šèƒ½å¤Ÿæä¾›æœåŠ¡çš„æœºå™¨æ•°é‡
     * @param serviceInstances
     * @return
     */
    ServiceInstance instances(List&amp;lt;ServiceInstance&amp;gt; serviceInstances);
}

2.å®ç°LoadBalanceræ¥å£ä¸­çš„æ–¹æ³•

åˆ©ç”¨è‡ªæ—‹é”ï¼Œåˆ›å»ºè·å–å½“å‰æœåŠ¡è°ƒç”¨æ˜¯ç¬¬å‡ æ¬¡è®¿é—®çš„æ–¹æ³•
å®ç°æ¥å£ä¸­è·å–æä¾›æœåŠ¡æœºå™¨æ•°é‡çš„æ–¹æ³•ï¼Œæ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡ç®—æ³•æ¥è¾¾åˆ°è´Ÿè½½è°ƒç”¨æœåŠ¡ã€‚

/**
 * ClassName: MyLB
 * Description: å‚è€ƒRoundRobinRuleä»£ç æ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡
 * Author: SUGAR
 * Date: 2020/6/25 16:09
 * Version: 1.0
 **/
@Component
public class MyLB implements Loadbalancer{

    private AtomicInteger atomicInteger = new AtomicInteger(0);

    /**
     * è·å–å½“å‰æœåŠ¡è°ƒç”¨æ˜¯ç¬¬å‡ æ¬¡è®¿é—®
     * @return
     */
    public final int getAndIncrement(){
        int current;
        int next;

        do {
            current = this.atomicInteger.get();
            next = current &amp;gt;= 2147483647 ? 0 : current + 1;
        }while (!this.atomicInteger.compareAndSet(current,next));
        System.out.println(&amp;quot;*****è®¿é—®ç¬¬&amp;quot; + next + &amp;quot;æ¬¡ï¼*****&amp;quot;);
        return next;
    }

    /**
     * æ ¹æ®ç¬¬å‡ æ¬¡è®¿é—®ï¼Œæ¨¡æ‹Ÿè´Ÿè½½å‡è¡¡ç®—æ³•æ¥è¾¾åˆ°è´Ÿè½½è°ƒç”¨æœåŠ¡
     * è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡
     * æ¯æ¬¡æœåŠ¡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹
     * @param serviceInstances
     * @return
     */
    @Override
    public ServiceInstance instances(List&amp;lt;ServiceInstance&amp;gt; serviceInstances) {

        int index = getAndIncrement() % serviceInstances.size();

        return serviceInstances.get(index);
    }
}

3.å–æ¶ˆLoadBalancedæ³¨è§£

å–æ¶ˆApplicationContextConfigä¸­RestTemplateçš„getæ–¹æ³•çš„LoadBalancedæ³¨è§£ï¼Œä½¿ç”¨è‡ªå·±æ¨¡æ‹Ÿçš„è´Ÿè½½å‡è¡¡ã€‚

@Configuration
public class ApplicationContextConfig {

    @Bean
//    @LoadBalanced ä½¿ç”¨è‡ªå·±æ¨¡æ‹Ÿçš„è´Ÿè½½å‡è¡¡çš„æ–¹æ³•
    public RestTemplate getRestTemplate(){
        return new RestTemplate();
    }
}

4.æ·»åŠ æœåŠ¡æä¾›å•†æä¾›çš„controlleræ–¹æ³•

æ·»åŠ ä¸€ä¸ªè·å–å½“å‰æœåŠ¡æä¾›è€…ç«¯å£çš„æ–¹æ³•ï¼Œç”¨æ¥è´Ÿè½½å‡è¡¡ã€‚

@GetMapping(value = &amp;quot;/payment/lb&amp;quot;)
public String getPaymentLB() {
    return serverPort;
}

æ³¨ï¼šè¿™é‡Œçš„æ–¹æ³•æ·»åŠ åˆ°æä¾›å•†çš„controllerä¸­ã€‚
5.è°ƒç”¨è€…æ·»åŠ controlleræ–¹æ³•

è°ƒç”¨è€…controlleræ·»åŠ è°ƒç”¨æœåŠ¡æä¾›å•†çš„æ–¹æ³•ï¼Œæµ‹è¯•è´Ÿè½½å‡è¡¡

@GetMapping(value = &amp;quot;/consumer/payment/lb&amp;quot;)
public String getPayementLB(){
    List&amp;lt;ServiceInstance&amp;gt; instances = discoveryClient.getInstances(&amp;quot;CLOUD-PAYMENT-SERVICE&amp;quot;);
    //åˆ¤æ–­æœåŠ¡æ˜¯å¦ä¸ºæœ‰æ•ˆæœåŠ¡
    if(instances == null || instances.size() &amp;lt;= 0){
        return null;
    }

    ServiceInstance serviceInstance = loadbalancer.instances(instances);
    URI uri = serviceInstance.getUri();

    return restTemplate.getForObject(uri + &amp;quot;/payment/lb&amp;quot;,String.class);
}

6.æµ‹è¯•

å¯åŠ¨å¯¹åº”çš„æœåŠ¡



æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸï¼ˆæ¨¡æ‹Ÿæä¾›è€…é›†ç¾¤ä»¥åŠæœåŠ¡å™¨é›†ç¾¤ï¼‰



æ¨¡æ‹Ÿè°ƒç”¨è€…è®¿é—®æ¥å£




â€‹	æ ¹æ®ä»¥ä¸Šè°ƒç”¨ï¼Œåå°ä¹Ÿæ‰“å°å‡ºç›¸åº”çš„è°ƒç”¨ä¿¡æ¯ã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/11/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/10/">
                        Dockerä¸­ CMD ä¸ ENTRYPOINT ä¿ç•™æŒ‡ä»¤çš„åŒºåˆ«
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-06-09</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/bV_DFMXGZ/" class="post-tag i-tag
                            i-tag-other_3">
            #Docker
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            
ç¼–å†™Dockerfileæ—¶ï¼Œæ—¶å¸¸çœ‹åˆ°æœ€åä¼šçœ‹åˆ°CMDæˆ–è€…ENTRYPOINT çš„ä¿ç•™æŒ‡ä»¤ï¼Œä½†æ˜¯ä»–ä»¬çš„æ„ä¹‰éƒ½ä¸ºï¼šæŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹‹é—´çš„å·®å¼‚åœ¨å“ªé‡Œï¼Ÿ

ä½¿ç”¨curlå‘½ä»¤æ¥è¯´æ˜
é¦–å…ˆç¼–å†™ä¸¤ä¸ªDockerfile

ä½¿ç”¨CMDä¿ç•™æŒ‡ä»¤ã€‚

FROM centos
RUN yum install -y curl
CMD [ &amp;quot;curl&amp;quot;, &amp;quot;-s&amp;quot;, &amp;quot;https://www.baidu.com/&amp;quot; ]

è¿™é‡Œ Dockerfile çš„åå­—è¦æ±‚å°å†™ï¼Œå¦åˆ™ä¼šæŠ¥é”™invalid argument &amp;quot;cmdCentos&amp;quot; for &amp;quot;-t, --tag&amp;quot; flag: invalid reference format: repository name must be lowercase See &#39;docker build --help&#39;.


ä½¿ç”¨ENTRYPOINTä¿ç•™æŒ‡ä»¤ã€‚

FROM centos
RUN yum install -y curl
ENTRYPOINT [ &amp;quot;curl&amp;quot;, &amp;quot;-s&amp;quot;, &amp;quot;https://www.baidu.com/&amp;quot; ]


åœ¨dockerä¸­è¿›è¡Œbuildè¿›è¡Œæ„å»ºä¸€ä¸ªæ–°çš„é•œåƒ


æ„å»ºCMDä¿ç•™æŒ‡ä»¤çš„Dockerfileã€‚



æ„å»ºENTRYPOINTä¿ç•™æŒ‡ä»¤çš„Dockerfileã€‚



è¿è¡Œä¸¤ä¸ªé•œåƒè¿›è¡Œå¯¹æ¯”


è¿è¡ŒCMDä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚



è¿è¡ŒENTRYPOINTä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚



è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å‘ç°ï¼Œä¸¤ä¸ªé•œåƒè¿è¡Œèµ·æ¥æ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œä½†æ˜¯é‡ç‚¹æ¥äº†ï¼å½“æˆ‘ä»¬éœ€è¦å¯¹é•œåƒå¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤è¿›è¡Œå¢å¼ºçš„æ—¶å€™ã€‚
æ¯”å¦‚æˆ‘ä»¬è¿˜æƒ³è·å–æŒ‡å®šç½‘ç«™çš„å¤´ä¿¡æ¯ã€‚


è¿è¡Œå¢å¼ºåçš„CMDä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚



è¿è¡Œå¢å¼ºåçš„ENTRYPOINTä¿ç•™æŒ‡ä»¤çš„é•œåƒã€‚



æ€»ç»“
ç”±ä¸Šè¿°çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œåœ¨æ‰§è¡ŒDockerfileä¸­ï¼Œå¦‚æœä½¿ç”¨äº†CMDä¿ç•™æŒ‡ä»¤ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œé•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å…¶å¯åŠ¨å‘½ä»¤åé¢æ·»åŠ OPTIONé€‰é¡¹çš„æ—¶å€™ï¼Œå°†ä¼šè¦†ç›–Dockerfileä¸­çš„ä¸Šä¸€å¥æŒ‡ä»¤ï¼Œé€ æˆè¿è¡Œå¤±è´¥ã€‚ä¾‹å¦‚ï¼š
FROM centos
RUN yum install -y curl
CMD [ &amp;quot;curl&amp;quot;, &amp;quot;-s&amp;quot;, &amp;quot;https://www.baidu.com/&amp;quot; ]
CMD -i

å¦‚æœä½¿ç”¨ENTRYPOINTä¿ç•™æŒ‡ä»¤ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œé•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å…¶å¯åŠ¨å‘½ä»¤åé¢æ·»åŠ OPTIONé€‰é¡¹çš„æ—¶å€™ï¼Œä¼šå¯¹è¿è¡Œçš„å‘½ä»¤è¿›è¡Œâ€œå¢å¼ºâ€ã€‚ä¾‹å¦‚ï¼š
FROM centos
RUN yum install -y curl
ENTRYPOINT [ &amp;quot;curl&amp;quot;, &amp;quot;-s&amp;quot;,&amp;quot;-i&amp;quot;, &amp;quot;https://www.baidu.com/&amp;quot; ]

æ‰€ä»¥ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ˜¯ä½¿ç”¨CMDè¿˜æ˜¯ENTRYPOINTä¿ç•™æŒ‡ä»¤ï¼Œè¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡è¦æ±‚ã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/10/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/9/">
                        åœ¨VMware Workstationä¸Šå®‰è£…CentOS7çš„ç½‘ç»œé—®é¢˜
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-06-09</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/BMhg_qYrO/" class="post-tag i-tag
                            i-tag-info">
            #Linux
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            é…ç½®ç½‘ç»œ
è™šæ‹ŸæœºCentOSçš„ç½‘ç»œè®¾ç½®
1. å°†ç½‘ç»œé€‚é…å™¨è®¾ç½®ä¸ºNATæ¨¡å¼

2. Linuxä¸­ç½‘ç»œè®¾ç½®
cd /etc/sysconfig/network-scripts/ï¼Œè¿›å…¥CentOS7çš„ç½‘ç»œé…ç½®æ–‡ä»¶ä¸‹ï¼Œæ‰¾åˆ°å¯¹åº”çš„ç½‘å¡è®¾ç½®ï¼Œæˆ‘è¿™é‡Œçš„ç½‘å¡æ˜¯ifcfg-ens32ï¼Œæ¯ä¸ªäººçš„ç½‘å¡åç§°å¯èƒ½ä¸ä¸€æ ·ï¼Œä¸ç”¨åœ¨æ„ã€‚

vim ifcfg-ens32 ï¼Œæ‰“å¼€æŒ‡å®šçš„ç½‘å¡é…ç½®æ–‡ä»¶ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å®‰è£… vimï¼Œä½¿ç”¨ vi æ‰“å¼€å³å¯ã€‚

æ·»åŠ çš„ipã€å­ç½‘æ©ç ã€ç½‘å…³ï¼Œåœ¨VMware Workstationä¸­çš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ä¸­æŸ¥çœ‹ã€‚

é€‰æ‹©VMnet8ï¼Œç„¶åNATè®¾ç½®


IPADDRï¼šä¸ºä¸Šæ–¹çš„å­ç½‘IPï¼Œå»ºè®®IPè®¾ç½®ä¸ºXXX.XXX.XXX.200~XXX.XXX.XXX.250ä¹‹é—´
PREFIXOï¼šä¸ºä¸Šæ–¹å­ç½‘æ©ç ï¼Œ255.255.255.0å³ä¸º24
GATEWAYï¼šä¸ºä¸Šæ–¹ç½‘å…³IPï¼Œå¯¹åº”å¡«ä¸Šå³å¯ã€‚
DNS1ï¼š8.8.8.8
DNS2ï¼š8.8.4.4
è¿™é‡ŒDNSéƒ½è®¾ç½®ä¸ºè°·æ­Œçš„DNSï¼Œæ­£å¸¸è§£æå³å¯ï¼Œå…¶ä»–DNSä¹Ÿå¯ã€‚

                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/9/">Read More ~</a>
                            </div>
                </div>
            </article>
            
            <article class="post i-card">
                <h2 class="post-title">
                    <a href="https://zoengzihaam.github.io/post/8/">
                        Redis
                    </a>
                </h2>
                <div class="post-info">
                    <time class="post-time">2020-06-04</time>
                    
                        <a href="https://zoengzihaam.github.io/tag/5K5Gk1gnd/" class="post-tag i-tag
                            i-tag-warning">
            #Redis
        </a>
                        
                </div>
                <div class="post-article">
                    
                            <div class="post-content">
                                
                                        <div class="post-content-content">
                                            
å¤šèƒ½ï¼Œæ•°æ®ç±»å‹ä¸°å¯Œï¼Œä½¿ç”¨Redisï¼ŒTair
Redis:REmote DIctionary Server(è¿œç¨‹å­—å…¸æœåŠ¡å™¨)
æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œéµå®ˆBSDåè®®ï¼Œ
æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„(key/value)åˆ†å¸ƒå¼å†…å­˜æ•°æ®åº“ï¼ŒåŸºäºå†…å­˜è¿è¡Œ
å¹¶æ”¯æŒæŒä¹…åŒ–çš„NoSQLæ•°æ®åº“ï¼Œæ˜¯å½“å‰æœ€çƒ­é—¨çš„NoSqlæ•°æ®åº“ä¹‹ä¸€,
ä¹Ÿè¢«äººä»¬ç§°ä¸ºæ•°æ®ç»“æ„æœåŠ¡å™¨

ä¸‹è½½Redis
https://redis.io/download
å¯¹Redisçš„ç†è§£

Redisæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç ï¼ˆBSDè®¸å¯ï¼‰çš„å†…å­˜ä¸­æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ï¼Œç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚
KVã€Cacheã€Persistenceã€...

Redisçš„æ¦‚è¿°

3V+3é«˜




3V
3é«˜




æµ·é‡Volume
é«˜å¹¶å‘


å¤šæ ·Variety
é«˜å¯æ‰©


å®æ—¶Velocity
é«˜æ€§èƒ½



ä¼ ç»Ÿå…³ç³»å‹æ•°æ®åº“
ä¼ ç»Ÿçš„ACID
1ã€A (Atomicity) åŸå­æ€§
åŸå­æ€§å¾ˆå®¹æ˜“ç†è§£ï¼Œä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡é‡Œçš„æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨åšå®Œï¼Œè¦ä¹ˆéƒ½ä¸åšï¼Œäº‹åŠ¡æˆåŠŸçš„æ¡ä»¶æ˜¯äº‹åŠ¡é‡Œçš„æ‰€æœ‰æ“ä½œéƒ½æˆåŠŸï¼Œåªè¦æœ‰ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å°±å¤±è´¥ï¼Œéœ€è¦å›æ»šã€‚æ¯”å¦‚é“¶è¡Œè½¬è´¦ï¼Œä»Aè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š1ï¼‰ä»Aè´¦æˆ·å–100å…ƒï¼›2ï¼‰å­˜å…¥100å…ƒè‡³Bè´¦æˆ·ã€‚è¿™ä¸¤æ­¥è¦ä¹ˆä¸€èµ·å®Œæˆï¼Œè¦ä¹ˆä¸€èµ·ä¸å®Œæˆï¼Œå¦‚æœåªå®Œæˆç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥å¤±è´¥ï¼Œé’±ä¼šè«åå…¶å¦™å°‘äº†100å…ƒã€‚
2ã€C (Consistency) ä¸€è‡´æ€§
ä¸€è‡´æ€§ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®åº“è¦ä¸€ç›´å¤„äºä¸€è‡´çš„çŠ¶æ€ï¼Œäº‹åŠ¡çš„è¿è¡Œä¸ä¼šæ”¹å˜æ•°æ®åº“åŸæœ¬çš„ä¸€è‡´æ€§çº¦æŸã€‚
3ã€I (Isolation) ç‹¬ç«‹æ€§
æ‰€è°“çš„ç‹¬ç«‹æ€§æ˜¯æŒ‡å¹¶å‘çš„äº‹åŠ¡ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡è¦è®¿é—®çš„æ•°æ®æ­£åœ¨è¢«å¦å¤–ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹ï¼Œåªè¦å¦å¤–ä¸€ä¸ªäº‹åŠ¡æœªæäº¤ï¼Œå®ƒæ‰€è®¿é—®çš„æ•°æ®å°±ä¸å—æœªæäº¤äº‹åŠ¡çš„å½±å“ã€‚æ¯”å¦‚ç°æœ‰æœ‰ä¸ªäº¤æ˜“æ˜¯ä»Aè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåœ¨è¿™ä¸ªäº¤æ˜“è¿˜æœªå®Œæˆçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ­¤æ—¶BæŸ¥è¯¢è‡ªå·±çš„è´¦æˆ·ï¼Œæ˜¯çœ‹ä¸åˆ°æ–°å¢åŠ çš„100å…ƒçš„
4ã€D (Durability) æŒä¹…æ€§
æŒä¹…æ€§æ˜¯æŒ‡ä¸€æ—¦äº‹åŠ¡æäº¤åï¼Œå®ƒæ‰€åšçš„ä¿®æ”¹å°†ä¼šæ°¸ä¹…çš„ä¿å­˜åœ¨æ•°æ®åº“ä¸Šï¼Œå³ä½¿å‡ºç°å®•æœºä¹Ÿä¸ä¼šä¸¢å¤±ã€‚
éå…³ç³»å‹æ•°æ®åº“
CAP
C:Consistencyï¼ˆå¼ºä¸€è‡´æ€§ï¼‰
A:Availabilityï¼ˆå¯ç”¨æ€§ï¼‰
P:Partition toleranceï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰
Redisçš„å®‰è£…

Linuxç‰ˆå®‰è£…



è·å–Redisçš„å®‰è£…åŒ…
å°†å®‰è£…åŒ…æ”¾åœ¨/usr/local/redisä¸‹


è§£å‹Rediså®‰è£…åŒ…


tar -zxvf redis-5.0.4.tar.gz


è¿›å…¥Redisç›®å½•

cd /usr/local/redis/redis-5.0.4


æ‰§è¡Œmakeå‘½ä»¤

make

è¿è¡Œmakeå‘½ä»¤æ—¶æ•…
æ„å‡ºç°çš„é”™è¯¯è§£æï¼š
â€‹	å®‰è£…gcc
yum -y install gcc-c++


æ‰§è¡Œmake installï¼Œæ£€éªŒå®‰è£…

make install

RedisåŸºæœ¬ä½¿ç”¨
æ›´æ”¹é…ç½®
1.æ›´æ”¹redis.confé…ç½®æ–‡ä»¶
é¦–å…ˆå¤‡ä»½å½“å‰redis.confæ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å†…å®¹ã€‚
daemonize yes

å¯åŠ¨
å®‰è£…redisä¹‹åï¼Œåœ¨/usr/local/binä¼šæœ‰redisçš„å¯åŠ¨æ–‡ä»¶ã€‚


æ‰§è¡Œredis-server /bak/redis/redis.confï¼Œå¯åŠ¨rediså¹¶ä½¿ç”¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ã€‚

redis-server /bak/redis/redis.conf


è¿é€šæµ‹è¯•

æ‰§è¡Œredis-cli -p 6379æ¥æŒ‡å®šç«¯å£å¯åŠ¨æµ‹è¯•ã€‚

redis-cli -p 6379


ä½¿ç”¨pingå‘½ä»¤æ¥æµ‹è¯•è¿é€šï¼Œå‡ºç°PONGå³ä¸ºæˆåŠŸã€‚



å¯ä½¿ç”¨ps -ef|grep redisæ¥æŸ¥çœ‹redisçš„è¿›ç¨‹ã€‚

ps -ef|grep redis


å…³é—­redis

æ‰§è¡Œredis-cli shutdownã€‚

redis-cli shutdown

Rediså¯èƒ½é‡åˆ°é—®é¢˜

ä¿®æ”¹é…ç½®æ–‡ä»¶

protected-mode no # å…³é—­ä¿æŠ¤æ¨¡å¼
daemonize yes     # å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¼€å¯
#bind 127.0.0.1   # ç»‘å®šIPæŒ‰éœ€ä¿®æ”¹
port 6379         # ç«¯å£æŒ‰éœ€ä¿®æ”¹


è¿è¡Œå¹¶æ£€æŸ¥ç«¯å£

#å¯åŠ¨æœåŠ¡å‘½ä»¤
./usr/local/bin/redis-server /bak/redis/redis.conf
#æŸ¥çœ‹6379ç«¯å£æ˜¯å¦å ç”¨
netstat -tunpl | grep 6379


å¼€æ”¾é˜²ç«å¢™ç«¯å£

#å¼€æ”¾6379ç«¯å£
/sbin/iptables -I INPUT -p tcp --dport 6379 -j ACCEPT
#ä¿å­˜é…ç½®
/etc/rc.d/init.d/iptables save
#é‡å¯æœåŠ¡
/etc/rc.d/init.d/iptables restart
#æŸ¥çœ‹ç«¯å£æ˜¯å¦å·²ç»å¼€æ”¾
/etc/init.d/iptables status

Rediså¯åŠ¨åæ‚é¡¹åŸºç¡€çŸ¥è¯†è®²è§£
å•è¿›ç¨‹

å•è¿›ç¨‹æ¨¡å‹æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å¯¹è¯»å†™ç­‰äº‹ä»¶çš„å“åº”
æ˜¯é€šè¿‡å¯¹epollå‡½æ•°çš„åŒ…è£…æ¥åšåˆ°çš„ã€‚Redisçš„å®é™…å¤„ç†é€Ÿåº¦å®Œå…¨ä¾é ä¸»è¿›ç¨‹çš„æ‰§è¡Œæ•ˆç‡


Epollæ˜¯Linuxå†…æ ¸ä¸ºå¤„ç†å¤§æ‰¹é‡æ–‡ä»¶æè¿°ç¬¦è€Œä½œäº†æ”¹è¿›çš„epollï¼Œæ˜¯Linuxä¸‹å¤šè·¯å¤ç”¨IOæ¥å£select/pollçš„å¢å¼ºç‰ˆæœ¬ï¼Œ
å®ƒèƒ½æ˜¾è‘—æé«˜ç¨‹åºåœ¨å¤§é‡å¹¶å‘è¿æ¥ä¸­åªæœ‰å°‘é‡æ´»è·ƒçš„æƒ…å†µä¸‹çš„ç³»ç»ŸCPUåˆ©ç”¨ç‡ã€‚

é»˜è®¤16ä¸ªæ•°æ®åº“


é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹è¡¨ä»é›¶å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨é›¶å·åº“ã€‚
å¯ä»¥ä½¿ç”¨select &amp;lt;id&amp;gt;æ¥è¿æ¥æŒ‡å®šæ•°æ®åº“id



DBSIZE

DbsizeæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡

DBSIZE



ä½¿ç”¨keys *å¯æŸ¥çœ‹å½“å‰åº“ä¸­çš„key

keys *


FLUSHDB

æ¸…ç©ºå½“å‰åº“

FLUSHDB


FLUSHALL

é€šæ€å…¨éƒ¨åº“

FLUSHALL


ç»Ÿä¸€å¯†ç ç®¡ç†
ç´¢å¼•

Reidsç´¢å¼•éƒ½æ˜¯ä»é›¶å¼€å§‹

é»˜è®¤ç«¯å£

é»˜è®¤ç«¯å£æ˜¯6379

Redisæ•°æ®ç±»å‹
Redisçš„äº”å¤§æ•°æ®ç±»å‹
Stringï¼ˆå­—ç¬¦ä¸²ï¼‰
Stringï¼ˆå­—ç¬¦ä¸²ï¼‰
stringæ˜¯redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸Memcachedä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚
stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ ã€‚
stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªredisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M
Hashï¼ˆå“ˆå¸Œï¼Œç±»ä¼¼javaé‡Œçš„Mapï¼‰
Hashï¼ˆå“ˆå¸Œï¼‰
Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚
Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚
ç±»ä¼¼Javaé‡Œé¢çš„Map&amp;lt;String,Object&amp;gt;
Listï¼ˆåˆ—è¡¨ï¼‰
Listï¼ˆåˆ—è¡¨ï¼‰
Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ å¯¼åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚
å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªé“¾è¡¨
Setï¼ˆé›†åˆï¼‰
Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒæ˜¯é€šè¿‡HashTableå®ç°å®ç°çš„ã€‚
Zset(sorted setï¼šæœ‰åºé›†åˆ)
zset(sorted setï¼šæœ‰åºé›†åˆ)
Redis zset å’Œ set ä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆ,ä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚
ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚
redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚zsetçš„æˆå‘˜æ˜¯å”¯ä¸€çš„,ä½†åˆ†æ•°(score)å´å¯ä»¥é‡å¤ã€‚
å“ªé‡Œå»è·å¾—rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤

Http://redisdoc.com/





Redis é”®(key)

å¸¸ç”¨




æ¡ˆä¾‹

keys *



exists keyçš„åå­—ï¼Œåˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨ã€‚



move key dbï¼Œç§»åŠ¨å½“å‰åº“çš„keyåˆ°æŒ‡å®šçš„åº“ä¸­ã€‚



expire keyï¼Œç»™æŒ‡å®šçš„keyè®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ã€‚



ttl keyï¼ŒæŸ¥çœ‹å½“å‰keyçš„è¿‡æœŸæ—¶é—´ï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸã€‚

å½“keyè¿‡æœŸçš„æ—¶å€™ï¼Œä»£è¡¨å½“å‰keyçš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œæ‰€ä»¥åœ¨å½“å‰åº“ä¸­å°±ä¸å­˜åœ¨è¿™ä¸ªkeyã€‚


type keyï¼ŒæŸ¥çœ‹å½“å‰çš„keyçš„ç±»å‹ã€‚



del keyï¼Œåˆ é™¤å½“å‰çš„key




Rediså­—ç¬¦ä¸²(String)

å¸¸ç”¨





å•å€¼å•value


æ¡ˆä¾‹

set key valueï¼Œè®¾ç½®ä¸€ä¸ªK,V



get keyï¼Œè·å–å½“å‰keyçš„valueå€¼ã€‚



append key valueï¼Œåœ¨æŒ‡å®škeyçš„valueå€¼åæ·»åŠ æŒ‡å®šçš„å€¼ã€‚



strlen keyï¼ŒæŸ¥è¯¢å½“å‰keyçš„é•¿åº¦ã€‚



incr keyï¼Œå¯¹å½“å‰çš„keyè¿›è¡Œé€’å¢ã€‚



decr keyï¼Œå¯¹å½“å‰çš„keyè¿›è¡Œé€’å‡ã€‚




incrby key numï¼Œå¯¹å½“å‰çš„keyè¿›è¡ŒæŒ‡å®šæ•°å­—çš„é€’å¢ã€‚

decrby key numï¼Œå¯¹å½“å‰çš„keyè¿›è¡ŒæŒ‡å®šæ•°å­—çš„é€’å‡ã€‚

**æ³¨æ„ï¼š**ä¸€å®šè¦æ˜¯æ•°å­—æ‰èƒ½è¿›è¡ŒåŠ å‡ã€‚
getrange key start endï¼Œè·å–å½“å‰keyå­—ç¬¦ä¸²çš„æŒ‡å®šé•¿åº¦å†…å®¹ã€‚

setrange key index strï¼Œè®¾ç½®å½“å‰keyå­—ç¬¦ä¸²æŒ‡å®šä¸‹æ ‡å¼€å§‹ï¼Œè®¾ç½®strå†…å®¹ã€‚

setex key second valuesetex(set with expire)ï¼Œè®¾ç½®K,Vï¼Œå¹¶è®¾ç½®åˆ°æœŸæ—¶é—´ã€‚

setnx key valueï¼Œsetnx(set if not exist)ï¼Œåªæœ‰å½“å‰keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè®¾ç½®keyçš„å€¼ã€‚

mset key1 value1 key2 value2 key3 value3ï¼Œè®¾ç½®å¤šä¸ªK,Vã€‚

mget key1 key2 key3ï¼Œè·å–å¤šä¸ªæŒ‡å®škeyçš„å€¼ã€‚

msetnx key1 value1 key2 value2 key3 value3ï¼Œè®¾ç½®å¤šä¸ªå€¼ï¼Œå½“è®¾ç½®keyä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®æŒ‡å®škeyå€¼ï¼Œå¦‚æœä¸€ä¸ªä¸å­˜åœ¨ï¼Œåˆ™éƒ½ä¸è®¾ç½®ã€‚

Redisåˆ—è¡¨(List)

å¸¸ç”¨





å•å€¼å¤švalue


æ¡ˆä¾‹

lpush key value1 [value2]ï¼Œå°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ã€‚




rpush key value1 [value2]ï¼Œåœ¨åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼

lrange key start endï¼Œè·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ 

lpop keyï¼Œç§»é™¤å¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ 

rpop keyï¼Œç§»é™¤å¹¶è·å–åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ ã€‚

lindex key indexï¼Œæ ¹æ®ä¸‹æ ‡ï¼ŒæŸ¥è¯¢æ‰§è¡Œåˆ—è¡¨ä¸­çš„æ•°æ®ã€‚

llen keyï¼ŒæŸ¥è¯¢æŒ‡å®šåˆ—è¡¨çš„é•¿åº¦

lrem key count valueï¼Œç§»é™¤æŒ‡å®šåˆ—è¡¨æŒ‡å®šæ•°é‡çš„å€¼ã€‚

ltrim key start endï¼Œæˆªå–æŒ‡å®šåˆ—è¡¨çš„æŒ‡å®šä¸‹æ ‡å†…å®¹ï¼Œç„¶åèµ‹å€¼ç»™è¿™ä¸ªåˆ—è¡¨ã€‚

rpoplpush source destinationï¼Œç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›ã€‚

lset key index valueï¼Œé€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼ã€‚

linsert key before|after pivot valueï¼Œåœ¨åˆ—è¡¨çš„å…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ ã€‚

Redisé›†åˆ(Set)

å¸¸ç”¨




å•å€¼å¤švalue


æ¡ˆä¾‹

sadd key member1 [member2]ï¼Œå‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ã€‚



smembers keyï¼Œè¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜



sismember key memberï¼Œåˆ¤æ–­ member å…ƒç´ æ˜¯å¦æ˜¯é›†åˆkeyçš„æˆå‘˜ã€‚



scard keyï¼Œè·å–é›†åˆçš„æˆå‘˜æ•°



srem key member1 [member2]ï¼Œç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜



srandmember key [count]ï¼Œè¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªéšæœºæ•°ã€‚



spop keyï¼Œç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´ 



smove key1 key2 memberï¼Œå°†memberå…ƒç´ ä»key1é›†åˆç§»åŠ¨åˆ°key2é›†åˆã€‚




æ•°å­¦é›†åˆç±»

sdiff key1 [key2]ï¼Œè¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›†ã€‚ï¼ˆåœ¨ç¬¬ä¸€ä¸ªseté‡Œé¢è€Œä¸åœ¨åé¢ä»»ä½•ä¸€ä¸ªseté‡Œé¢çš„é¡¹ï¼‰



sinter key1 [key2]ï¼Œè¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„äº¤é›†ã€‚



sunion key1 [key2]ï¼Œè¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†ã€‚






Rediså“ˆå¸Œ(Hash)

å¸¸ç”¨




KVæ¨¡å¼ä¸å˜ï¼Œä½†Væ˜¯ä¸€ä¸ªé”®å€¼å¯¹ã€‚


æ¡ˆä¾‹

hset key field valueï¼Œå°†å“ˆå¸Œè¡¨keyä¸­ çš„å­—æ®µfieldçš„å€¼è®¾ä¸ºvalueã€‚



hget key fieldï¼Œè·å–å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šfieldå­—æ®µçš„å€¼ã€‚



hmset key field1 value1 [field2 value2]ï¼ŒåŒæ—¶å°†å¤šä¸ªfield-value(åŸŸ-å€¼)å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨keyä¸­ã€‚



hgetall keyï¼Œè·å¾—å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®škeyçš„æ‰€æœ‰å­—æ®µå’Œå€¼ã€‚



hdel key fieldï¼Œåˆ é™¤å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­key æŒ‡å®šå­—æ®µã€‚



hexists key fieldï¼ŒæŸ¥è¯¢å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­æŒ‡å®šå­—æ®µæ˜¯å¦å­˜åœ¨



hkeys keyï¼Œè·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ



hvals keysï¼Œè·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å€¼ã€‚



hincrby key field incrementï¼Œä¸ºå“ˆå¸Œè¡¨keyä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡incrementã€‚



hincrbyfloat key field incrementï¼Œä¸ºå“ˆå¸Œè¡¨ä¸­çš„æŒ‡å®šå­—æ®µçš„æµ®ç‚¹æ•°å€¼åŠ ä¸Šå¢é‡incrementã€‚



hsetnx key field valueï¼Œåªæœ‰åœ¨å­—æ®µfieldä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®å“ˆå¸Œè¡¨å­—æ®µçš„å€¼ã€‚




Redisæœ‰åºé›†åˆZset(sorted set)

å¸¸ç”¨





æ¡ˆä¾‹

zadd key score1 member1 [score2 member2]ï¼Œå‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²å­˜åœ¨æˆå‘˜çš„åˆ†æ•°ã€‚



zrangebyscore key start endï¼Œé€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ã€‚



zrangebyscore key (start endï¼Œé€šè¿‡è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…(å¸¦æœ‰(ï¼Œè¯´æ˜ä¸åŒ…å«)çš„æˆå‘˜ã€‚



zrem key memberï¼Œæ ¹æ®å¯¹åº”çš„valueå€¼åˆ é™¤æœ‰åºé›†åˆä¸­çš„æˆå‘˜å…ƒç´ ã€‚



zcard keyï¼Œè·å¾—æœ‰åºåˆ—è¡¨ä¸­çš„æˆå‘˜æ•°ã€‚



zcount key min maxï¼ŒæŸ¥è¯¢åœ¨æœ‰åºåˆ—è¡¨ä¸­æŒ‡å®šåŒºé—´çš„æˆå‘˜æ•°ã€‚



zrank key valueï¼Œè·å–æŒ‡å®šæˆå‘˜åœ¨æœ‰åºåˆ—è¡¨ä¸­çš„ä¸‹æ ‡ã€‚



zscore key valueï¼Œè·å–æœ‰åºåˆ—è¡¨ä¸­æŒ‡å®šæˆå‘˜çš„å€¼ã€‚



zrevrank key valuesï¼Œé€†åºè·å¾—ä¸‹æ ‡å€¼ã€‚




è§£æé…ç½®æ–‡ä»¶redis.conf
1.å®ƒåœ¨å“ª


åœ°å€ã€‚
è¿›å…¥redisç›®å½•ä¸‹ï¼Œä½¿ç”¨pwdå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰ç›®å½•ã€‚





ä¸ºä»€ä¹ˆæ‹·è´å‡ºæ¥å•ç‹¬æ‰§è¡Œï¼Ÿ
é€šå¸¸ä¸ºäº†é…ç½®çš„å®‰å…¨ï¼Œæ”¾ç½®åœ¨åŸæ–‡ä»¶é…ç½®é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•æ­£å¸¸è¿è¡Œã€‚


2.Unitså•ä½

3.INCLUDESåŒ…å«

å’Œå…¶ä»–é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡includesåŒ…å«ï¼Œredis.confå¯ä»¥ä½œä¸ºæ€»é—¸ï¼ŒåŒ…å«å…¶ä»–ã€‚


4.GENERALé€šç”¨
daemonize

ä»‹ç»

Aã€redis.confé…ç½®æ–‡ä»¶ä¸­daemonizeå®ˆæŠ¤çº¿ç¨‹ï¼Œé»˜è®¤æ˜¯NOã€‚
Bã€daemonizeæ˜¯ç”¨æ¥æŒ‡å®šredisæ˜¯å¦è¦ç”¨å®ˆæŠ¤çº¿ç¨‹çš„æ–¹å¼å¯åŠ¨ã€‚


daemonize è®¾ç½®yesæˆ–è€…noåŒºåˆ«

daemonize:yes:redisé‡‡ç”¨çš„æ˜¯å•è¿›ç¨‹å¤šçº¿ç¨‹çš„æ¨¡å¼ã€‚å½“redis.confä¸­é€‰é¡¹daemonizeè®¾ç½®æˆyesæ—¶ï¼Œä»£è¡¨å¼€å¯å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œredisä¼šåœ¨åå°è¿è¡Œï¼Œå¹¶å°†è¿›ç¨‹pidå·å†™å…¥è‡³redis.confé€‰é¡¹pidfileè®¾ç½®çš„æ–‡ä»¶ä¸­ï¼Œæ­¤æ—¶rediså°†ä¸€ç›´è¿è¡Œï¼Œé™¤éæ‰‹åŠ¨killè¯¥è¿›ç¨‹ã€‚
daemonize:no: å½“daemonizeé€‰é¡¹è®¾ç½®æˆnoæ—¶ï¼Œå½“å‰ç•Œé¢å°†è¿›å…¥redisçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œexitå¼ºåˆ¶é€€å‡ºæˆ–è€…å…³é—­è¿æ¥å·¥å…·(putty,xshellç­‰)éƒ½ä¼šå¯¼è‡´redisè¿›ç¨‹é€€å‡ºã€‚



Pidfile

å½“Redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedisé»˜è®¤ä¼šæŠŠpidå†™å…¥/var/run/redis.pidæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡pidfileæŒ‡å®šã€‚

Port

æŒ‡å®šRedisç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º6379ï¼Œä½œè€…åœ¨è‡ªå·±çš„ä¸€ç¯‡åšæ–‡ä¸­è§£é‡Šäº†ä¸ºä»€ä¹ˆé€‰ç”¨6379ä½œä¸ºé»˜è®¤ç«¯å£ï¼Œå› ä¸º6379åœ¨æ‰‹æœºæŒ‰é”®ä¸ŠMERZå¯¹åº”çš„å·ç ï¼Œè€ŒMERZå–è‡ªæ„å¤§åˆ©æ­Œå¥³Alessia Merzçš„åå­—ã€‚

Tcp-backlog


æ–‡æ¡£è§£é‡Š
tcp-backlog
è®¾ç½®tcpçš„backlogï¼Œbacklogå…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklogé˜Ÿåˆ—æ€»å’Œ=æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚
åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½ éœ€è¦ä¸€ä¸ªé«˜backlogå€¼æ¥é¿å…æ…¢å®¢æˆ·ç«¯è¿æ¥é—®é¢˜ã€‚æ³¨æ„Linuxå†…æ ¸ä¼šå°†è¿™ä¸ªå€¼å‡å°åˆ°/proc/sys/net/core/somaxconnçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ç¡®è®¤å¢å¤§somaxconnå’Œtcp_max_syn_backlogä¸¤ä¸ªå€¼æ¥è¾¾åˆ°æƒ³è¦çš„æ•ˆæœã€‚


Timeout

å½“å®¢æˆ·ç«¯é—²ç½®å¤šé•¿æ—¶é—´åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º0ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚

Bind

ç»‘å®šçš„ä¸»æœºåœ°å€

Tcp-keepalive

å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒKeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60ã€‚

Loglevel

æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸ºnotice

Logfile

æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚

Syslog-enabled

æ˜¯å¦æŠŠæ—¥å¿—è¾“å‡ºåˆ°syslogä¸­ã€‚é»˜è®¤æ˜¯noã€‚

Syslog-ident

æŒ‡å®šsyslogé‡Œçš„æ—¥å¿—æ ‡å¿—ã€‚é»˜è®¤æ˜¯redisã€‚

Syslog-facility

æŒ‡å®šsyslogè®¾å¤‡ï¼Œå€¼å¯ä»¥æ˜¯USERæˆ–LOCAL0-LOCAL7ã€‚é»˜è®¤æ˜¯LOCAL0ã€‚

Databases

è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°é‡ä¸º16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“idã€‚

5.SNAPSHOTTINGå¿«ç…§
Save

save ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•°

RDBæ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„Snapshotï¼ŒRDBçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ï¼Œ
é»˜è®¤
æ˜¯1åˆ†é’Ÿå†…æ”¹äº†1ä¸‡æ¬¡ï¼Œ
æˆ–5åˆ†é’Ÿå†…æ”¹äº†10æ¬¡ï¼Œ
æˆ–15åˆ†é’Ÿå†…æ”¹äº†1æ¬¡ã€‚


ç¦ç”¨

å¦‚æœæƒ³ç¦ç”¨RDBæŒä¹…åŒ–çš„ç­–ç•¥ï¼Œåªè¦ä¸è®¾ç½®ä»»ä½•saveæŒ‡ä»¤ï¼Œæˆ–è€…ç»™saveä¼ å…¥ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å‚æ•°ä¹Ÿå¯ä»¥ã€‚


å¦‚æœæƒ³å³å¯å¤‡ä»½ï¼Œä½¿ç”¨saveå‘½ä»¤ï¼Œå¯æ‰§è¡Œç«‹å³å¤‡ä»½åŠŸèƒ½ã€‚

Stop-writes-on-bgsave-error
å¦‚æœé…ç½®æˆnoï¼Œè¡¨ç¤ºä½ ä¸åœ¨ä¹æ•°æ®ä¸ä¸€è‡´æˆ–è€…æœ‰å…¶ä»–çš„æ‰‹æ®µå‘ç°å’Œæ§åˆ¶ã€‚

rdbcompression
rdbcompressionï¼šå¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨
LZFç®—æ³•è¿›è¡Œå‹ç¼©ã€‚å¦‚æœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½
rdbchecksum
dbfilename
dir
6.REPLICATIONå¤åˆ¶
7.SECURITYå®‰å…¨

è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆã€‚


8.LIMITSé™åˆ¶
Maxclients

è®¾ç½®redisåŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º10000ä¸ªå®¢æˆ·ç«¯ã€‚å½“ä½ 
æ— æ³•è®¾ç½®è¿›ç¨‹æ–‡ä»¶å¥æŸ„é™åˆ¶æ—¶ï¼Œredisä¼šè®¾ç½®ä¸ºå½“å‰çš„æ–‡ä»¶å¥æŸ„é™åˆ¶å€¼å‡å»32ï¼Œå› ä¸ºredisä¼šä¸ºè‡ª
èº«å†…éƒ¨å¤„ç†é€»è¾‘ç•™ä¸€äº›å¥æŸ„å‡ºæ¥ã€‚å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredisåˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™
äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡ºâ€œmax number of clients reachedâ€ä»¥ä½œå›åº”ã€‚

Maxmemory


è®¾ç½®rediså¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œrediså°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡maxmemory-policyæ¥æŒ‡å®šã€‚å¦‚æœredisæ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œ
é‚£ä¹ˆredisåˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚SETã€LPUSHç­‰ã€‚
ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚GETç­‰ã€‚å¦‚æœä½ çš„redisæ˜¯ä¸»redisï¼ˆè¯´æ˜ä½ çš„redisæœ‰ä»redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯â€œä¸ç§»é™¤â€çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ ã€‚


Maxmemory-policy

ï¼ˆ1ï¼‰volatile-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚
ï¼ˆ2ï¼‰allkeys-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyã€‚
ï¼ˆ3ï¼‰volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ã€‚
ï¼ˆ4ï¼‰allkeys-randomï¼šç§»é™¤éšæœºçš„keyã€‚
ï¼ˆ5ï¼‰volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„keyã€‚
ï¼ˆ6ï¼‰noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ã€‚

Maxmemory-samples

è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œ
redisé»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ªkeyå¹¶é€‰æ‹©å…¶ä¸­LRUçš„é‚£ä¸ªã€‚

9.APPEND ONLY MODEè¿½åŠ 
appendonly
appendfilename
Appendfsync


Alwaysï¼šåŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜  æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½ã€‚
Everysecï¼šå‡ºå‚é»˜è®¤æ¨èï¼Œå¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•   å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±ã€‚
No

No-appendfsync-on-rewriteï¼šé‡å†™æ—¶æ˜¯å¦å¯ä»¥è¿ç”¨Appendfsyncï¼Œç”¨é»˜è®¤noå³å¯ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚
Auto-aof-rewrite-min-sizeï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼
Auto-aof-rewrite-percentageï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼
Redisçš„æŒä¹…åŒ–
æ€»ä½“ä»‹ç»
å®˜ç½‘ä»‹ç»

RDBï¼ˆRedis DataBaseï¼‰
å®˜ç½‘ä»‹ç»

æ˜¯ä»€ä¹ˆï¼š

åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ
ä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚
Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°
ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚
æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½
å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹
å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚

Fork

Forkçš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰
æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ã€‚

Rdb ä¿å­˜çš„æ˜¯dump.rdbæ–‡ä»¶
é…ç½®ä½ç½®

å¦‚ä½•è§¦å‘RDBå¿«ç…§
é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½®



å†·æ‹·è´åé‡æ–°ä½¿ç”¨
å¯ä»¥cp dump.rdb dump_new.rdb


å‘½ä»¤saveæˆ–è€…æ˜¯bgsave

Saveï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡



BGSAVEï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œ
å¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚å¯ä»¥é€šè¿‡lastsave
å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´

æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿdump.rdbæ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰
å¦‚ä½•æ¢å¤


å°†å¤‡ä»½æ–‡ä»¶ (dump.rdb) ç§»åŠ¨åˆ° redis å®‰è£…ç›®å½•å¹¶å¯åŠ¨æœåŠ¡å³å¯


CONFIG GET dirè·å–ç›®å½•


ä¼˜åŠ¿

é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤
å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜

åŠ£åŠ¿

åœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœredisæ„å¤–downæ‰çš„è¯ï¼Œå°±
ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹
Forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘

å¦‚ä½•åœæ­¢

åŠ¨æ€æ‰€æœ‰åœæ­¢RDBä¿å­˜è§„åˆ™çš„æ–¹æ³•ï¼šredis-cli config set save &amp;quot;&amp;quot;

å°æ€»ç»“

AOFï¼ˆAppend Only Fileï¼‰
å®˜ç½‘ä»‹ç»

æ˜¯ä»€ä¹ˆï¼š

ä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(è¯»æ“ä½œä¸è®°å½•)ï¼Œ
åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ

Aofä¿å­˜çš„æ˜¯appendonly.aofæ–‡ä»¶
é…ç½®ä½ç½®

AOFå¯åŠ¨/ä¿®å¤/æ¢å¤
æ­£å¸¸æ¢å¤

å¯åŠ¨ï¼šè®¾ç½®Yes
ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes
å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(config get dir)ã€‚
æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½ã€‚

å¼‚å¸¸æ¢å¤

å¯åŠ¨ï¼šè®¾ç½®Yes
ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyesã€‚
å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶
ä¿®å¤ï¼šRedis-check-aof --fixè¿›è¡Œä¿®å¤
æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½

Rewrite

æ˜¯ä»€ä¹ˆï¼š

AOFé‡‡ç”¨æ–‡ä»¶è¿½åŠ æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†é‡å†™æœºåˆ¶,
å½“AOFæ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRediså°±ä¼šå¯åŠ¨AOFæ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œ
åªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†.å¯ä»¥ä½¿ç”¨å‘½ä»¤bgrewriteaof

é‡å†™åŸç†
AOFæ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™(ä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå†rename)ï¼Œ
éå†æ–°è¿›ç¨‹çš„å†…å­˜ä¸­æ•°æ®ï¼Œæ¯æ¡è®°å½•æœ‰ä¸€æ¡çš„Setè¯­å¥ã€‚é‡å†™aofæ–‡ä»¶çš„æ“ä½œï¼Œå¹¶æ²¡æœ‰è¯»å–æ—§çš„aofæ–‡ä»¶ï¼Œ
è€Œæ˜¯å°†æ•´ä¸ªå†…å­˜ä¸­çš„æ•°æ®åº“å†…å®¹ç”¨å‘½ä»¤çš„æ–¹å¼é‡å†™äº†ä¸€ä¸ªæ–°çš„aofæ–‡ä»¶ï¼Œè¿™ç‚¹å’Œå¿«ç…§æœ‰ç‚¹ç±»ä¼¼ã€‚
è§¦å‘æœºåˆ¶
Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘ã€‚
ä¼˜åŠ¿
æ¯ä¿®æ”¹åŒæ­¥ï¼š
appendfsync always   åŒæ­¥æŒä¹…åŒ– æ¯æ¬¡å‘ç”Ÿæ•°æ®å˜æ›´ä¼šè¢«ç«‹å³è®°å½•åˆ°ç£ç›˜  æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½ã€‚
æ¯ç§’åŒæ­¥ï¼š
appendfsync everysec    å¼‚æ­¥æ“ä½œï¼Œæ¯ç§’è®°å½•   å¦‚æœä¸€ç§’å†…å®•æœºï¼Œæœ‰æ•°æ®ä¸¢å¤±
ä¸åŒæ­¥ï¼š
appendfsync no   ä»ä¸åŒæ­¥ã€‚
åŠ£åŠ¿

ç›¸åŒæ•°æ®é›†çš„æ•°æ®è€Œè¨€aofæ–‡ä»¶è¦è¿œå¤§äºrdbæ–‡ä»¶ï¼Œæ¢å¤é€Ÿåº¦æ…¢äºrdbã€‚
Aofè¿è¡Œæ•ˆç‡è¦æ…¢äºrdb,æ¯ç§’åŒæ­¥ç­–ç•¥æ•ˆç‡è¾ƒå¥½ï¼Œä¸åŒæ­¥æ•ˆç‡å’Œrdbç›¸åŒã€‚

å°æ€»ç»“

æ€»ç»“(Which one)
å®˜ç½‘å»ºè®®



RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨ã€‚


AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›
å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾.
Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§ã€‚


åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼ã€‚


åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹,å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®,
å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´ã€‚
RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿ
ä½œè€…å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œ
å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚



æ€§èƒ½å»ºè®®ã€‚


å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œåªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚
å¦‚æœEnalbe AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚ä»£ä»·ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚
å¦‚æœä¸Enable AOF ï¼Œä»…é Master-Slave Replication å®ç°é«˜å¯ç”¨æ€§ä¹Ÿå¯ä»¥ã€‚èƒ½çœæ‰ä¸€å¤§ç¬”IOä¹Ÿå‡å°‘äº†rewriteæ—¶å¸¦æ¥çš„ç³»ç»Ÿæ³¢åŠ¨ã€‚ä»£ä»·æ˜¯å¦‚æœMaster/SlaveåŒæ—¶å€’æ‰ï¼Œä¼šä¸¢å¤±åå‡ åˆ†é’Ÿçš„æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬ä¹Ÿè¦æ¯”è¾ƒä¸¤ä¸ªMaster/Slaveä¸­çš„RDBæ–‡ä»¶ï¼Œè½½å…¥è¾ƒæ–°çš„é‚£ä¸ªã€‚æ–°æµªå¾®åšå°±é€‰ç”¨äº†è¿™ç§æ¶æ„ã€‚




Redisçš„äº‹åŠ¡
æ˜¯ä»€ä¹ˆ

å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œæœ¬è´¨æ˜¯ä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­çš„
æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ï¼ŒæŒ‰é¡ºåºåœ°ä¸²è¡ŒåŒ–æ‰§è¡Œè€Œä¸ä¼šè¢«å…¶å®ƒå‘½ä»¤æ’å…¥ï¼Œä¸è®¸åŠ å¡ã€‚


å®˜ç½‘


èƒ½å¹²å˜›

ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§çš„æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ã€‚

æ€ä¹ˆç©

å¸¸ç”¨å‘½ä»¤

Case1ï¼šæ­£å¸¸æ‰§è¡Œ

Case2ï¼šæ”¾å¼ƒäº‹åŠ¡

Case3ï¼šå…¨ä½“è¿å

Case4ï¼šå†¤å¤´å€ºä¸»

Case5ï¼šwatchç›‘æ§


æ‚²è§‚é”/ä¹è§‚é”/CAS(Check And Set)


æ‚²è§‚é”
æ‚²è§‚é”(Pessimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚


ä¹è§‚é”
ä¹è§‚é”(Optimistic Lock), é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œ
ä¹è§‚é”ç­–ç•¥:æäº¤ç‰ˆæœ¬å¿…é¡»å¤§äºè®°å½•å½“å‰ç‰ˆæœ¬æ‰èƒ½æ‰§è¡Œæ›´æ–°ã€‚


CAS




åˆå§‹åŒ–ä¿¡ç”¨å¡å¯ç”¨ä½™é¢å’Œæ¬ é¢



æ— åŠ å¡ç¯¡æ”¹ï¼Œå…ˆç›‘æ§å†å¼€å¯multiï¼Œä¿è¯ä¸¤ç¬”é‡‘é¢å˜åŠ¨åœ¨åŒä¸€ä¸ªäº‹åŠ¡å†…ã€‚



æœ‰åŠ å¡ç¯¡æ”¹ã€‚



unwatch



ä¸€æ—¦æ‰§è¡Œäº†execä¹‹å‰åŠ çš„ç›‘æ§é”éƒ½ä¼šè¢«å–æ¶ˆæ‰äº†


å°ç»“

WatchæŒ‡ä»¤ï¼Œç±»ä¼¼ä¹è§‚é”ï¼Œäº‹åŠ¡æäº¤æ—¶ï¼Œå¦‚æœKeyçš„å€¼å·²è¢«åˆ«çš„å®¢æˆ·ç«¯æ”¹å˜ï¼Œ
æ¯”å¦‚æŸä¸ªlistå·²è¢«åˆ«çš„å®¢æˆ·ç«¯push/popè¿‡äº†ï¼Œæ•´ä¸ªäº‹åŠ¡é˜Ÿåˆ—éƒ½ä¸ä¼šè¢«æ‰§è¡Œã€‚
é€šè¿‡WATCHå‘½ä»¤åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰ç›‘æ§äº†å¤šä¸ªKeysï¼Œå€˜è‹¥åœ¨WATCHä¹‹åæœ‰ä»»ä½•Keyçš„å€¼å‘ç”Ÿäº†å˜åŒ–ï¼Œ
EXECå‘½ä»¤æ‰§è¡Œçš„äº‹åŠ¡éƒ½å°†è¢«æ”¾å¼ƒï¼ŒåŒæ—¶è¿”å›Nullmulti-bulkåº”ç­”ä»¥é€šçŸ¥è°ƒç”¨è€…äº‹åŠ¡æ‰§è¡Œå¤±è´¥ã€‚



3é˜¶æ®µ
å¼€å¯ï¼š
ä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ã€‚
å…¥é˜Ÿï¼š
å°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæ¥åˆ°è¿™äº›å‘½ä»¤å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯æ”¾åˆ°ç­‰å¾…æ‰§è¡Œçš„äº‹åŠ¡é˜Ÿåˆ—é‡Œé¢
æ‰§è¡Œï¼š
ç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡
3ç‰¹æ€§
å•ç‹¬çš„éš”ç¦»æ“ä½œï¼š
äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚
æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼š
é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…çš„è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œï¼Œ
ä¹Ÿå°±ä¸å­˜åœ¨â€äº‹åŠ¡å†…çš„æŸ¥è¯¢è¦çœ‹åˆ°äº‹åŠ¡é‡Œçš„æ›´æ–°ï¼Œåœ¨äº‹åŠ¡å¤–æŸ¥è¯¢ä¸èƒ½çœ‹åˆ°â€è¿™ä¸ªè®©äººä¸‡åˆ†å¤´ç—›çš„é—®é¢˜
ä¸ä¿è¯åŸå­æ€§ï¼š
redisåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š
Redisçš„å‘å¸ƒè®¢é˜…
æ˜¯ä»€ä¹ˆ


è¿›ç¨‹é—´çš„ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…(pub)å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…(sub)æ¥æ”¶æ¶ˆæ¯ã€‚


è®¢é˜…/å‘å¸ƒæ¶ˆæ¯å›¾



å‘½ä»¤

æ¡ˆä¾‹
å…ˆè®¢é˜…åå‘å¸ƒåæ‰èƒ½æ”¶åˆ°æ¶ˆæ¯ï¼Œ


å¯ä»¥ä¸€æ¬¡æ€§è®¢é˜…å¤šä¸ªï¼ŒSUBSCRIBE c1 c2 c3



æ¶ˆæ¯å‘å¸ƒï¼ŒPUBLISH c2 hello-redis



è®¢é˜…å¤šä¸ªï¼Œé€šé…ç¬¦*ï¼Œ PSUBSCRIBE new*




æ”¶å–æ¶ˆæ¯ï¼Œ PUBLISH new1 redis2015ã€‚


Redisçš„å¤åˆ¶(Master/Slave)
æ˜¯ä»€ä¹ˆ
å®˜ç½‘

è¡Œè¯ï¼š
ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ä¸»ä»å¤åˆ¶ï¼Œä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œ
è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„master/slaveræœºåˆ¶ï¼ŒMasterä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸»
èƒ½å¹²å˜›

è¯»å†™åˆ†ç¦»
å®¹ç¾æ¢å¤

æ€ä¹ˆç©


é…ä»(åº“)ä¸é…ä¸»(åº“)


ä»åº“é…ç½®ï¼šslaveof ä¸»åº“IP ä¸»åº“ç«¯å£

æ¯æ¬¡ä¸masteræ–­å¼€ä¹‹åï¼Œéƒ½éœ€è¦é‡æ–°è¿æ¥ï¼Œé™¤éä½ é…ç½®è¿›redis.confæ–‡ä»¶
Info replication



ä¿®æ”¹é…ç½®æ–‡ä»¶ç»†èŠ‚æ“ä½œ


æ‹·è´å¤šä¸ªredis.confæ–‡ä»¶



å¼€å¯daemonize yes



Pidæ–‡ä»¶åå­—


æŒ‡å®šç«¯å£


Logæ–‡ä»¶åå­—



Dump.rdbåå­—





å¸¸ç”¨3æ‹›


ä¸€ä¸»äºŒä»†


Init



ä¸€ä¸ªMasterä¸¤ä¸ªSlave



æ—¥å¿—æŸ¥çœ‹


ä¸»æœºæ—¥å¿—



å¤‡æœºæ—¥å¿—



info replication





ä¸»ä»é—®é¢˜æ¼”ç¤º


åˆ‡å…¥ç‚¹é—®é¢˜ï¼Ÿslave1ã€slave2æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶è¿˜æ˜¯ä»åˆ‡å…¥ç‚¹å¼€å§‹å¤åˆ¶?æ¯”å¦‚ä»k4è¿›æ¥ï¼Œé‚£ä¹‹å‰çš„123æ˜¯å¦ä¹Ÿå¯ä»¥å¤åˆ¶


ä»æœºæ˜¯å¦å¯ä»¥å†™ï¼Ÿsetå¯å¦ï¼Ÿ


ä¸»æœºshutdownåæƒ…å†µå¦‚ä½•ï¼Ÿä»æœºæ˜¯ä¸Šä½è¿˜æ˜¯åŸåœ°å¾…å‘½


ä¸»æœºåˆå›æ¥äº†åï¼Œä¸»æœºæ–°å¢è®°å½•ï¼Œä»æœºè¿˜èƒ½å¦é¡ºåˆ©å¤åˆ¶ï¼Ÿ


å…¶ä¸­ä¸€å°ä»æœºdownåæƒ…å†µå¦‚ä½•ï¼Ÿä¾ç…§åŸæœ‰å®ƒèƒ½è·Ÿä¸Šå¤§éƒ¨é˜Ÿå—ï¼Ÿ






è–ªç«ç›¸ä¼ 

ä¸Šä¸€ä¸ªSlaveå¯ä»¥æ˜¯ä¸‹ä¸€ä¸ªslaveçš„Masterï¼ŒSlaveåŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»–
slavesçš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥slaveä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„master,
å¯ä»¥æœ‰æ•ˆå‡è½»masterçš„å†™å‹åŠ›
ä¸­é€”å˜æ›´è½¬å‘:ä¼šæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œé‡æ–°å»ºç«‹æ‹·è´æœ€æ–°çš„
Slaveof æ–°ä¸»åº“IP æ–°ä¸»åº“ç«¯å£



åå®¢ä¸ºä¸»


SLAVEOF no one
ä½¿å½“å‰æ•°æ®åº“åœæ­¢ä¸å…¶ä»–æ•°æ®åº“çš„åŒæ­¥ï¼Œè½¬æˆä¸»æ•°æ®åº“ã€‚






å¤åˆ¶åŸç†

Slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤
Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ
åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥
å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚
å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥
ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ

å“¨å…µæ¨¡å¼(sentinel)

æ˜¯ä»€ä¹ˆ


åå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“



æ€ä¹ˆç©(ä½¿ç”¨æ­¥éª¤)


è°ƒæ•´ç»“æ„ï¼Œ6379å¸¦ç€80ã€81


è‡ªå®šä¹‰çš„/myredisç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œåå­—ç»ä¸èƒ½é”™


é…ç½®å“¨å…µ,å¡«å†™å†…å®¹

sentinel monitor è¢«ç›‘æ§æ•°æ®åº“åå­—(è‡ªå·±èµ·åå­—) 127.0.0.1 6379 1



ä¸Šé¢æœ€åä¸€ä¸ªæ•°å­—1ï¼Œè¡¨ç¤ºä¸»æœºæŒ‚æ‰åsalveæŠ•ç¥¨çœ‹è®©è°æ¥æ›¿æˆä¸ºä¸»æœºï¼Œå¾—ç¥¨æ•°å¤šå°‘åæˆä¸ºä¸»æœº



å¯åŠ¨å“¨å…µ


Redis-sentinel /myredis/sentinel.conf
ä¸Šè¿°ç›®å½•ä¾ç…§å„è‡ªçš„å®é™…æƒ…å†µé…ç½®ï¼Œå¯èƒ½ç›®å½•ä¸åŒ



æ­£å¸¸ä¸»ä»æ¼”ç¤º


åŸæœ‰çš„masteræŒ‚äº†



æŠ•ç¥¨æ–°é€‰



é‡æ–°ä¸»ä»ç»§ç»­å¼€å·¥,info replicationæŸ¥æŸ¥çœ‹



é—®é¢˜ï¼šå¦‚æœä¹‹å‰çš„masteré‡å¯å›æ¥ï¼Œä¼šä¸ä¼šåŒmasterå†²çªï¼Ÿ





ä¸€ç»„sentinelèƒ½åŒæ—¶ç›‘æ§å¤šä¸ªMaster


å¤åˆ¶çš„ç¼ºç‚¹


å¤åˆ¶å»¶æ—¶
ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°Slaveæœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚



                                        </div>
                                        
                                            <a class="btn btn-text" href="https://zoengzihaam.github.io/post/8/">Read More ~</a>
                            </div>
                </div>
            </article>
            
                <!-- ç¿»é¡µ -->
                
    <div class="pagination-container">
        
                
                    <a href="https://zoengzihaam.github.io/page/2" class="page-btn btn">ä¸‹ä¸€é¡µ</a>
                    
    </div>
    
                </div>
                <!--  -->
                <div class="main-container-middle"></div>
                <!--  -->
                <div id="sidebar" class="main-container-right">

                    <!-- ä¸ªäººä¿¡æ¯ -->
                    
    <div class="id_card i-card">
        <div class="id_card-avatar" style="background-image: url(https://zoengzihaam.github.io/images/avatar.png?v=1610626506137)">
        </div>
        <h1 class="id_card-title">
            å·æ¯›
        </h1>
        <h2 class="id_card-description">
            æ²¡æœ‰æ’¤é€€å¯è¨€ã€‚
        </h2>
        <!--  -->
        <div class="id_card-sns">
            <!-- github -->
            
                    <!-- twitter -->
                    
                            <!-- weibo -->
                            
                                    <!-- facebook -->
                                    

        </div>
    </div>
    

                        <!-- å…¬å‘Šæ  -->
                        

                </div>
            </div>



            <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | 
  <a class="rss" href="https://zoengzihaam.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
    <script>
        $('#sidebar').stickySidebar({
            topSpacing: 80,
            // bottomSpacing: 60
        });
    </script>
</body>

</html>